!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e={rdylbu7:{name:"Red-Yellow-Blue (7)",type:"discrete",colors:["#d73027","#fc8d59","#fee090","#adadad","#e0f3f8","#91bfdb","#4575b4"]},orrd7:{name:"Orange-Red (7)",type:"discrete",colors:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"]},gnbu7:{name:"Green-Blue (7)",type:"discrete",colors:["#a8ddb5","#ccebc5","#f0f9e8","#adadad","#4eb3d3","#2b8cbe","#08589e"]},brbg7:{name:"Brown-Teal (7)",type:"discrete",colors:["#8c510a","#d8b365","#f6e8c3","#adadad","#c7eae5","#5ab4ac","#01665e"]},puor7:{name:"Purple-Orange (7)",type:"discrete",colors:["#b35806","#f1a340","#fee0b6","#adadad","#d8daeb","#998ec3","#542788"]},prgn6:{name:"Purple-Green (6)",type:"discrete",colors:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"]},reds5:{name:"Red (5)",type:"discrete",colors:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"]},greens5:{name:"Green (5)",type:"discrete",colors:["#ffffcc","#c2e699","#78c679","#31a354","#006837"]},paired4:{name:"Blue-Green (4)",type:"discrete",colors:["#1f78b4","#a6cee3","#b2df8a","#33a02c"]},greys4:{name:"Grey (4)",type:"discrete",colors:["#f7f7f7","#cccccc","#969696","#525252"]},grey:{name:"Grey",type:"continuous",colors:[[[70,70,70],[80,80,80]],[150,150,150],[[230,230,230],[-80,-80,-80]]]},brown:{name:"Brown",type:"continuous",colors:[[[131,30,0],[62,85,95]],[193,115,95],[[255,200,190],[-62,-85,-95]]]},purple:{name:"Purple",type:"continuous",colors:[[[90,14,213],[52.5,89,16]],[142.5,103,229],[[195,192,245],[-52.5,-89,-16]]]},prgn:{name:"Purple-Green",type:"continuous-divergent",colors:[[[27,120,55],[207,107,168.5]],[234,227,223.5],[[118,42,131],[116,185,92.5]]]},puor:{name:"Purple-Orange",type:"continuous-divergent",colors:[[[179,88,6],[56,133,202.5]],[235,221,208.5],[[84,39,136],[151,182,72.5]]]},rdbu:{name:"Red-Blue",type:"continuous-divergent",colors:[[[69,117,180],[170,116.5,16]],[239,233.5,196],[[215,48,39],[24,185.5,157]]]},vik:{name:"vik",type:"continuous-polynomial",colors:[[97.031,18.4251,.4149],[461.7602,637.5326,244.4647],[-2434.798,-2838.5427,-5893.4695],[9665.3469,14405.823,44072.722],[-2575.9109,-25871.106,-109792.1319],[-42510.0569,8528.3288,120953.8594],[63342.3061,14006.291,-59644.4457],[-26045.0391,-8868.9621,10155.5667]]},lajolla:{name:"lajolla",type:"continuous-polynomial",colors:[[256.0016,255.9138,204.945],[-187.6735,-46.2889,-768.5655],[1022.785,-1057.5602,1782.0325],[-2032.382,1490.8271,-1785.9056],[966.8373,-617.1949,567.7715]]}},t={seps:/[\s,/._-]+/g,period:/\./,all_periods:/\./g,word_start:/\b(\w)/g,settings:/^settings\./,features:/^features\./,filter:/^filter\./,data:/^data\./,variables:/^variables\./,properties:/prop/,palette:/^pal/,datasets:/^dat/,variable:/^var/,levels:/^lev/,ids:/^ids/,minmax:/^m[inax]{2}$/,int_types:/^(?:year|int|integer)$/,end_punct:/[.?!]$/,mustache:/\{(.*?)\}/g,measure_name:/(?:^measure|_name)$/,http:/^https?:\/\//,bool:/^(?:true|false)$/,number:/^[\d-][\d.,]*$/,leading_zeros:/^0+/,url_spaces:/%20/g,hashes:/#/g,embed_setting:/^(?:hide_|navcolor|close_menus)/,median:/^med/i,location_string:/^[^?]*/,time_ref:/\{time\}/g,pre_colon:/^[^:]*:/,exclude_query:/^(?:features|time_range|id)$/,space:/\s+/,has_equation:/<math/,bracket_content:/(?:^|>)[^<]*(?:<|$)/,math_tags:/^(?:semantics|annotation|annotation\-xml|m)/,math_attributes:/^(?:xmlns|display|displaystyle|style|encoding|stretchy|alttext|scriptlevel|fence|math)/},i={percent:function(e){return e+"%"},"drive time":function(e){return e+" minutes"},minutes:function(e){return e+" minutes"},dollar:function(e){return"$"+e},"internet speed":function(e){return e+" MB/s"}},a={time:"time",dataview:"default_view",palette:"vik",background_highlight:"#adadad",border:"#7e7e7e",border_highlight_true:"#ffffff",border_highlight_false:"#000000",missing:"#00000000"},s={dataset:"Overall",filtered:"Filtered",children:"Unfiltered selection",all:"Selection"};const n=function(n,l,r){const o="button.has-note::after,.button-wrapper.has-note button::before,.has-note legend::before,.has-note label::before,.wrapper.has-note > div > label::before{display:none}",d={setting:function(e){const t=e.value(),i=t?"dark":"light";t!==r.settings[e.setting]&&(r.settings[e.setting]=t,"theme_dark"===e.setting?(t?l.body.classList.replace("light-theme","dark-theme"):l.body.classList.replace("dark-theme","light-theme"),r.plotly&&Object.keys(r.plotly).forEach((e=>I(r.plotly[e].u))),r.map&&Object.keys(r.map).forEach((e=>{const t=r.map[e].u;t&&i in t.tiles&&(Object.keys(t.tiles).forEach((e=>{i!==e&&t.tiles[e].removeFrom(t.map)})),t.tiles[i].addTo(t.map))}))):"hide_url_parameters"===e.setting?n.history.replaceState(Date.now(),"",r.settings.hide_url_parameters?n.location.protocol+"//"+n.location.host+n.location.pathname:Z()):"hide_tooltips"===e.setting?t?b.script_style.sheet.insertRule(o,0):b.script_style.sheet.removeRule(0):"map_overlay"===e.setting?Object.keys(r.map).forEach((e=>{"_"!==e[0]&&(t?r.map[e].u.update():(r.map[e].u.overlay.clearLayers(),r.map[e].u.overlay_control.remove()))})):"tracking"===e.setting?(t&&r.tag_id&&!dataLayer.length&&(te("js",new Date),te("config",r.tag_id),te("consent","default",{analytics_storage:"denied"})),te("consent","update",{analytics_storage:t?"granted":"denied"})):oe(),te("event","setting",{event_category:e.setting,event_label:t}),h.set(e.setting,r.settings[e.setting]))},options:function(e){const i=!e.view||!r.dataviews[e.view].selection,a=ie(e.dataset),s=ie(e.variable),n=a+(s||""),l="combobox"===e.type;if(n in e.option_sets||(t.variable.test(e.optionSource)?A(e,a,e.option_sets):t.levels.test(e.optionSource)?q(e,a,s,e.option_sets):t.ids.test(e.optionSource)&&N(e,a,e.option_sets)),n in e.option_sets){const a=n!==e.current_set&&(e.sensitive||!e.current_set),s=e[l?"listbox":"e"];if(a||e.filter||e.selection_subset){a&&(s.innerHTML="",e.values=e.option_sets[n].values,e.display=e.option_sets[n].display,e.options=e.option_sets[n].options);let o=0;if("ID"===e.variable||t.ids.test(e.optionSource)){const t=e.value();let n=-1===t||""===t?e.subset:e.selection_subset,l={};if(!i)if(n in x&&(n=ie(n)),"siblings"===n){const e=r.data.entity_tree&&r.data.entity_tree[t];if(e){const t=Object.keys(e.parents);t.length&&(l={},t.forEach((e=>{l={...l,...r.data.entity_tree[e].children}})))}}else l=r.dataviews[e.view].selection[n];e.options.forEach((t=>{a&&!e.groups&&s.appendChild(t),i||(t.value||t.dataset.value)in l?(t.classList.remove("hidden"),o++):t.classList.add("hidden")}))}else a?e.options.forEach((t=>{t.classList.remove("hidden"),e.groups||s.appendChild(t),o++})):o++;a&&e.groups&&e.groups.e.forEach((e=>s.appendChild(e))),O(e,o),e.current_set=n,a&&(l?e.source=[]:(e.e.selectedIndex=-1,e.source=""),e.id in r.url_options?e.set(r.url_options[e.id]):e.state in e.values?e.set(e.state):e.reset()),e.filter&&e.filter()}}},set_current:function(){this.values=this.option_sets[this.dataset].values,this.display=this.option_sets[this.dataset].display,this.options=this.option_sets[this.dataset].options,this.source="",this.id in r.url_options?this.set(r.url_options[this.id]):this.state in this.values?this.set(this.state):this.reset()},min:async function(e,i){let a,s=i.value(),n=e.value(),l=x[e.view||i.view];t.minmax.test(s)&&(s=i.parsed.min),l&&l.y&&(a=ie(l.y),a in r.data.variables&&(l.time_range.time.length||await d.time_range(l,e,!0),s=Math.max(l.time_range.time[0],parseFloat(s))),e.update()),e.e.min=void 0===e.parsed.min?parseFloat(s):Math.max(e.parsed.min,parseFloat(s)),e.e.value?"number"==typeof n&&isFinite(n)&&n<s&&e.set(s):e.reset(),e.min_indicator&&(e.min_indicator.firstElementChild.innerText=s)},max:async function(e,i){let a,s=i.value(),n=e.value(),l=x[e.view||i.view];t.minmax.test(s)&&(s=i.parsed.max),l&&l.y&&(a=ie(l.y),a in r.data.variables&&(l.time_range.time.length||await d.time_range(l,e,!0),s=Math.min(l.time_range.time[1],parseFloat(s))),e.update()),e.e.max=void 0===e.parsed.max?parseFloat(s):Math.min(e.parsed.max,parseFloat(s)),e.e.value?"number"==typeof n&&isFinite(n)&&n>s&&e.set(s):e.reset(),e.max_indicator&&(e.max_indicator.firstElementChild.innerText=s)},dataview:function(e){(e=e||x[a.dataview]).value()!==e.state&&x._entity_filter.registered[e.parsed.dataset]&&(r.data.inited[e.parsed.dataset]?(e.valid=!0,e.n_selected.ids=0,e.n_selected.children=0,e.n_selected.features=0,e.n_selected.variables=0,e.n_selected.dataset=0,e.n_selected.filtered=0,e.n_selected.full_filter=0,e.n_selected.all=0,e.selection.ids={},e.selection.children={},e.selection.features={},e.selection.variables={},e.selection.dataset={},e.selection.filtered={},e.selection.full_filter={},e.selection.all={},x._base_filter.c.forEach((e=>{e.passed=0,e.failed=0})),x._entity_filter.entities.forEach((t=>{const i=e.check(t),a=t.features.id;i.all=0,i.ids&&(e.selection.ids[a]=t,e.n_selected.ids++,i.all++),i.features&&(e.selection.features[a]=t,e.n_selected.features++,i.all++),i.variables&&(e.selection.variables[a]=t,e.n_selected.variables++,i.all++),i.dataset&&(e.selection.dataset[a]=t,e.n_selected.dataset++,i.all++),i.dataset&&i.ids&&(e.selection.children[a]=t,e.n_selected.children++),i.features&&i.variables&&(e.selection.full_filter[a]=t,e.n_selected.full_filter++),i.variables&&i.features&&i.ids&&(e.selection.filtered[a]=t,e.n_selected.filtered++),4===i.all&&(e.selection.all[a]=t,e.n_selected.all++)})),ce(e.id)):(e.valid=!1,r.data.data_queue[e.parsed.dataset][e.id]=function(){return d.dataview(e)}))},time_filters:function(e){e.time_range.filtered[0]=1/0,e.time_range.filtered[1]=-1/0;const t=e.get.dataset(),i=r.data.meta.times[t],a=e.time_range.filtered_index+"";if(r.data.inited[t]){for(let t=i.n;t--;){let a=!1;if(t>=e.time_range.index[0]&&t<=e.time_range.index[1])for(let s=e.time_filters.length;s--;){const n={},l=e.time_filters[s];if(l.value in n||(n[l.value]=ie(l.value)),a=DataHandler.checks[l.type](i.value[t],n[l.value]),!a)break}e.times[t]=a,a&&(e.time_range.filtered[0]>i.value[t]&&(e.time_range.filtered[0]=i.value[t]),e.time_range.filtered[1]<i.value[t]&&(e.time_range.filtered[1]=i.value[t]))}if(e.time_range.filtered_index=[e.time_range.index[0]+e.time_range.filtered[0]-e.time_range.time[0],e.time_range.index[1]+e.time_range.filtered[1]-e.time_range.time[1]],a!==e.time_range.filtered_index+""){const t=C[e.id+"_filter"];t&&t.forEach((t=>{"update"===t.type?x[t.id].update():t.type in d&&d[t.type](x[t.id],e)}))}}},time_range:async function(e,t,i){const s=t&&t.value(),n=e.get.dataset(),l=e.time?ie(e.time):a.time,o=l in r.data.variables?r.data.variables[l].info[n].min:1,c=C[e.id+"_time"],h=s in r.data.variables?s:ie(e.y);let p=h&&await r.data.get_variable(h,e.id);if(p){const t=n+h!=e.time_range.dataset+e.time_range.variable;p=p.time_range[n],-1!==p[0]&&(e.time_range.dataset=n,e.time_range.variable=h,e.time_range.index[0]=p[0],e.time_range.time[0]=e.time_range.filtered[0]=o+p[0],e.time_range.index[1]=p[1],e.time_range.time[1]=e.time_range.filtered[1]=o+p[1]),!i&&c&&(c.forEach((i=>{const a=x[i.id],s=a.value();"min"===i.type?(t||isFinite(e.time_range.time[0])&&parseFloat(a.e.min)!==e.time_range.time[0])&&(a.e.min=e.time_range.time[0],(t||!g.retain_state||e.time_range.time[0]>s)&&(a.current_default=e.time_range.time[0],a.set(a.current_default))):"max"===i.type&&(t||isFinite(e.time_range.time[1])&&parseFloat(a.e.max)!==e.time_range.time[1])&&(a.e.max=e.time_range.time[1],(t||!g.retain_state||e.time_range.time[1]<s||s<e.time_range.time[0])&&(a.current_default=e.time_range.time[1],a.set(a.current_default)))})),d.time_filters(e))}else e.time_range.dataset=n,e.time_range.index[0]=0,e.time_range.time[0]=e.time_range.filtered[0]=1,e.time_range.index[1]=0,e.time_range.time[1]=e.time_range.filtered[1]=1},id_filter:function(){const e={};x._entity_filter.selected=[],x._entity_filter.select_ids=e,r.metadata.datasets&&r.metadata.datasets.forEach((t=>{if(t in b.modal.filter.entity_inputs){const i=b.modal.filter.entity_inputs[t].value(),a=[];i&&i.length&&(i.forEach((t=>{const i=r.data.entities[t];i&&(a.push(t),x._entity_filter.selected.push(t),e[t]=!0,i.relations&&(Object.keys(i.relations.parents).forEach((t=>e[t]=!0)),Object.keys(i.relations.children).forEach((t=>e[t]=!0))))})),b.modal.filter.entity_inputs[t].source=a)}}))}},c={button:{init:function(e){e.target=e.e.getAttribute("data-target"),"copy"===e.target&&(e.settings.endpoint=r.endpoint),"filter"===e.target?(e.e.setAttribute("data-bs-toggle","modal"),e.e.setAttribute("data-bs-target","#filter_display"),e.notification=l.createElement("span"),e.notification.className="filter-notification hidden",e.e.parentElement.appendChild(e.notification),j("_base_filter",{type:"update",id:e.id}),j("_entity_filter",{type:"update",id:e.id}),e.update=c.button.update.bind(e),r.data&&e.update()):e.e.addEventListener("click",e.settings.effects?"export"===e.target||"copy"===e.target?function(){const i={},a=this.settings,s=x[a.dataview],l=s&&s.parsed.dataset;if(Object.keys(a.query).forEach((e=>i[e]=ie(a.query[e]))),s&&(!("include"in i)&&s.y&&(i.include=ie(s.y)),!("id"in i)&&s.ids&&(i.id=ie(s.ids))),"copy"===this.target||this.api){let o=[];"id"in i&&""!==i.id&&-1!=i.id?o.push("id="+i.id):x._entity_filter.selected.length&&o.push("id="+x._entity_filter.selected.join(",")),s&&(i.time_range||s.time_range.filtered_index+""==s.time_range.index+""||o.push("time_range="+r.data.meta.times[l].value[s.time_range.filtered_index[0]]+","+r.data.meta.times[l].value[s.time_range.filtered_index[1]]),s.features||(s.features={}),Object.keys(s.features).forEach((e=>{e in i||(i[e]=ie(s.features[e]),Array.isArray(i[e])&&(i[e]=i[e].join(",")),o.push(e+"="+i[e]))})),x._base_filter.c.size&&x._base_filter.value(o,s.parsed.time_agg)),Object.keys(i).forEach((e=>{t.exclude_query.test(e)||e in s.features||o.push(e+"="+i[e])}));const d=a.endpoint+(o.length?"?"+o.join("&"):"");this.api?n.location.href=d:navigator.clipboard.writeText(d).then((()=>{"Copied!"!==e.e.innerText&&(e.text=e.e.innerText,e.e.innerText="Copied!",setTimeout((function(){e.e.innerText=e.text}),500),te("event","export",{event_category:"api link"}))}),(t=>{t!==e.e.innerText&&(e.text=e.e.innerText,e.e.innerText=t,setTimeout((function(){e.e.innerText=e.text}),1500))}))}else s&&"selection"in s?(i.time_range||(i.time_range=r.data.meta.times[l].value[s.time_range.filtered_index[0]]+","+r.data.meta.times[l].value[s.time_range.filtered_index[1]]),r.data.export(i,s.selection.all,!0)):r.data.export(i,r.data.entities,!0,!0),te("event","export",{event_category:"download"})}.bind(e):function(){Object.keys(this.settings.effects).forEach((e=>{""===this.settings.effects[e]||-1==this.settings.effects[e]?x[e].reset():x[e].set(this.settings.effects[e])}))}.bind(e):"refresh"===e.target?oe:"reset_selection"===e.target?de:"reset_storage"===e.target?Y:function(){this.target in x&&x[this.target].reset()}.bind(e))},update:function(){let e=Number(0!==x._entity_filter.selected.length);x._base_filter.c.forEach((t=>e+=t.active)),e?(this.notification.innerText=e,this.notification.classList.remove("hidden")):this.notification.classList.add("hidden")}},buttongroup:{retrieve:function(){for(let e=this.options.length;e--;)if(this.options[e].checked){this.set(e);break}},setter:function(e){this.previous=this.value(),this.current_index="string"==typeof e?this.values.indexOf(e):e,-1!==this.current_index?(this.source=this.values[this.current_index]in x?x[this.values[this.current_index]]:this.values[this.current_index],this.options[this.current_index].checked=!0):this.source=void 0,ce(this.id)},listener:function(e){this.set(e.target.value)},adder:function(e,t,i,a){let s=[l.createElement("input"),l.createElement("label")];return s[0].className="btn-check",s[0].type="radio",s[0].name=this.e.id+"_options",s[0].autocomplete="off",s[0].value=t,s[0].id=this.e.id+"_option"+e,s[1].className="btn btn-primary",s[1].innerText=i||r.data.format_label(t),s[1].setAttribute("for",s[0].id),a||(this.e.appendChild(s[0]),this.e.appendChild(s[1])),s[0]}},radio:{retrieve:function(){for(let e=this.options.length;e--;)if(this.options[e].checked){this.set(e);break}},setter:function(e){this.current_index="string"==typeof e?this.values.indexOf(e):e,-1!==this.current_index?(this.source=this.values[this.current_index]in x?x[this.values[this.current_index]]:this.values[this.current_index],this.options[this.current_index].checked=!0):this.source=void 0,ce(this.id)},listener:function(e){this.set(e.target.value)},adder:function(e,t,i){const a=l.createElement("div"),s="TRUE"===this.e.getAttribute("data-switch");return a.className="form-check"+(s?" form-switch":""),a.appendChild(l.createElement("input")),a.appendChild(l.createElement("label")),a.firstElementChild.autocomplete="off",a.firstElementChild.className="form-check-input",s&&(a.firstElementChild.role="switch"),a.firstElementChild.type="radio",a.firstElementChild.name=this.e.id+"_options",a.firstElementChild.id=this.e.id+"_option"+this.e.childElementCount,a.firstElementChild.value=e,a.lastElementChild.innerText=t||r.data.format_label(e),a.lastElementChild.className="form-check-label",a.lastElementChild.setAttribute("for",a.firstElementChild.id),i||this.e.appendChild(a),a.firstElementChild}},checkbox:{retrieve:function(){this.source=[],this.current_index=[],this.off_default=!1,this.options.forEach((e=>{e.checked?(this.source.push(this.values[G]),this.current_index.push(G)):this.off_default=!0})),ce(this.id)},setter:function(e){if("object"==typeof e)this.source=[],this.current_index=[],this.off_default=!1,this.values.forEach(((t,i)=>{-1!==e.indexOf(t)?(this.source.push(t),this.current_index.push(i),this.options[i].checked=!0):(this.off_default=!0,this.options[i].checked=!1)}));else{if("string"==typeof e)return this.set(""===e?this.values:e.split(","));-1!==e&&(this.options[e].checked=!0,this.off_default=!1,this.options.forEach((e=>{e.checked||(this.off_default=!0)})))}ce(this.id)},listener:function(e){if(e.target.checked)this.source.push(e.target.value),this.current_index.push(this.values.indexOf(e.target.value)),this.off_default=!1,this.options.forEach((e=>{e.checked||(this.off_default=!0)}));else{let t=this.source.indexOf(e.target.value);-1!==t&&(this.off_default=!0,this.source.splice(t,1),this.current_index.splice(t,1))}ce(this.id)},adder:function(e,t,i){let a=l.createElement("div"),s="TRUE"===this.e.getAttribute("data-switch");return a.className="form-check"+(s?" form-switch":""),a.appendChild(l.createElement("input")),a.appendChild(l.createElement("label")),a.firstElementChild.autocomplete="off",a.firstElementChild.className="form-check-input",s&&(a.firstElementChild.role="switch"),a.firstElementChild.type="checkbox",a.firstElementChild.name=this.e.id+"_options",a.firstElementChild.id=this.e.id+"_option"+this.e.childElementCount,a.firstElementChild.value=e,a.lastElementChild.innerText=t||r.data.format_label(e),a.lastElementChild.className="form-check-label",a.lastElementChild.setAttribute("for",a.firstElementChild.id),i||this.e.appendChild(a),a.firstElementChild}},switch:{retrieve:function(){this.set(this.e.checked)},setter:function(e){"string"==typeof e&&(e="on"===e),e!==this.source&&(this.previous=this.e.checked,this.e.checked=this.source=e,ce(this.id))},listener:function(){this.set(this.e.checked)}},number:{init:function(e){const t=e.e.parentElement.parentElement.querySelector(".number-up"),i=e.e.parentElement.parentElement.querySelector(".number-down");i&&i.addEventListener("click",function(){this.set(Math.max(this.parsed.min,this.value()-1))}.bind(e)),t&&t.addEventListener("click",function(){this.set(Math.min(this.parsed.max,this.value()+1))}.bind(e))},retrieve:function(){this.set(this.e.value)},setter:function(e,t){e||(e=null),"string"==typeof e&&(e=parseFloat(e)),isFinite(e)&&e!==this.source&&(this.previous=parseFloat(this.e.value),t&&(isFinite(this.parsed.min)&&e<this.parsed.min?e=this.parsed.min:isFinite(this.parsed.max)&&e>this.parsed.max&&(e=this.parsed.max)),this.off_default=e!==this.current_default,this.e.value=this.source=e,this.current_index=e-this.parsed.min,"range"===this.e.type&&(this.e.nextElementSibling.firstElementChild.innerText=this.e.value),ce(this.id))},listener:function(e){this.set(this.e.value,!0)}},intext:{retrieve:function(){this.set(this.e.value)},setter:function(e,t){this.previous=this.e.value,this.e.value=this.source=e,ce(this.id)},listener:function(e){this.set(this.e.value,!0)}},text:{init:function(e){r.text&&e.id in r.text&&(e.text=r.text[e.id].text,e.condition=r.text[e.id].condition||[],e.depends=new Map,e.text.forEach((t=>{"text"in t?(T(e,t),e.e.appendChild(t.parts)):(e.e.appendChild(l.createElement("span")),t.forEach((t=>T(e,t))))})),e.condition.forEach((t=>{t.id in x&&j(t.id,{type:"display",id:e.id})})),e.depends.forEach((t=>j(t.id,{type:"update",id:e.id}))),e.update=c.text.update.bind(e)),e.update()},update:function(){Object.keys(this.reference_options).forEach((e=>this.options[e]=ie(this.reference_options[e]))),this.depends.forEach((e=>{e.parsed=ie(e.id),e.u?e.u.options?e.parsed=e.u.options["combobox"===e.u.type?e.u.values[e.parsed]:e.u.current_index].innerText:e.parsed=e.u.display&&e.parsed in e.u.display?e.u.display[e.parsed]:r.data.format_label(e.parsed):e.parsed in r.data.entities&&(e.parsed=r.data.entities[e.parsed].features.name)})),this.text.forEach(((e,t)=>{let i=!0;if(e.length){for(let t=e.length;t--;)if("condition"in e[t]){for(let a=e[t].condition.length;a--&&(i=e[t].condition[a].check(),i););if(i){e=e[t];break}}}else if("condition"in e)for(let t=e.condition.length;t--&&(i=e.condition[t].check(),i););i?(e.text.forEach(((t,i)=>{if(Array.isArray(t)&&t.forEach((e=>{("default"===e.id||DataHandler.checks[e.type](ie(e.id),ie(e.value)))&&(t=e.text)})),this.depends.has(t))e.parts.children[i].innerText=this.depends.get(t).parsed;else if(t in e.button){let a="";e.button[t].text.forEach((e=>{a=(this.depends.has(e)?this.depends.get(e).parsed:e)+a})),e.parts.children[i].innerText=a}else e.parts.children[i].innerText=t})),this.text[t].length?(this.e.children[t].innerHTML="",this.e.children[t].appendChild(e.parts)):e.parts.classList.remove("hidden")):e.parts.classList.add("hidden")}))}},select:{retrieve:function(){this.set(this.e.selectedIndex)},setter:function(e){"string"==typeof e&&!(e in this.values)&&t.number.test(e)&&(e=Number(e)),"number"==typeof e&&(e=this.options[e]?this.options[e].value:e),!(e in this.values)&&e in this.display&&(e=this.options[this.display[e]].value),e!==this.source&&(this.e.selectedIndex=e in this.values?this.values[e]:-1,this.source=e,ce(this.id))},listener:function(e){this.set(e.target.selectedIndex)},adder:function(e,t,i,a){const s=l.createElement("option");return s.value=e,s.innerText=t||r.data.format_label(e),i&&i.info&&(s.title=i.info.description||i.info.short_description),a||this.e.appendChild(s),s}},combobox:{create:function(e,i,a,s){s=s||"created_combobox_"+ ++b.elementCount;const n=l.createElement("div");let o=l.createElement("div");a&&(r.combobox||(r.combobox={}),r.combobox[s]=a),n.className="wrapper combobox-wrapper",n.appendChild(o),o.id=s,o.setAttribute("data-autoType","combobox"),o.className="auto-input form-select combobox combobox-component",o.role="combobox",o.setAttribute("aria-haspopup","listbox"),o.setAttribute("aria-expanded","false"),o.setAttribute("aria-labelledby",s+"-label"),o.setAttribute("aria-controls",s+"-listbox"),o.appendChild(o=l.createElement("div")),o.className="combobox-selection combobox-component",o.appendChild(l.createElement("span")),o.lastElementChild.className="combobox-component",o.appendChild(o=l.createElement("input")),o.className="combobox-input combobox-component",o.type="text",o.setAttribute("aria-labelledby",s+"-label"),o.id=s+"-input",o.autocomplete="off",a&&a.clearable&&(n.firstElementChild.appendChild(o=l.createElement("button")),o.type="button",o.className="btn-close",o.title="clear selection"),n.appendChild(o=l.createElement("div")),o.className="combobox-options combobox-component",o.role="listbox",o.tabindex="-1",o.id=s+"-listbox",n.appendChild(o=l.createElement("label")),o.id=s+"-label",o.innerText=e,c.init_input(n.firstElementChild);const d=x[s];let h=0;return d.options=[],i&&(Array.isArray(i)?i.forEach((e=>{const t=r.data.format_label(e);d.display[t]=h,d.values[e]=h++,d.options.push(d.add(e,t))})):(d.groups={e:[],by_name:{}},Object.keys(i).forEach((e=>{const a=i[e],s=l.createElement("div"),n=d.id+"_group_"+e.replace(t.seps,"-");s.className="combobox-group combobox-component",s.setAttribute("aria-labelledby",n),s.appendChild(l.createElement("label")),s.firstElementChild.innerText=e,s.firstElementChild.id=n,s.firstElementChild.className="combobox-group-label combobox-component",d.groups.by_name[e]=s,d.groups.e.push(s),a.forEach((t=>d.groups.by_name[e].appendChild(d.add(t,t,!0)))),d.listbox.appendChild(s)})),Object.keys(d.groups.by_name).forEach((e=>{d.groups.by_name[e].querySelectorAll(".combobox-option").forEach((t=>{d.options.push(t),t.setAttribute("data-group",e),d.values[t.dataset.value]=h,d.display[t.innerText]=h++}))})))),d},init:function(e){if(e.hover_index=-1,e.cleared_selection="",e.expanded=!1,e.listbox=e.e.parentElement.children[1],e.options=e.listbox.querySelectorAll(".combobox-option"),e.options.length){e.values={},e.display={},e.options.forEach(((t,i)=>{e.values[t.dataset.value]=i,e.display[t.innerText]=i}));const t=e.listbox.querySelectorAll(".combobox-group");t.length&&(e.groups={e:[],by_name:{}},t.forEach((t=>{const i=t.dataset.group;e.groups.e[i]=t,e.groups.by_name[i]=t})))}e.container=l.createElement("div"),e.container.className="combobox-options-container combobox-component",e.container.style.display="none",b.overlay.appendChild(e.container),e.container.appendChild(e.listbox),e.selection=e.e.firstElementChild.firstElementChild,e.input_element=e.e.firstElementChild.lastElementChild,2===e.e.childElementCount&&e.e.lastElementChild.addEventListener("click",function(){this.e.classList.contains("locked")||(this.cleared_selection="",this.set([]),this.input_element.focus())}.bind(e)),e.value=function(){return this.source?this.settings.multi?this.source:this.source.length?this.source[0]:"":ie(this.default)}.bind(e),e.input_element.addEventListener("focus",function(){this.e.classList.add("focused")}.bind(e)),e.input_element.addEventListener("blur",function(){this.e.classList.remove("focused")}.bind(e)),e.listbox.addEventListener("click",e.set),e.close=function(t){!this.expanded||t&&t.target.classList&&t.target.classList.contains("combobox-component")||(""===this.selection.innerText&&this.source.length&&(this.selection.innerText=this.cleared_selection),""!==this.input_element.value&&setTimeout(this.set,0),this.e.setAttribute("aria-expanded",!1),this.expanded=!1,this.container.style.display="none",n.removeEventListener("click",e.close))}.bind(e),e.resize=function(){const e=this.e.getBoundingClientRect();this.container.style.left=e.x+"px",this.container.style.width=e.width+"px",n.screen.height/2>e.y?(this.container.style.top=e.y+e.height+"px",this.container.style.bottom=""):(this.container.style.top="",this.container.style.bottom=-e.y+"px")}.bind(e),n.addEventListener("resize",e.resize),e.toggle=function(e){e.button||this.e.classList.contains("disabled")||"BUTTON"===e.target.tagName||(this.expanded?e.target!==this.input_element&&this.close():(r.combobox&&Object.keys(r.combobox).forEach((e=>{if(e!==this.id){const t=x[e];t.expanded&&t.close()}})),this.container.style.display="",""!==this.selection.innerText&&(this.cleared_selection=this.selection.innerText),this.cleared_selection in this.display&&this.highlight({target:this.options[this.display[this.cleared_selection]]}),this.selection.innerText="",n.addEventListener("click",this.close),this.e.setAttribute("aria-expanded",!0),e&&e.target===this.input_element||setTimeout((()=>this.input_element.focus()),0),this.resize(),this.expanded=!0))}.bind(e),e.e.addEventListener("mousedown",e.toggle),e.highlight=function(e){if(!e||!e.target||e.target.dataset.value in this.values){this.groups||(this.settings.accordion=!1),e&&e.target&&e.target.dataset.value?this.hover_index=this.values[e.target.dataset.value]:-1===this.hover_index&&this.source&&(this.hover_index=this.values[this.source[0]]),void 0===this.hover_index&&(this.hover_index=-1);const t=this.options[this.hover_index];if(t){const i=this.listbox.querySelector(".highlighted");if(i&&i.classList.remove("highlighted"),e&&"mouseover"===e.type)e.target.classList.add("highlighted");else{if(t.classList.add("highlighted"),this.settings.accordion){const e=t.parentElement.parentElement;e.classList.contains("show")||(e.classList.add("show"),e.previousElementSibling.firstElementChild.classList.remove("collapsed"),e.previousElementSibling.firstElementChild.setAttribute("aria-expanded",!0))}this.e.setAttribute("aria-activedescendant",t.id);const e=this.container.getBoundingClientRect(),i=t.getBoundingClientRect();let a=e.top;this.groups&&t.getAttribute("data-group")&&(a+=this.groups.by_name[t.getAttribute("data-group")].firstElementChild.getBoundingClientRect().height),a>i.top?this.container.scrollTo(0,this.container.scrollTop+i.top-a):e.bottom<i.bottom&&this.container.scrollTo(0,this.container.scrollTop+i.bottom-e.bottom)}}}}.bind(e),e.listbox.addEventListener("mouseover",e.highlight),e.settings.accordion&&e.listbox.addEventListener("show.bs.collapse",(t=>{(-1===e.hover_index?"":e.options[e.hover_index].getAttribute("data-group"))!==t.target.getAttribute("data-group")&&(e.highlight({target:t.target.firstElementChild.firstElementChild}),e.input_element.focus())})),e.clear_highlight=function(){-1!==this.hover_index&&(this.options[this.hover_index].classList.remove("highlighted"),this.hover_index=-1)}.bind(e),e.filter_reset=function(){this.groups&&this.groups.e.forEach((e=>e.firstElementChild.firstElementChild.classList.remove("hidden"))),this.input_element.value="",this.filter_index=[],this.listbox.querySelectorAll(".filter-hidden").forEach((e=>e.classList.remove("filter-hidden")))}.bind(e),e.settings.search&&(e.filterer=function(e){const t=this.input_element.value.toLowerCase();""===t?this.filter_reset():(this.filter_index=[],this.groups&&this.groups.e.forEach((e=>e.firstElementChild.firstElementChild.classList.add("hidden"))),this.options.forEach(((e,i)=>{if(e.innerText.toLowerCase().includes(t)){e.classList.remove("filter-hidden"),this.filter_index.push(i);const t=e.getAttribute("data-group");if(t&&(this.groups.by_name[t].firstElementChild.firstElementChild.classList.remove("hidden"),this.settings.accordion)){const e=this.groups.by_name[t];e.firstElementChild.nextElementSibling.classList.add("show"),e.firstElementChild.firstElementChild.classList.remove("collapsed"),e.firstElementChild.firstElementChild.setAttribute("aria-expanded",!0)}}else e.classList.add("filter-hidden")})))}.bind(e),e.input_element.addEventListener("keyup",e.filterer)),e.input_element.addEventListener("keydown",function(e){const t=u[e.code];if(t)if("close"===t)this.close();else if("select"===t){if(!this.expanded)return this.toggle({target:this.input_element});this.set(e)}else"move"===t&&(e.preventDefault(),"ArrowUp"===e.code?this.filter_index&&this.filter_index.length?(this.hover_index=this.filter_index.indexOf(this.hover_index)-1,this.hover_index=this.filter_index[0>this.hover_index?0:this.hover_index]):this.hover_index=Math.max(0,this.hover_index-1):"ArrowDown"===e.code?this.filter_index&&this.filter_index.length?(this.hover_index=this.filter_index.indexOf(this.hover_index)+1,this.hover_index=this.filter_index[this.filter_index.length-1<this.hover_index?this.filter_index.length-1:this.hover_index]):this.hover_index=Math.min(this.options.length-1,this.hover_index+1):"Home"===e.code?this.hover_index=0:"End"===e.code&&(this.hover_index=this.options.length-1),this.expanded?this.highlight():this.set(this.hover_index));else this.expanded?this.clear_highlight():this.toggle({target:this.input_element})}.bind(e))},retrieve:function(){this.source=[],this.listbox.querySelectorAll(".selected").forEach((e=>this.source.push(e.dataset.value))),ce(this.id)},setter:function(e,i){if(e||(e=this.input_element.value),e.target&&(this.settings.accordion?"BUTTON":"LABEL")===e.target.tagName)return;let a=!1,s=-1;if(e.target&&(s=this.hover_index,-1!==s&&(this.options[s].classList.contains("hidden")||this.options[s].classList.contains("filter-hidden"))&&(s=-1),e=-1===s?e.target.dataset.value||e.target.innerText:this.options[s].dataset.value||this.options[s].innerText,i=this.settings.multi),this.filter_reset(),"object"==typeof e&&(this.settings.multi?(this.listbox.querySelectorAll(".selected").forEach((e=>e.classList.remove("selected"))),this.source=-1===e?[]:e,e.forEach((e=>{e in this.values&&this.options[this.values[e]].classList.add("selected")}))):e=e[0]),Array.isArray(this.source)||(this.source=[]),"object"==typeof e&&this.settings.multi)a=!0;else if(this.settings.strict&&"string"==typeof e&&!(e in this.values)&&t.number.test(e)&&(e=Number(e)),"number"!==this.value_type&&"number"==typeof e&&this.options[e]&&(e=this.options[e].dataset.value),"string"==typeof e&&e in this.display&&(e=this.options[this.display[e]].dataset.value),this.settings.strict&&!(e in this.values)&&(e=this.default),s=this.source.indexOf(e),-1===s){if(a=!0,-1===e||""===e?this.source=[]:this.settings.multi?this.source.push(e):this.source[0]=e,e in this.values){if(!this.settings.multi){const e=this.listbox.querySelector(".selected");e&&e.classList.remove("selected")}this.options[this.values[e]].classList.add("selected")}}else i&&(a=!0,this.source.splice(s,1),e in this.values&&this.options[this.values[e]].classList.remove("selected"));!this.settings.multi&&this.expanded&&(this.input_element.focus(),this.close(),this.filter_reset()),this.selection.innerText=this.source.length?this.settings.multi?this.source.length+" of "+this.options.length+" selected":this.source[0]in this.values?this.options[this.values[this.source[0]]].firstChild.textContent:this.settings.strict||-1===this.source[0]?"":this.source[0]:"",this.onchange&&this.onchange(),a&&ce(this.id)},adder:function(e,t,i,a){const s=l.createElement("div");return s.role="option",s.setAttribute("aria-selected",!1),s.tabindex="0",s.className="combobox-option combobox-component",s.dataset.value=e,s.innerText=t||r.data.format_label(e),a&&a.info&&(s.appendChild(l.createElement("p")),s.lastElementChild.className="combobox-option-description combobox-component",s.lastElementChild.innerText=a.info.description||a.info.short_description||""),i||this.listbox.appendChild(s),s}},plotly:{init:function(e){e.previous_span=1,e.id in r.plotly&&(e.x=e.e.getAttribute("data-x"),e.y=e.e.getAttribute("data-y"),e.color=e.e.getAttribute("data-color"),e.time=e.e.getAttribute("data-colorTime"),e.click=e.e.getAttribute("data-click"),e.click in x&&(e.clickto=x[e.click]),e.parsed={},e.traces={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0,e.tab&&l.getElementById(e.e.parentElement.getAttribute("aria-labelledby")).addEventListener("click",function(){this.e.parentElement.classList.contains("active")||(setTimeout(this.update,155),setTimeout(W,155))}.bind(e)),e.show=function(t){e.revert();let i=R(this,t,0,0,"hover_line",a["border_highlight_"+r.settings.theme_dark]);i&&(i.line.width=4,i.marker.size=12,Plotly.addTraces(this.e,i,this.e.data.length))},e.revert=function(){this.e.data.length&&"hover_line"===this.e.data[this.e.data.length-1].name&&Plotly.deleteTraces(this.e,this.e.data.length-1)},e.options&&(r.plotly[e.id].u=e),r.plotly[e.id].data.forEach(((i,s)=>{Object.keys(i).forEach((e=>{if(t.period.test(e)){const t=e.split("."),a=t.length-1;let s=null;t.forEach(((t,n)=>{s=s?s[t]=n===a?i[e]:{}:i[t]={}}))}})),"textfont"in i||(i.textfont={}),"color"in i.textfont||(i.textfont.color=a.background_highlight),"line"in i||(i.line={}),"color"in i.line||(i.line.color=a.background_highlight),"marker"in i||(i.marker={}),i.marker.size=8,"color"in i.marker||(i.marker.color=a.background_highlight),"line"in i.marker||(i.marker.line={}),"color"in i.marker.line||(i.marker.line.color=a.background_highlight),"text"in i||(i.text=[]),"x"in i||(i.x=[]),"box"===i.type?i.hoverinfo="none":"y"in i||(i.y=[]),e.traces[i.type]=JSON.stringify(i),s||(e.base_trace=i.type,e.base_trace in x&&j(e.base_trace,{type:"update",id:e.id}))})),e.x&&!(e.x in r.data.variables)&&j(e.x,{type:"update",id:e.id}),e.y&&!(e.y in r.data.variables)&&j(e.y,{type:"update",id:e.id}),e.color&&!(e.color in r.data.variables)&&j(e.color,{type:"update",id:e.id}),e.time in x&&j(e.time,{type:"update",id:e.id}),e.view?(j(e.view,{type:"update",id:e.id}),j(e.view+"_filter",{type:"update",id:e.id}),x[e.view].time_agg in x&&j(x[e.view].time_agg,{type:"update",id:e.id})):e.view=a.dataview,e.queue=this.queue_init.bind(e)())},queue_init:function(){const e=this.deferred||!this.tab||this.tab.classList.contains("show");e&&n.Plotly?(Plotly.newPlot(this.e,this.options),this.e.on("plotly_hover",c.plotly.mouseover.bind(this)).on("plotly_unhover",c.plotly.mouseout.bind(this)).on("plotly_click",c.plotly.click.bind(this)),I(this),this.update()):(this.deferred=!0,setTimeout(this.queue,e?0:2e3))},mouseover:function(e){e.points&&1===e.points.length&&this.e.data[e.points[0].fullData.index]&&(Plotly.restyle(this.e,{"line.width":5},e.points[0].fullData.index),B(this.id,"show",r.data.entities[e.points[0].data.id]))},mouseout:function(e){e.points&&1===e.points.length&&this.e.data[e.points[0].fullData.index]&&(Plotly.restyle(this.e,{"line.width":2},e.points[0].fullData.index),B(this.id,"revert",r.data.entities[e.points[0].data.id]))},click:function(e){this.clickto&&this.clickto.set(e.points[0].data.id)},update:async function(t){if(this.queue>0&&clearTimeout(this.queue),this.queue=-1,t){if(this.e.layout){const t=x[this.view],i=t.selection&&t.selection.all,s=t.get.dataset(),n=x[this.time||t.time_agg],l=this.parsed;if(r.data.inited[s]&&i&&t.time_range.filtered.length){l.base_trace=ie(this.base_trace),l.x=ie(this.x),l.y=ie(this.y),l.color=ie(this.color||t.y||l.y);const o=await r.data.get_variable(l.x,this.view),d=await r.data.get_variable(l.y,this.view),h=await r.data.get_variable(l.color,this.view);l.x_range=o.time_range[s],l.y_range=d.time_range[s],l.view=t,l.dataset=s,l.palette=ie(t.palette)||r.settings.palette,l.palette in e||(l.palette=a.palette),l.time=(n?n.value()-r.data.meta.times[s].range[0]:0)-h.time_range[s][0],l.summary=h.views[this.view].summaries[s];const p=l.summary.n,u=p[l.time]?l.time:0,m=d.views[this.view].summaries[s],f=l.summary.missing[u],b=p[u],_=b!==t.n_selected.dataset,g=_?"subset_rank":"rank",v=_?h.views[this.view].order[s][u]:h.info[s].order[u],y=[];let E,x,C,w=l.summary.missing[u],k=v?v.length:0,T=r.settings.trace_limit||0,L=t.value()+t.get.time_filters()+s+l.x+l.y+l.time+l.palette+l.color+r.settings.summary_selection+r.settings.color_scale_center+r.settings.color_by_order+r.settings.trace_limit+r.settings.show_empty_times;for(T=C=T&&T<b?Math.ceil(Math.min(T/2,b/2)):0,Object.keys(this.reference_options).forEach((e=>this.options[e]=ie(this.reference_options[e])));w<k;w++)if(v[w][0]in i){E=v[w][0];const e=i[E];if(L+=E,y.push(R(this,e,e.views[this.view][g][l.color][l.time]-f,b)),T&&!--C)break}if(T&&w<k)for(C=w,w=k-1;w>C;w--)if(v[w][0]in i){E=v[w][0];const e=i[E];if(L+=E,y.push(R(this,e,e.views[this.view][g][l.color][l.time]-f,b)),!--T)break}if(L+=y.length&&y[0].type,r.settings.boxplots&&"box"in this.traces&&i[E])if(L+="box"+r.settings.iqr_box,x=JSON.parse(this.traces.box),y.push(x),x.line.color=a.border,x.median=m.median,x.q3=m.q3,x.q1=m.q1,r.settings.iqr_box?(x.upperfence=[],x.lowerfence=[],x.q1.forEach(((e,t)=>{isNaN(x.median[t])&&(x.median[t]=0);const i=1.5*(x.q3[t]-e),a=x.median[t];x.q3[t]=isNaN(x.q3[t])?a:Math.max(a,x.q3[t]),x.upperfence[t]=x.q3[t]+i,x.q1[t]=isNaN(x.q1[t])?a:Math.min(a,e),x.lowerfence[t]=e-i}))):(x.upperfence=m.max,x.lowerfence=m.min),r.settings.show_empty_times)x.x=x.q1.map(((e,t)=>i[E].get_value(l.x,t+l.y_range[0])));else for(x.x=[],w=x.q1.length;w--;)p[w]&&(x.x[w]=i[E].get_value(l.x,w+l.y_range[0]));if(L!==this.state){"boolean"!=typeof this.e.layout.yaxis.title&&(this.e.layout.yaxis.title=r.data.format_label(l.y)+(r.settings.trace_limit<t.n_selected.all?" ("+r.settings.trace_limit+" extremes)":"")),"boolean"!=typeof this.e.layout.xaxis.title&&(this.e.layout.xaxis.title=r.data.format_label(l.x)),this.e.layout.yaxis.autorange=!1,this.e.layout.yaxis.range=[1/0,-1/0],x||(x={upperfence:m.max,lowerfence:m.min});let e=!1;m.min.forEach(((t,i)=>{if(r.settings.show_empty_times||p[i]){const e=Math.min(x.lowerfence[i],t),a=Math.max(x.upperfence[i],m.max[i]);this.e.layout.yaxis.range[0]>e&&(this.e.layout.yaxis.range[0]=e),this.e.layout.yaxis.range[1]<a&&(this.e.layout.yaxis.range[1]=a)}else e=!0}));const i=(this.e.layout.yaxis.range[1]-this.e.layout.yaxis.range[0])/10;if(this.e.layout.yaxis.range[0]-=i,this.e.layout.yaxis.range[1]+=i,r.data.variables[l.x].is_time){const i=t.time_range.filtered[0],a=t.time_range.filtered[1],s=e&&a>i?Math.log(a-i):.5;this.e.layout.xaxis.autorange?(this.e.layout.xaxis.autorange=!1,this.e.layout.xaxis.type="linear",this.e.layout.xaxis.dtick=1,this.e.layout.xaxis.range=[i-s,a+s]):(this.e.layout.xaxis.range[0]=i-s,this.e.layout.xaxis.range[1]=a+s)}x.lowerfence.length<this.previous_span?(Plotly.newPlot(this.e,y,this.e.layout,this.e.config),this.e.on("plotly_hover",c.plotly.mouseover.bind(this)).on("plotly_unhover",c.plotly.mouseout.bind(this)).on("plotly_click",c.plotly.click.bind(this))):Plotly.react(this.e,y,this.e.layout,this.e.config),setTimeout(W,300),this.previous_span=x.lowerfence.length,this.state=L}}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(!0)),50))}},map:{init:function(e){e.color=e.e.getAttribute("data-color"),e.time=e.e.getAttribute("data-colorTime"),e.click=e.e.getAttribute("data-click"),e.click&&e.click in x&&(e.clickto=x[e.click]),e.parsed={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0,e.show=function(t){if(t.layer&&t.layer[this.id]){const i={color:"var(--border-highlight)",weight:r.settings.polygon_outline+1,fillOpacity:1};if(r.data.inited[this.parsed.dataset+e.id])t.layer[this.id].setStyle&&t.layer[this.id].setStyle(i);else{const e=r.map[this.id].match_time(r.data.meta.overall.value[r.data.variables[this.parsed.color].time_range[this.parsed.dataset][0]+this.parsed.time]);t.layer[this.id][e]&&t.layer[this.id][e].setStyle(i)}}},e.revert=function(e){if(e.layer&&e.layer[this.id]){const t={color:"var(--border)",weight:r.settings.polygon_outline,fillOpacity:.7};if(r.data.inited[this.parsed.dataset+this.id])e.layer[this.id].setStyle(t);else{const i=r.map[this.id].match_time(r.data.meta.overall.value[r.data.variables[this.parsed.color].time_range[this.parsed.dataset][0]+this.parsed.time]);e.layer[this.id][i]&&e.layer[this.id][i].setStyle(t)}}};const i={type:"update",id:e.id};if(e.view?(x[e.view].time_agg in x&&j(x[e.view].time_agg,i),x[e.view].y&&j(x[e.view].y,i)):e.view=a.dataview,j(e.view,i),e.color in x&&j(e.color,i),e.time&&j(e.time,i),e.e.style.height||(e.e.style.height=e.options.height?e.options.height:"400px"),e.options.overlays_from_measures&&r.data.variable_info){Array.isArray(r.map[e.id].overlays)||(r.map[e.id].overlays=[]);const i=r.map[e.id].overlays;Object.keys(r.data.variable_info).forEach((e=>{const a=r.data.variable_info[e];if(a.layer&&a.layer.source){if("string"==typeof a.layer.source&&t.time_ref.test(a.layer.source)){const i=a.layer.source;a.layer.source=[];for(let s,n=r.data.meta.ranges[e],l=n[0],o=n[1]+1;l<o;l++)s=r.data.meta.overall.value[l],a.layer.source.push({url:i.replace(t.time_ref,s),time:s})}t.time_ref.lastIndex=0;const s={variable:e,source:a.layer.source};a.layer.filter&&(Array.isArray(a.layer.filter)||a.layer.filter.feature)&&(s.filter=a.layer.filter),i.push(s)}}))}e.queue=this.queue_init.bind(e)()},queue_init:function(){const e=r.settings.theme_dark?"dark":"light",t=this.deferred||!this.tab||this.tab.classList.contains("show");if(t&&n.L){if(this.map=L.map(this.e,this.options),this.options=this.map.options,this.overlay=L.featureGroup().addTo(this.map),this.displaying=L.featureGroup().addTo(this.map),this.overlay_control=L.control.layers().setPosition("topleft").addOverlay(this.overlay,"Overlay").addTo(this.map),this.tiles={},this.id in r.map){const t=r.map[this.id].tiles;r.map[this.id].u=this,t&&(t.url?(this.tiles[e]=L.tileLayer(t.url,t.options),this.tiles[e].addTo(this.map)):Object.keys(t).forEach((i=>{this.tiles[i]=L.tileLayer(t[i].url,t[i].options),e===i&&this.tiles[i].addTo(this.map)}))),"_raw"in r.map||(r.map._raw={}),"_queue"in r.map||(r.map._queue={}),"_layers"in r.map[this.id]||(r.map[this.id]._layers={});const i=r.data.meta.overall.value[x[this.view].parsed.time_agg],a=[];r.map[this.id].shapes.forEach(((e,t)=>{const s="time"in e;s&&(r.map[this.id].has_time||(r.map[this.id].has_time=!0,j(this.view,{type:"update",id:this.id})),a.push(Number(e.time)));let n=e.name;n||(e.name=n=r.metadata.datasets[t<r.metadata.datasets.length?t:0]);const l=n+(s?e.time:"");l in r.map._queue||(r.map._queue[l]=e),r.data.inited[l+this.id]=!1,(r.data.loaded[n]||n===this.options.background_shapes)&&(n===l||i&&r.map[this.id].match_time&&e.time==r.map[this.id].match_time(i))&&ne(this,e)})),r.map[this.id].has_time&&(a.sort(),r.map[this.id].match_time=function(e){let t=a.length;for(;t--&&(t&&!(a[t]<=e)););return a[t]}.bind(a)),r.map[this.id].triggers={},r.map[this.id].overlay_summaries={},Array.isArray(r.map[this.id].overlays)&&r.map[this.id].overlays.forEach((e=>{"string"==typeof e.source&&(e.source=[{url:e.source}]);const t=e.source;t.forEach((e=>{e.processed=!1,e.property_summaries={},r.map._queue[e.url]=e})),r.map[this.id].triggers[e.variable]={source:t};const i=e.filter;if(i){const t=Array.isArray(i)?i:[i];r.map[this.id].triggers[e.variable].filter=t,t.forEach((e=>{e.check=DataHandler.checks[e.operator]}))}}))}}else this.deferred=!0,setTimeout(this.queue,t?0:2e3)},mouseover:function(e){e.target.setStyle({color:"var(--border-highlight)"}),B(this.id,"show",r.data.entities[e.target.feature.properties[e.target.source.id_property]])},mouseout:function(e){B(this.id,"revert",r.data.entities[e.target.feature.properties[e.target.source.id_property]]),e.target.setStyle({color:"var(--border)"})},click:function(e){this.clickto&&this.clickto.set(e.target.feature.properties[e.target.source.id_property])},update:async function(t,i,s){if(this.queue>0&&clearTimeout(this.queue),this.queue=-1,s){if(this.view&&this.displaying){const t=this.parsed,i=r.dataviews[this.view],s=i.get.dataset(),n=ie(i.time_agg),l=r.map[this.id].has_time?r.map[this.id].match_time(n):"",o=s+l+this.id in r.data.inited,c=o?s+l:s;if(r.map._queue&&c in r.map._queue&&!r.data.inited[c+this.id])return void(o&&null===n||ne(this,r.map._queue[c],(()=>this.update(void 0,void 0,!0))));!i.valid&&r.data.inited[s]&&(i.state="",d.dataview(i,void 0,!0)),t.view=i,t.dataset=s;const h=i.value()+c+r.settings.background_shapes+r.settings.background_top+r.settings.background_polygon_outline+r.data.inited[this.options.background_shapes],p=i.selection.all,u=i.selection[r.settings.background_shapes&&this.options.background_shapes?"ids":"all"],m=ie(this.color||i.y);if(r.settings.map_overlay&&m in r.map[this.id].triggers?le(this,r.map[this.id].triggers[m],r.data.meta.overall.value[i.parsed.time_agg]):(this.overlay_control.remove(),this.overlay.clearLayers()),r.data.inited[c+this.id]&&u&&i.valid){const n=this.time?x[this.time]:i.time_agg?i.time_agg in x?x[i.time_agg]:parseInt(i.time_agg):0;t.palette=ie(i.palette)||r.settings.palette,t.palette in e||(t.palette=a.palette);const o=await r.data.get_variable(m,this.view),d=o.views[this.view].summaries[s],c=(n.parsed?n.value()-r.data.meta.times[s].range[0]:0)-o.time_range[s][0];t.summary=d,t.time=c,t.color=m;const f=d.n[n]===i.n_selected.dataset?"rank":"subset_rank";if(h!==this.vstate){this.map._zoomAnimated="none"!==r.settings.map_animations,Object.keys(this.reference_options).forEach((e=>{this.options[e]=ie(this.reference_options[e]),"zoomAnimation"===e&&(this.map._zoomAnimated=this.options[e])})),this.displaying.clearLayers(),this.fresh_shapes=!0,this.vstate=!1;let e=0;Object.keys(u).forEach((t=>{const i=u[t].layer;if(i&&i[this.id]){const a=t in p,s=i[this.id].has_time?i[this.id][l]:i[this.id];s&&(a||this.options.background_shapes===r.data.entities[t].group)&&(e++,s.options.interactive=a,s.addTo(this.displaying),a?r.settings.background_top&&s.bringToBack():(r.settings.background_top||s.bringToBack(),s.setStyle({fillOpacity:0,color:"var(--border-highlight)",weight:r.settings.background_polygon_outline})),this.vstate||(this.vstate=h))}})),this.overlay.bringToFront(),e&&("fly"===r.settings.map_animations?setTimeout((()=>this.map.flyToBounds(this.displaying.getBounds())),400):this.map.fitBounds(this.displaying.getBounds()))}const b=m+this.vstate+t.palette+c+r.settings.polygon_outline+r.settings.color_by_order+r.settings.color_scale_center;if(b!==this.cstate)if(this.cstate=b,r.map[this.id]){const e=this.displaying._layers,i=d.n[c],n=d.missing[c];Object.keys(e).forEach((l=>{const o=e[l];if(s===o.entity.group){const e=p[o.entity.features.id],s=e&&e.views[this.view][f];o.setStyle({fillOpacity:.7,color:"var(--border)",fillColor:e&&m in s?k(e.get_value(m,c),t.palette,d,c,s[m][c]-n,i):a.missing,weight:r.settings.polygon_outline})}}))}else"_waiting"in r.map||(r.map._waiting={}),s in r.map._waiting||(r.map._waiting[s]=[]),-1===r.map._waiting[s].indexOf(this.id)&&r.map._waiting[s].push(this.id),-1===r.map._waiting[s].indexOf(this.view)&&r.map._waiting[s].push(this.view)}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(void 0,void 0,!0)),50))}},info:{init:function(e){function a(e,a){const s={parent:e,text:a,parsed:{},ref:!0,selection:!1,get:function(a,s){if(this.ref){if(a){if("features"in this.parsed)return a.features[this.parsed.features];if("data"in this.parsed){if("value"===this.text?this.parsed.data=ie(e.options.variable||s.color||s.y||x[e.view].y):this.text in x&&(this.parsed.data=ie(this.text)),!(this.parsed.data in r.data.variables))return this.parsed.data;const n=r.data.variable_info[this.parsed.data],l=r.data.format_value(a.get_value(this.parsed.data,this.parent.time),!n||!n.type||t.int_types.test(n.type));return NaN!==l&&n.type in i?i[n.type](l):l}}return"data"in this.parsed?r.data.meta.times[this.parent.dataset].value[this.parent.time_agg]:"variables"in this.parsed&&(this.value_source||this.parent.v in r.data.variable_info)?r.data.variable_info[ie(this.value_source||this.parent.v)][this.parsed.variables]:this.text}return this.text}};if("value"===a)s.parsed.data=e.options.variable;else if("summary"===a){e.options.show_summary=!0,e.e.classList.add("info-summary-wrapper");const t=l.createElement("table");t.className="info-summary",s.parsed.summary=t,t.appendChild(l.createElement("tr")),t.appendChild(l.createElement("tr")),["NAs","Min","Q1","Mean","Median","Q3","Max"].forEach((e=>{t.firstElementChild.appendChild(l.createElement("th")),t.firstElementChild.lastElementChild.innerText=e,t.lastElementChild.appendChild(l.createElement("td")),t.lastElementChild.lastElementChild.innerText="NA"}))}else if("filter"===a){const e=l.createElement("table");e.className="info-filter",s.parsed.filter=e}return t.features.test(a)?s.parsed.features=a.replace(t.features,""):t.data.test(a)?s.parsed.data=a.replace(t.data,""):t.variables.test(a)?s.parsed.variables=a.replace(t.variables,""):s.ref=!1,s}if(e.depends={},e.has_default=e.options.default&&(e.options.default.title||e.options.default.body),M(e.view,e),e.options.floating&&(l.body.appendChild(e.e),e.e.classList.add("hidden"),l.addEventListener("mousemove",(function(t){if(e.showing){const i=b.content.getBoundingClientRect();e.e.style.top=(t.y>i.height/2?t.y-e.e.getBoundingClientRect().height-10:t.y+10)+"px",e.e.style.left=(t.x>i.width/2?t.x-e.e.getBoundingClientRect().width-10:t.x+10)+"px"}}))),e.show=function(e,t){this.update(e,t),this.showing=!0,this.options.floating&&this.e.classList.remove("hidden"),this.parts.title&&(this.selection?this.parts.title.base.classList.add("hidden"):this.parts.title.default.classList.add("hidden"),this.parts.title.temp.classList.remove("hidden")),this.parts.body&&(this.selection?this.parts.body.base.classList.add("hidden"):this.parts.body.default.classList.add("hidden"),this.parts.body.temp.classList.remove("hidden"))},e.revert=function(){this.showing=!1,this.options.floating?this.e.classList.add("hidden"):(this.parts.title&&(this.selection?this.parts.title.base.classList.remove("hidden"):this.has_default&&this.parts.title.default.classList.remove("hidden"),this.parts.title.temp.classList.add("hidden")),this.parts.body&&(this.selection?this.parts.body.base.classList.remove("hidden"):this.has_default&&this.parts.body.default.classList.remove("hidden"),this.parts.body.temp.classList.add("hidden")))},e.parts={},e.options.title&&(e.parts.title=a(e,e.options.title),"variables"in e.parts.title.parsed&&t.measure_name.test(e.parts.title.parsed.variables)?(e.parts.title.base=l.createElement("button"),e.parts.title.base.type="button",e.parts.title.base.setAttribute("data-bs-toggle","modal"),e.parts.title.base.setAttribute("data-bs-target","#variable_info_display"),e.parts.title.base.addEventListener("click",H.bind(e))):e.parts.title.base=l.createElement("p"),e.parts.title.base.appendChild(l.createElement("span")),e.parts.title.temp=l.createElement("p"),e.parts.title.default=l.createElement("p"),e.parts.title.temp.className=e.parts.title.base.className=e.parts.title.default.className="info-title hidden",e.has_default&&e.options.default.title&&(e.e.appendChild(e.parts.title.default),e.parts.title.default.innerText=e.options.default.title),e.parts.title.ref||(e.parts.title.base.firstElementChild.innerText=e.parts.title.get()),e.e.appendChild(e.parts.title.base),e.e.appendChild(e.parts.title.temp),e.parts.title.base.classList.add("hidden"),e.parts.title.temp.classList.add("hidden")),e.options.body){e.parts.body={base:l.createElement("div"),temp:l.createElement("div"),default:l.createElement("div"),rows:[]},e.parts.body.temp.className=e.parts.body.base.className=e.parts.body.default.className="info-body hidden",e.has_default&&e.options.default.body&&(e.parts.body.default.innerText=e.options.default.body);let i=0;e.options.body.forEach(((s,n)=>{const r={name:a(e,s.name),value:a(e,s.value)};e.parts.body.rows[n]=r,r.base=l.createElement("div"),e.parts.body.base.appendChild(r.base),r.temp=l.createElement("div"),e.parts.body.temp.appendChild(r.temp),r.temp.className=r.base.className="info-body-row-"+s.style,i+=24+("stack"===s.style?24:0),r.name&&(e.options.variable_info&&"variables"in r.name.parsed&&t.measure_name.test(r.name.parsed.variables)?(r.base.appendChild(l.createElement("button")),r.base.lastElementChild.type="button",r.base.lastElementChild.setAttribute("data-bs-toggle","modal"),r.base.lastElementChild.setAttribute("data-bs-target","#variable_info_display"),r.base.lastElementChild.addEventListener("click",H.bind(e))):r.base.appendChild(l.createElement("div")),r.temp.appendChild(l.createElement("div")),r.temp.lastElementChild.className=r.base.lastElementChild.className="info-body-row-name",r.temp.lastElementChild.innerText=r.base.lastElementChild.innerText=r.name.get()),r.value&&(r.base.appendChild(l.createElement("div")),r.temp.appendChild(l.createElement("div")),"summary"in r.value.parsed?r.base.lastElementChild.appendChild(r.value.parsed.summary):"filter"in r.value.parsed?r.base.lastElementChild.appendChild(r.value.parsed.filter):(r.temp.lastElementChild.className=r.base.lastElementChild.className="info-body-row-value"+("statement"===r.value.parsed.variables?" statement":""),r.name.ref&&"value"===r.value.text&&(r.value.ref=!0),r.value.ref||(r.temp.lastElementChild.innerText=r.base.lastElementChild.innerText=r.value.get())))})),e.e.style.minHeight=i+"px",e.e.appendChild(e.parts.body.base),e.e.appendChild(e.parts.body.default),e.e.appendChild(e.parts.body.temp)}e.update()},update:async function(e,t,i){const a=r.dataviews[this.view],s=x[a.time_agg];if(this.v=ie(this.options.variable||t&&(t.color||t.y)||a.y),this.dataset=a.get.dataset(),s&&!(this.dataset in r.data.meta.times))return void(this.id in r.data.data_queue[this.dataset]||(r.data.data_queue[this.dataset][this.id]=this.update));this.time_agg=s?s.value()-r.data.meta.times[this.dataset].range[0]:0;const n=this.v&&r.data.variables[this.v].time_range[this.dataset];this.time=n?this.time_agg-n[0]:0,this.options.show_summary&&(this.var=this.v&&await r.data.get_variable(this.v,this.view),this.summary=this.view in this.var.views&&this.var.views[this.view].summaries[this.dataset]),this.processed||(this.processed=!0,this.options.floating||(j(this.view,{type:"update",id:this.id}),a.y in x&&j(a.y,{type:"update",id:this.id}),s&&j(a.time_agg,{type:"update",id:this.id}),this.options.variable in x&&j(this.options.variable,{type:"update",id:this.id})),this.parts.body&&this.parts.body.rows.forEach((e=>{!e.value.ref&&e.value.text in x&&"variables"in e.name.parsed&&(e.name.value_source=e.value.value_source=e.value.text,e.value.ref=!0,e.value.parsed.data="")}))),e?(this.parts.title&&(this.parts.title.temp.innerText=this.parts.title.get(e,t)),this.parts.body&&this.parts.body.rows.forEach((i=>{i.name.ref&&(i.name.value_source&&(i.name.value_source=i.value.text),J=i.name.get(e,t),"object"!=typeof J&&(i.temp.firstElementChild.innerText=z(J,i.value.parsed.variables,this,e))),i.value.ref&&(i.value.value_source&&(i.value.value_source=i.value.text),J=i.value.get(e,t),"object"!=typeof J&&(i.temp.lastElementChild.innerText=z(J,i.value.parsed.variables,this,e)))}))):this.options.floating||(this.queue>0&&clearTimeout(this.queue),this.queue=-1,i?((e=r.data.entities[a.get.ids(!0)])?(this.selection=!0,this.parts.title&&(this.parts.title.value_source&&(p.title.value_source=p.value.text),this.parts.title.base.classList.remove("hidden"),this.parts.title.default.classList.add("hidden")),this.parts.body&&this.has_default&&this.parts.body.default.classList.add("hidden")):(this.selection=!1,this.parts.title&&(this.has_default?(this.parts.title.base.classList.add("hidden"),this.parts.title.default.classList.remove("hidden")):this.parts.title.ref&&"features"in this.parts.title.parsed||this.parts.title.base.classList.remove("hidden")),this.parts.body&&(this.parts.body.base.classList.add("hidden"),this.has_default&&this.parts.body.default.classList.remove("hidden"))),this.parts.title&&(this.parts.title.base.firstElementChild.innerText=this.parts.title.get(e,t)),this.parts.body&&(this.options.subto||this.parts.body.base.classList.remove("hidden"),this.parts.body.rows.forEach((i=>{if("summary"in i.value.parsed){const e=i.value.parsed.summary.lastElementChild.children;m.summary.forEach(((t,i)=>{e[i].innerText=r.data.format_value(this.summary[t][this.time],0===i)}))}else if("filter"in i.value.parsed){const e=i.value.parsed.filter;let t=0;if(e.innerHTML="",x._entity_filter.selected.length){t++;const i=l.createElement("tr");i.className="filter-display";let a=l.createElement("td");i.appendChild(a),a.appendChild(l.createElement("span")),a.lastElementChild.className="syntax-variable",a.lastElementChild.innerText="Select Entities",a=l.createElement("td"),i.appendChild(a),a.appendChild(l.createElement("span")),a.lastElementChild.className="syntax-operator",a.lastElementChild.innerText=":",a=l.createElement("td"),i.appendChild(a),a.setAttribute("colspan",2),a.appendChild(l.createElement("span")),a.lastElementChild.className="syntax-value";let s="";x._entity_filter.selected.forEach((e=>{const t=r.data.entities[e];s+=(s?", ":"")+(t&&t.features?t.features.name:e)})),a.lastElementChild.innerText=s,e.appendChild(i)}x._base_filter.c.forEach((i=>{const a=i.passed+i.failed;if(i.active&&a){const s=i.passed+"/"+a;i.e.children[1].lastElementChild.innerText=s,t++;const n=l.createElement("tr"),o=r.data.variable_info[i.variable];n.className="filter-display";let d=l.createElement("td");n.appendChild(d),d.appendChild(l.createElement("span")),d.lastElementChild.className="syntax-variable",d.lastElementChild.title=i.variable,d.lastElementChild.innerText=o.short_name,d.appendChild(l.createElement("span")),d.lastElementChild.innerText=" (",d.appendChild(l.createElement("span")),d.lastElementChild.className="syntax-component",d.lastElementChild.innerText=i.component,d.appendChild(l.createElement("span")),d.lastElementChild.innerText=")",d=l.createElement("td"),n.appendChild(d),d.appendChild(l.createElement("span")),d.lastElementChild.className="syntax-operator",d.lastElementChild.innerText=i.operator,d=l.createElement("td"),n.appendChild(d),d.appendChild(l.createElement("span")),d.lastElementChild.className="syntax-value",d.lastElementChild.innerText="number"==typeof i.value?r.data.format_value(i.value):i.value,d=l.createElement("td"),n.appendChild(d),d.appendChild(l.createElement("span")),d.lastElementChild.innerText="("+(i.value_source?i.value_source+"; ":"")+s+")",e.appendChild(n)}})),this.e.style.display=t?"":"none"}if(!("variables"in i.value.parsed)&&!("summary"in i.value.parsed)||a.y in this.depends?"filter"in i.value.parsed&&!("_base_filter"in this.depends)&&(this.depends._base_filter=!0,j("_base_filter",{type:"update",id:this.id})):(this.depends[a.y]=!0,j(a.y,{type:"update",id:this.id})),i.name.ref){i.name.value_source&&(i.name.value_source=i.value.text);const a=i.name.get(e,t);"object"!=typeof a&&(i.base.firstElementChild.innerText=a)}if(i.value.ref){const a=i.value.get(e,t);"object"==typeof a?Array.isArray(a)&&"sources"===i.value.parsed.variables&&(i.base.innerHTML="",i.base.appendChild(l.createElement("table")),i.base.lastElementChild.className="source-table",i.base.firstElementChild.appendChild(l.createElement("thead")),i.base.firstElementChild.firstElementChild.appendChild(l.createElement("tr")),i.base.firstElementChild.firstElementChild.firstElementChild.appendChild(l.createElement("th")),i.base.firstElementChild.firstElementChild.firstElementChild.appendChild(l.createElement("th")),i.base.firstElementChild.firstElementChild.firstElementChild.firstElementChild.innerText="Source",i.base.firstElementChild.firstElementChild.firstElementChild.lastElementChild.innerText="Accessed",i.base.firstElementChild.appendChild(l.createElement("tbody")),a.forEach((e=>{i.base.firstElementChild.lastElementChild.appendChild(F(e,!0))}))):i.base.lastElementChild.innerText=z(a,i.value.parsed.variables,this,e)}})))):this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(void 0,void 0,!0)),50))),this.revert()}},datatable:{init:function(e){e.e.appendChild(l.createElement("thead")),e.e.appendChild(l.createElement("tbody")),e.click=e.e.getAttribute("data-click"),e.features=e.options.features,e.parsed={summary:{},order:[],time:-1,color:"",dataset:x[e.view].get.dataset(),time_index:{}},e.header=[],e.rows={},e.rowIds={},e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0;const i=r.data.meta.times[e.parsed.dataset];if(e.style=l.head.appendChild(l.createElement("style")),e.tab&&l.getElementById(e.e.parentElement.getAttribute("aria-labelledby")).addEventListener("click",function(){this.e.parentElement.classList.contains("active")||(setTimeout(this.update,155),setTimeout(W,155))}.bind(e)),e.e.addEventListener("mouseover",c.datatable.mouseover.bind(e)),e.e.addEventListener("mouseout",c.datatable.mouseout.bind(e)),e.click&&(e.click in x&&(e.clickto=x[e.click]),e.e.addEventListener("click",c.datatable.click.bind(e))),e.show=function(e){if(e.features&&e.features.id in this.rows){r.settings.table_autoscroll&&this.rows[e.features.id].scrollTo("smooth"===r.settings.table_scroll_behavior),this.pending>0&&clearTimeout(this.pending),this.pending=-1;const t=this.rows[e.features.id].node();t?t.classList.add("highlighted"):this.pending=setTimeout(function(){const e=this.node();e&&e.classList.add("highlighted")}.bind(this.rows[e.features.id]),0)}},e.revert=function(){this.pending>0&&clearTimeout(this.pending),this.e.querySelectorAll("tr.highlighted").forEach((e=>e.classList.remove("highlighted")))},e.options.variable_source=e.options.variables,e.options.variables?"string"==typeof e.options.variables&&(e.options.variables in x?(j(e.options.variables,{type:"update",id:e.id}),e.options.variables=ie(e.options.variables),e.options.single_variable="string"==typeof e.options.variables):e.options.single_variable||(e.options.single_variable=[{name:e.options.single_variable}])):e.options.variables=Object.keys(r.data.variables),"string"!=typeof e.options.variables&&e.options.variables.length&&"string"===e.options.variables[0]&&(e.options.variables=e.options.variables.map((e=>{}))),e.options.single_variable){const t=e.options.variables,a=t.name||t;e.header.push({title:"Name",data:"entity.features.name"}),i&&i.is_single&&(e.variable_header=!0);const s=a in r.data.variables&&r.data.variables[a].time_range[e.parsed.dataset];if(s)for(let n=s[1]-s[0]+1;n--;)e.header[n+1]={title:e.variable_header?t.title||r.data.format_label(a):i.value[n+s[0]]+"",data:r.data.get_value,render:DataHandler.retrievers.row_time.bind({i:n,o:s[0],format_value:r.data.format_value.bind(r.data)})};e.options.order=[[e.header.length-1,"dsc"]]}else if(e.options.wide){e.features&&("string"==typeof e.features&&(e.features=[{name:e.features}]),e.features.forEach((i=>{e.header.push({title:i.title||i.name,data:"entity.features."+i.name.replace(t.all_periods,"\\.")})})));for(let i=e.options.variables.length;i--;){"string"==typeof e.options.variables[i]&&(e.options.variables[i]={name:e.options.variables[i]});const a=e.options.variables[i];a.source||(a.source=a.name in r.data.variables?"data":"features"),e.header.push("features"===a.source?{title:a.title||r.data.format_label(a.name),data:"entity.features."+a.name.toLowerCase().replace(t.all_periods,"\\.")}:{title:a.title||r.data.format_label(a.name),render:async function(e,t,i){if("data"===this.c.source){if(this.c.name in r.data.variables){const e=await r.data.get_variable(this.c.name,this.o.view),t=i.time-e.time_range[this.o.parsed.dataset][0];return t<0?NaN:i.entity.get_value(this.c.name,t)}return NaN}return this.c.source in i.entity&&this.c.name in i.entity[this.c.source]?i.entity[this.c.source][this.c.name]:NaN}.bind({o:e,c:a})})}}else e.filters=e.options.filters,e.current_filter={},i.is_single||e.header.push({title:"Year",data:"entity.time.value",render:function(e,t,i){const a=i.time+i.offset;return e&&a>=0&&a<e.length?e[a]:NaN}}),e.features&&("string"==typeof e.features&&(e.features=[{name:e.features}]),e.features.forEach((i=>{e.header.splice(0,0,{title:i.title||i.name,data:"entity.features."+i.name.replace(t.all_periods,"\\.")})}))),e.header.push({title:"Variable",data:function(e){return e.variable in e.entity.variables?e.entity.variables[e.variable].meta.short_name:e.variable}}),e.header.push({title:"Value",data:r.data.get_value,render:function(e,t,i){return e?"number"==typeof e[i.time]?r.data.format_value(e[i.time],i.int):e[i.time]:""}});e.view?(j(e.view,{type:"update",id:e.id}),j(e.view+"_filter",{type:"update",id:e.id}),j(x[e.view].time_agg,{type:"update",id:e.id})):e.view=a.dataview,e.queue=this.queue_init.bind(e)()},queue_init:function(){const e=this.deferred||!this.tab||this.tab.classList.contains("show");e&&n.jQuery&&n.DataTable&&"get"in r.dataviews[this.view]?(this.options.columns=this.header,this.table=$(this.e).DataTable(this.options),this.update()):(this.deferred=!0,setTimeout(this.queue,e?0:2e3))},update:async function(e){if(this.queue>0&&clearTimeout(this.queue),this.queue=-1,e){if(this.table){let i=this.options.variable_source&&ie(this.options.variable_source).replace(t.all_periods,"\\.");const a=x[this.view],s=a.get.dataset(),n=r.data.meta.times[s],l=s+a.value()+a.get.time_filters()+r.settings.digits+i+r.settings.theme_dark+r.settings.show_empty_times,o=l!==this.state,d=ie(a.time_agg),c=await r.data.get_variable(i,this.view);if(this.parsed.time_range=c?c.time_range[s]:n.info.time_range[s],this.parsed.time=("number"==typeof d?d-n.range[0]:0)-this.parsed.time_range[0],o){if(this.rows={},this.rowIds={},this.table.clear(),a.valid){if(this.state=l,Object.keys(this.reference_options).forEach((e=>this.options[e]=ie(this.reference_options[e]))),this.options.single_variable){if(this.parsed.time_index={},this.parsed.dataset=s,this.parsed.color=i,this.parsed.summary=this.view in c.views&&c.views[this.view].summaries[s],this.parsed.order=this.view in c.views&&c.views[this.view].order[s][this.parsed.time],this.header.length<2||s!==this.header[1].dataset||i!==this.header[1].variable){if(this.table.destroy(),$(this.e).empty(),this.header=[{title:"Name",data:"entity.features.name",type:"string"}],-1!==this.parsed.time_range[0])for(let e=this.parsed.time_range[2];e--;)this.header[e+1]={dataset:s,variable:i,type:"string"===c.type?"string":"num",title:this.variable_header?this.options.variables.title||r.data.format_label(i):n.value[e+this.parsed.time_range[0]]+"",data:r.data.get_value,render:DataHandler.retrievers.row_time.bind({i:e,o:this.parsed.time_range[0],format_value:r.data.format_value.bind(r.data)})};else this.state="";this.options.order[0][0]=this.header.length-1,this.options.columns=this.header,this.table=$(this.e).DataTable(this.options)}const e=this.header.length,t=this.parsed.summary.n;let l;for(let i=1,s=!1,o=0;i<e;i++)s=a.times[i-1+this.parsed.time_range[0]]&&(r.settings.show_empty_times||t[i-1]),this.table.column(i).visible(s,!1),s&&(this.parsed.time_index[n.value[i-1+this.parsed.time_range[0]]]=++o,l=!1);l&&(this.state="")}if(this.options.wide)Object.keys(a.selection.all).forEach((e=>{if(i)i in a.selection.all[e].views[this.view].summary&&(this.rows[e]=this.table.row.add({dataset:s,variable:i,offset:this.parsed.time_range[0],entity:a.selection.all[e],int:t.int_types.test(r.data.variable_info[i].type)}),this.rowIds[this.rows[e].selector.rows]=e);else for(let t=n.n;t--;)this.rows[e]=this.table.row.add({time:t,entity:a.selection.all[e]}),this.rowIds[this.rows[e].selector.rows]=e}));else{this.filters&&Object.keys(this.filters).forEach((e=>{this.current_filter[U]=ie(e)}));const n=[];let l=""+this.parsed.dataset+a.get.ids(!0)+a.get.features()+r.settings.digits;for(let a=this.options.variables.length;a--;){i=this.options.variables[a].name||this.options.variables[a],e=!this.filters;const o=await r.data.get_variable(i,this.view);if(i in r.data.variables&&"meta"in o)if(this.options.filters){for(const t in this.current_filter)if(t in o.meta&&!(e=o.meta[t]===this.current_filter[t]))break}else e=!0;e&&(l+=i,n.push({variable:i,int:t.int_types.test(r.data.variable_info[i].type),time_range:o.time_range[s],renderer:function(e,t){const i=t.features.id,a=this.time_range,n=a[1];for(let l=a[0];l<=n;l++)e.rows[i]=e.table.row.add({offset:this.time_range[0],time:l-this.time_range[0],dataset:s,variable:this.variable,entity:t,int:this.int}),e.rowIds[e.rows[i].selector.rows]=i}}))}if(l===this.varstate)return;this.varstate=l,Object.keys(a.selection.all).forEach((e=>{const l=a.selection.all[e];this.options.single_variable?i in l[a].summary&&c.code in l.data&&(this.rows[e]=this.table.row.add({offset:this.parsed.time_range[0],dataset:s,variable:i,entity:l,int:t.int_types.test(r.data.variable_info[i].type)}),this.rowIds[this.rows[e].selector.rows]=e):n.forEach((e=>{r.data.variables[e.variable].code in l.data&&e.renderer(this,l)}))}))}}this.table.draw()}if(this.parsed.time>-1&&this.header.length>1&&a.time_range.filtered_index&&(this.dark_highlight=r.settings.theme_dark,this.style.sheet.rules.length&&this.style.sheet.removeRule(0),this.parsed.time_index[d]&&this.style.sheet.insertRule("#"+this.id+" td:nth-child("+(this.parsed.time_index[d]+1)+"){background-color: var(--background-highlight)}",0),!o&&r.settings.table_autosort&&this.table.order([this.parsed.time+1,"dsc"]).draw(),r.settings.table_autoscroll)){const e=this.e.parentElement.getBoundingClientRect().width,t=this.table.column(this.parsed.time+1).header().getBoundingClientRect();t&&this.e.parentElement.scroll({left:t.x-this.e.getBoundingClientRect().x+t.width+16-e,behavior:r.settings.table_scroll_behavior||"smooth"})}}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(!0)),50))},mouseover:function(e){if(e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row],i=this.rows[t].node();i&&i.classList.add("highlighted"),t in r.data.entities&&B(this.id,"show",r.data.entities[t])}},mouseout:function(e){if(e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row],i=this.rows[t].node();i&&i.classList.remove("highlighted"),t in r.data.entities&&B(this.id,"revert",r.data.entities[t])}},click:function(e){if(this.clickto&&e.target._DT_CellIndex&&e.target._DT_CellIndex.row in this.rowIds){const t=this.rowIds[e.target._DT_CellIndex.row];t in r.data.entities&&this.clickto.set(t)}}},table:{init:function(e){e.click=e.e.getAttribute("data-click"),e.features=e.options.features,e.parsed={summary:{},order:[],time:0,color:"",dataset:a.dataview,time_index:{}},e.header=[],e.rows={},e.parts={head:l.createElement("thead"),body:l.createElement("tbody")},e.parts.head.appendChild(l.createElement("tr")),e.e.appendChild(e.parts.head),e.e.appendChild(e.parts.body),e.click&&e.e.classList.add("interactive"),e.options.variable_source=e.options.variables,e.options.variables in x&&j(e.options.variables,{type:"update",id:e.id}),e.tab="tabpanel"===e.e.parentElement.getAttribute("role")?e.e.parentElement:void 0,e.tab&&l.getElementById(e.e.parentElement.getAttribute("aria-labelledby")).addEventListener("click",function(){this.e.parentElement.classList.contains("active")||(setTimeout(this.update,155),setTimeout(W,155))}.bind(e)),e.e.addEventListener("mouseover",c.table.mouseover.bind(e)),e.e.addEventListener("mouseout",c.table.mouseout.bind(e)),e.click&&(e.click in x&&(e.clickto=x[e.click]),e.e.addEventListener("click",c.table.click.bind(e))),e.show=function(e){if(e.features){const t=this.rows[e.features.id];if(t&&t.parentElement&&(t.classList.add("highlighted"),r.settings.table_autoscroll)){const e=this.e.parentElement.getBoundingClientRect().height,i=t.getBoundingClientRect().y-t.parentElement.getBoundingClientRect().y;this.e.parentElement.scroll({top:e>this.e.scrollHeight-i?this.e.parentElement.scrollHeight:i,behavior:r.settings.table_scroll_behavior||"smooth"})}}}.bind(e),e.revert=function(e){e.features&&e.features.id in this.rows&&this.rows[e.features.id].classList.remove("highlighted")}.bind(e),e.createHeader=function(e){const t=this.parsed.dataset,i=r.data.meta.times[t],a=this.parts.head.firstElementChild,s=this.parsed.variable.time_range[t],n=s[0],o=s[1]+1,d=this.parsed.summary.n;this.parsed.time_index={},a.innerHTML="",a.appendChild(l.createElement("th")),a.lastElementChild.appendChild(l.createElement("span")),a.firstElementChild.lastElementChild.innerText="Name";for(let t=n,s=0;t<o;t++)e.times[t]&&(r.settings.show_empty_times||d[t-n])&&(this.parsed.time_index[i.value[t]]=s++,a.appendChild(l.createElement("th")),a.lastElementChild.appendChild(l.createElement("span")),a.lastElementChild.lastElementChild.innerText=i.value[t])}.bind(e),e.appendRows=function(e){const t=this.parsed.order,i=this.parsed.variable,a=r.data.meta.times[this.parsed.dataset].value,s=i.time_range[this.parsed.dataset],n=s[0],o=s[1]-n+1,d=e.selection.all;this.current_variable=i.code+this.parsed.dataset,this.parts.body.innerHTML="";for(let s=t.length;s--;){const c=t[s][0];if(c in d){const t=r.data.entities[c],s=t.data[i.code],d=l.createElement("tr");this.rows[c]=d,d.setAttribute("data-entityId",c);let h=l.createElement("td");if(h.innerText=t.features.name,d.appendChild(h),1===o)d.appendChild(h=l.createElement("td")),h.innerText=r.data.format_value(s),h.setAttribute("data-entityId",c),h.classList.add("highlighted");else for(let t=0;t<o;t++)e.times[t+n]&&a[t+n]in this.parsed.time_index&&(d.appendChild(h=l.createElement("td")),h.innerText=r.data.format_value(s[t]),t===this.parsed.time&&h.classList.add("highlighted"));this.parts.body.appendChild(d)}}if(r.settings.table_autoscroll&&this.parts.head.firstElementChild.childElementCount>2&&this.parts.head.firstElementChild.childElementCount>this.parsed.time+1){const e=this.e.parentElement.getBoundingClientRect().width,t=this.parts.head.firstElementChild.children[this.parsed.time+1].getBoundingClientRect();this.e.parentElement.scroll({left:t.x-this.e.getBoundingClientRect().x+t.width+16-e,behavior:r.settings.table_scroll_behavior||"smooth"})}}.bind(e),e.view?(j(e.view,{type:"update",id:e.id}),j(e.view+"_filter",{type:"update",id:e.id}),j(x[e.view].time_agg,{type:"update",id:e.id})):e.view=a.dataview,e.update()},update:async function(e){if(this.queue>0&&clearTimeout(this.queue),this.queue=-1,e){let e=this.options.variable_source&&ie(this.options.variable_source).replace(t.all_periods,"\\.");const i=x[this.view],a=i.get.dataset(),s=ie(i.time_agg),n=a+i.value()+i.get.time_filters()+r.settings.digits+e+s+r.settings.show_empty_times;if(!r.data.inited[a])return;if(n!==this.state){this.state=n,Object.keys(this.reference_options).forEach((e=>this.options[e]=ie(this.reference_options[e])));const t=await r.data.get_variable(e,this.view);this.parsed.dataset=a,this.parsed.color=e,this.parsed.variable=t,this.parsed.time_range=t.time_range[a],this.parsed.time=("number"==typeof s?s-r.data.meta.times[a].range[0]:0)-this.parsed.time_range[0],this.parsed.summary=t.views[this.view].summaries[a],this.parsed.order=t.views[this.view].order[a][this.parsed.time],this.createHeader(i),this.appendRows(i)}}else this.tab&&!this.tab.classList.contains("show")||(this.queue=setTimeout((()=>this.update(!0)),50))},mouseover:function(e){const t="TD"===e.target.tagName?e.target.parentElement:e.target,i=t.getAttribute("data-entityId");i&&(t.classList.add("highlighted"),B(this.id,"show",r.data.entities[i]))},mouseout:function(e){const t="TD"===e.target.tagName?e.target.parentElement:e.target,i=t.getAttribute("data-entityId");i&&(t.classList.remove("highlighted"),B(this.id,"revert",r.data.entities[i]))},click:function(e){const t=("TD"===e.target.tagName?e.target.parentElement:e.target).getAttribute("data-entityId");this.clickto&&t&&this.clickto.set(t)}},legend:{init:function(e){j(e.view,{type:"update",id:e.id});const t=x[e.view];if(t.time_agg in x&&j(t.time_agg,{type:"update",id:e.id}),e.palette||(t.palette?(e.palette=t.palette,t.palette in x&&j(t.palette,{type:"update",id:e.id})):e.palette="settings.palette"in x?"settings.palette":r.settings.palette),e.variable=e.e.getAttribute("data-variable"),e.variable?e.variable in x&&j(e.variable,{type:"update",id:e.id}):t.y in x&&j(t.y,{type:"update",id:e.id}),e.palette in x){const t=x[e.palette];t.e&&t.e.addEventListener("change",e.update)}e.parsed={summary:{},order:[],selection:{},time:0,color:"",rank:!1},e.state="",e.queue={lock:!1,cooldown:-1,trigger:function(){this.mouseover(this.queue.e)}.bind(e)},e.queue.reset=function(){this.lock=!1}.bind(e.queue),e.parts={ticks:e.e.querySelector(".legend-ticks"),scale:e.e.querySelector(".legend-scale"),summary:e.e.querySelector(".legend-summary")},e.parts.ticks.setAttribute("data-of",e.id),e.parts.scale.setAttribute("data-of",e.id),e.parts.summary.setAttribute("data-of",e.id),e.mouseover=c.legend.mouseover.bind(e),e.e.addEventListener("mousemove",e.mouseover),e.e.addEventListener("mouseout",c.legend.mouseout.bind(e)),e.e.addEventListener("click",c.legend.click.bind(e)),e.click=e.e.getAttribute("data-click"),e.click in x&&(e.clickto=x[e.click]),e.ticks={center:e.parts.summary.appendChild(l.createElement("div")),min:e.parts.summary.appendChild(l.createElement("div")),max:e.parts.summary.appendChild(l.createElement("div")),entity:e.parts.ticks.appendChild(l.createElement("div"))},Object.keys(e.ticks).forEach((t=>{e.ticks[t].setAttribute("data-of",e.id),e.ticks[t].className="legend-tick",e.ticks[t].appendChild(J=l.createElement("div")),J.setAttribute("data-of",e.id),J.appendChild(l.createElement("p")),J.lastElementChild.setAttribute("data-of",e.id),"m"!==t.substring(0,1)&&(J.appendChild(l.createElement("p")),J.lastElementChild.setAttribute("data-of",e.id),J.appendChild(l.createElement("p")),J.lastElementChild.setAttribute("data-of",e.id),"entity"===t?e.ticks[t].firstElementChild.lastElementChild.classList.add("entity"):e.ticks[t].firstElementChild.firstElementChild.classList.add("summary"))})),e.ticks.entity.firstElementChild.classList.add("hidden"),e.ticks.max.className="legend-tick-end max",e.ticks.min.className="legend-tick-end min",e.ticks.center.style.left="50%",e.show=function(e,t){if(e&&"parsed"in t&&e.features.name){const i=x[this.view],a=t.parsed.summary,s=a&&"string"===a.type,n=a&&!s?a.min[t.parsed.time]:0,l=a?s?a.levels.length-n:a.range[t.parsed.time]:1,o=a.n[t.parsed.time],d=o===i.n_selected.dataset?"rank":"subset_rank",c=r.data.entities[e.features.id].views[this.view],h=e.get_value(t.parsed.color,t.parsed.time),p=100*((s?h in a.level_ids:"number"==typeof h)?r.settings.color_by_order?NaN:Math.max(0,Math.min(1,l?((s?a.level_ids[h]:h)-n)/l:.5)):NaN),u=this.ticks.entity,m=u.firstElementChild.children[1];if(isFinite(p))m.parentElement.classList.remove("hidden"),m.innerText=r.data.format_value(h,this.integer),u.style.left=p+"%",u.firstElementChild.firstElementChild.innerText=(p>96||p<4)&&e.features.name.length>13?e.features.name.substring(0,12)+"…":e.features.name;else if(r.settings.color_by_order&&t.parsed.color in c[d]){const i=c[d][t.parsed.color][t.parsed.time],a=o>1?i/(o-1)*100:0;u.firstElementChild.firstElementChild.innerText=i>-1&&(a>96||a<4)&&e.features.name.length>13?e.features.name.substring(0,12)+"…":e.features.name,i>-1&&(m.parentElement.classList.remove("hidden"),m.innerText="# "+(o-i),u.style.left=a+"%")}u.style.marginLeft=-u.getBoundingClientRect().width/2+"px"}},e.revert=function(){this.ticks.entity.firstElementChild.classList.add("hidden")},e.update()},update:async function(){const i=x[this.view],n=ie(this.variable||i.y),o=i.get.dataset(),d=await r.data.get_variable(n,this.view),c=ie(i.time_agg);if(null!==c&&i.valid&&d&&this.view in d.views){const i=("number"==typeof c?c-r.data.meta.times[o].range[0]:0)-d.time_range[o][0],h=d.views[this.view].summaries[o],p=ie(this.palette).toLowerCase(),u=p in e?p:r.settings.palette in e?r.settings.palette:a.palette,m=e[u].colors,f=this.parts.scale,b=this.ticks;if(this.parsed.summary=h,this.parsed.order=d.views[this.view].order[o][i],this.parsed.time=i,this.parsed.color=n,h&&i<h.n.length){this.integer=!r.data.variable_info[n]||!r.data.variable_info[n].type||t.int_types.test(r.data.variable_info[n].type);const a=r.settings.color_by_order!==this.parsed.rank,o=f.querySelectorAll("span"),c=e[u].odd,p="discrete"===e[u].type?m.length!==o.length-c:!f.firstElementChild||"SPAN"!==f.firstElementChild.tagName;if(u+r.settings.color_scale_center!==this.current_palette||a)if(this.current_palette=u+r.settings.color_scale_center,this.parsed.rank=r.settings.color_by_order,p&&(f.innerHTML=""),"discrete"===e[u].type){let e,t=0,i=Math.ceil(m.length/2);if(p){f.appendChild(e=l.createElement("div")),e.dataset.of=this.id,e.style.left=0;const a=1/(i-c/2)*100+"%";for(;t<i;t++)e.appendChild(l.createElement("span")),e.lastElementChild.dataset.of=this.id,e.lastElementChild.style.backgroundColor=m[t],e.lastElementChild.style.width=a;for(c&&(e.lastElementChild.style.width=1/(i-c/2)*100/2+"%"),f.appendChild(e=l.createElement("div")),e.dataset.of=this.id,e.style.right=0,t=Math.floor(m.length/2),i=m.length;t<i;t++)e.appendChild(l.createElement("span")),e.lastElementChild.dataset.of=this.id,e.lastElementChild.style.backgroundColor=m[t],e.lastElementChild.style.width=a;c&&(e.firstElementChild.style.width=1/(i-c/2)*100/2+"%")}else{for(;t<i;t++)o[t].style.backgroundColor=m[t];for(t=Math.floor(m.length/2),i=m.length;t<i;t++)o[t+c].style.backgroundColor=m[t]}}else p&&(f.appendChild(l.createElement("span")),f.appendChild(l.createElement("span"))),f.firstElementChild.style.background="linear-gradient(0.25turn, rgb("+m[2][0][0]+", "+m[2][0][1]+", "+m[2][0][2]+"), rgb("+m[1][0]+", "+m[1][1]+", "+m[1][2]+"))",f.lastElementChild.style.background="linear-gradient(0.25turn, rgb("+m[1][0]+", "+m[1][1]+", "+m[1][2]+"), rgb("+m[0][0][0]+", "+m[0][0][1]+", "+m[0][0][2]+"))";if("string"===d.type)b.center.classList.remove("hidden"),b.min.firstElementChild.firstElementChild.innerText=d.levels[0],b.max.firstElementChild.firstElementChild.innerText=d.levels[d.levels.length-1];else if(r.settings.color_by_order)b.center.classList.add("hidden"),b.min.firstElementChild.firstElementChild.innerText="# "+(h.n[i]?h.n[i]:0),b.max.firstElementChild.firstElementChild.innerText="# "+(h.n[i]?1:0);else{const e=""+h.n[i]+h.min[i]+h.max[i]+r.settings.digits+r.settings.color_scale_center+r.settings.summary_selection;(p||a||e!==this.state)&&(this.state=e,b.center.classList.remove("hidden"),b.min.firstElementChild.firstElementChild.innerText=h.n[i]&&isFinite(h.min[i])?r.data.format_value(h.min[i],this.integer):NaN,b.max.firstElementChild.firstElementChild.innerText=h.n[i]&&isFinite(h.max[i])?r.data.format_value(h.max[i],this.integer):NaN,"none"===r.settings.color_scale_center?(b.center.firstElementChild.lastElementChild.innerText=s[r.settings.summary_selection]+" median",b.center.firstElementChild.children[1].innerText=r.data.format_value(h.median[i]),b.center.style.left=100*h.norm_median[i]+"%"):(b.center.firstElementChild.lastElementChild.innerText=s[r.settings.summary_selection]+" "+r.settings.color_scale_center,b.center.firstElementChild.children[1].innerText=r.data.format_value(h[r.settings.color_scale_center][i]),b.center.style.left=100*h["norm_"+r.settings.color_scale_center][i]+"%"),b.center.style.marginLeft=-b.center.getBoundingClientRect().width/2+"px")}r.settings.color_by_order||"none"===r.settings.color_scale_center?(f.firstElementChild.style.width="50%",f.lastElementChild.style.width="50%"):(f.firstElementChild.style.width=100*h["norm_"+r.settings.color_scale_center][i]+"%",f.lastElementChild.style.width=100-100*h["norm_"+r.settings.color_scale_center][i]+"%")}}},mouseover:function(e){if(this.queue.lock)this.queue.cooldown>0&&clearTimeout(this.queue.cooldown),this.queue.e=e,this.queue.cooldown=setTimeout(this.queue.trigger,100);else{this.queue.lock=!0;const t=this.parts.scale.getBoundingClientRect(),i=(Math.max(t.x,Math.min(t.x+t.width,e.clientX))-t.x)/t.width;let a=!1;if(r.settings.color_by_order)this.parsed.order&&this.parsed.order.length&&(a=r.data.entities[this.parsed.order[Math.max(this.parsed.summary.missing[this.parsed.time],Math.min(this.parsed.order.length-1,Math.floor((this.parsed.order.length-1)*i)))][0]]);else if("min"in this.parsed.summary){const e=this.parsed.summary.min[this.parsed.time],t=e+i*(this.parsed.summary.max[this.parsed.time]-e);let s,n;if(this.parsed.order&&this.parsed.order.length&&(n=this.parsed.summary.missing[this.parsed.time],n<this.parsed.order.length))if(1!==this.parsed.order.length&&i){for(s=this.parsed.order.length-2;s>=n&&!((this.parsed.order[s][1]+this.parsed.order[s+1][1])/2<=t);--s);s++,a=r.data.entities[this.parsed.order[s][0]]}else a=r.data.entities[this.parsed.order[n][0]]}a&&(this.show(a,this),this.entity&&a.features.id===this.entity.features.id||(this.entity?B(this.id,"revert",this.entity):this.entity=a,B(this.id,"show",a),this.entity=a)),setTimeout(this.queue.reset,200)}},mouseout:function(e){e.relatedTarget&&this.id!==e.relatedTarget.getAttribute("data-of")&&(this.queue.cooldown>0&&clearTimeout(this.queue.cooldown),this.queue.cooldown=-1,this.revert(),this.entity&&(B(this.id,"revert",this.entity),this.entity=!1))},click:function(){this.clickto&&this.entity&&(this.revert(),this.clickto.set(this.entity.features.id))}},credits:{init:function(e){const t=r.credit_output&&r.credit_output[e.id];e.exclude=t&&t.exclude||[],e.add=t&&t.add||{},e.e.appendChild(l.createElement("ul")),e.credits={...r.credits,...e.add},Object.keys(e.credits).forEach((t=>{if(-1===e.exclude.indexOf(t)){const i=e.credits[t];let a;e.e.lastElementChild.appendChild(a=l.createElement("li")),"url"in i&&(a.appendChild(a=l.createElement("a")),a.href=i.url,a.target="_blank",a.rel="noreferrer"),a.innerText=i.name,"version"in i&&(a.appendChild(l.createElement("span")),a.lastElementChild.className="version-tag",a.lastElementChild.innerText=i.version),"description"in i&&(a.parentElement.appendChild(l.createElement("p")),a.parentElement.lastElementChild.innerText=i.description)}}))}},init_input:function(e){const i={type:e.getAttribute("data-autoType"),source:void 0,value:function(){const e=ie(this.source);return void 0===e?ie(this.default):e},default:e.getAttribute("data-default"),optionSource:e.getAttribute("data-optionSource"),depends:e.getAttribute("data-depends"),variable:e.getAttribute("data-variable"),dataset:e.getAttribute("data-dataset"),view:e.getAttribute("data-view"),id:e.id||e.optionSource||"ui"+b.elementCount++,note:e.getAttribute("aria-description")||"",current_index:-1,previous:"",e:e,values:[],display:[],data:[],input:!0};if(i.settings=i.type in r&&i.id in r[i.type]?r[i.type][i.id]:{},i.wrapper=i.e.parentElement.classList.contains("wrapper")?i.e.parentElement:i.e.parentElement.parentElement,i.wrapper&&(i.note&&i.wrapper.classList.add("has-note"),i.wrapper.setAttribute("data-of",i.id),["div","span","label","fieldset","legend","input","button"].forEach((e=>{const t=i.wrapper.querySelectorAll(e);t.length&&t.forEach((e=>e.setAttribute("data-of",i.id)))}))),i.note){i.wrapper.addEventListener("mouseover",ae.bind(i));const e="DIV"!==i.e.tagName?i.e:i.e.querySelector("input");e&&(e.addEventListener("focus",ae.bind(i)),e.addEventListener("blur",se))}if(t.number.test(i.default)&&(i.default=Number(i.default)),i.type in c){const e=c[i.type];e.setter&&(i.set=e.setter.bind(i),i.reset=function(){this.set(ie(this.default))}.bind(i)),e.retrieve&&(i.get=e.retrieve.bind(i)),e.adder&&(i.add=e.adder.bind(i)),e.listener&&(i.listen=e.listener.bind(i)),e.init&&e.init(i),i.options||(i.options=i.e.querySelectorAll("select"===i.type?"option":"input")),i.optionSource&&t.ids.test(i.optionSource)?(i.loader=function(){this.e.classList.contains("locked")||(this.deferred=!1,this.e.removeEventListener("click",this.loader),ce(this.id))}.bind(i),i.e.addEventListener("click",i.loader),i.deferred=!0):"number"==typeof i.default&&i.default>-1&&i.options&&i.options.length&&i.default<i.options.length&&(i.default=i.options[i.default].value||i.options[i.default].dataset.value),x[i.id]=i}},init_output:function(e,t){const i={type:e.getAttribute("data-autoType"),view:e.getAttribute("data-view")||a.dataview,id:e.id||"out"+t,note:e.getAttribute("aria-description")||"",reference_options:{},e:e};i.note&&i.e.addEventListener("mouseover",ae.bind(i)),i.options=i.type in r?r[i.type][i.id]:void 0,i.options&&i.options.dataview&&(i.view=i.options.dataview),i.type in c&&"update"in c[i.type]&&(i.update=c[i.type].update.bind(i)),i.options&&("options"in i.options&&(i.options=i.options.options),Object.keys(i.options).forEach((e=>{i.options[e]in x&&(i.reference_options[e]=i.options[e])})),"subto"in i.options&&("string"==typeof i.options.subto&&(i.options.subto=[i.options.subto]),Array.isArray(i.options.subto)&&i.options.subto.forEach((e=>M(e,i))))),x[i.id]=i,i.type in c&&"init"in c[i.type]&&(!i.view||x[i.view].parsed.dataset in r.data.inited?c[i.type].init(i):r.data.data_queue[x[i.view].parsed.dataset][i.id]=c[i.type].init.bind(null,i))}},h={name:n.location.pathname||"default",perm:n.localStorage||{setItem:function(){},getItem:function(){},removeItem:function(){}},set:function(e,t){const i=JSON.parse(this.perm.getItem(this.name))||{};i[e]=t,this.perm.setItem(this.name,JSON.stringify(i))},get:function(e){const t=JSON.parse(this.perm.getItem(this.name));return t?e?t[e]:t:void 0}},u={Enter:"select",NumpadEnter:"select",ArrowUp:"move",Home:"move",ArrowDown:"move",End:"move",Escape:"close",Tab:"close"},m={Time:["first","selected","last"],summary:["missing","min","q1","mean","median","q3","max"]},f={number:function(e){return this-e.range[0]},first:function(e){return 0},selected:function(e,t){return t.time_agg-e.range[0]},last:function(e){return e.range[1]-e.range[0]}},b={load_screen:l.getElementById("load_screen"),wrap:l.getElementById("site_wrap"),navbar:l.querySelector(".navbar"),content:l.querySelector(".content"),overlay:l.createElement("div"),menus:l.getElementsByClassName("menu-wrapper"),panels:l.getElementsByClassName("panel"),elementCount:0},_={_timeout:0},g={retain_state:!0},v={},y={},E={},x={_entity_filter:{id:"_entity_filter",registered:{},entities:new Map,selected:[],select_ids:{},value:function(e,t){return Object.keys(this.select_ids).join(",")}},_base_filter:{id:"_base_filter",c:new Map,value:function(e,t){const i=!e;return i&&(e=[]),x._base_filter.c.forEach((s=>{const n="selected"===s.component?r.data.meta.overall.value[void 0===t?x[a.dataview].parsed.time_agg:t]:s.time_component?r.data.meta.overall.value[s.component]:s.component;s.value&&e.push(s.variable+"["+n+"]"+s.operator+s.value+(i?s.active:""))})),e.join("&")}}},C={},w={};if(b.overlay.className="content-overlay",l.body.appendChild(b.overlay),l.body.className=h.get("theme_dark")||r.settings.theme_dark?"dark-theme":"light-theme",b.content){let e=b.menus.length,t=b.navbar?b.navbar.getBoundingClientRect().height:0;for(;e--;)if(b.menus[e].classList.contains("menu-top")){t=b.menus[e].getBoundingClientRect().height;break}b.content.style.top=t+"px"}function k(i,s,n,l,o,d){if(isNaN(i))return a.missing;const c="none"!==r.settings.color_scale_center&&!r.settings.color_by_order,h="discrete"===e[s].type,p=e[s].colors,u=e[s].odd,m="string"===n.type,f=m?0:n.min[l],b=m?n.levels.length-f:n.range[l],_="none"===r.settings.color_scale_center||t.median.test(r.settings.color_scale_center)?"median":"mean",g=r.settings.color_by_order?c?n["break_"+_][l]/d:.5:isNaN(n["norm_"+_][l])?.5:n["norm_"+_][l],v=h?c&&!r.settings.color_by_order?Math.ceil(p.length/2)-u/2:p.length:1,y=r.settings.color_by_order?o/d:b?((m?n.level_ids[i]:i)-f)/b:.5,E=y>(c?g:.5);let x=c?b?E?(y-g-n["upper_"+_+"_min"][l])/n["upper_"+_+"_range"][l]:(y+g-n["lower_"+_+"_min"][l])/n["lower_"+_+"_range"][l]:1:y;return h||(x=Math.max(0,Math.min(1,x)),E&&(x=1-x),c||(x*=2)),(m?i in n.level_ids:"number"==typeof i)?h?p[Math.max(0,Math.min(p.length-1,Math.floor(c&&E?v+v*x:v*x)))]:"rgb("+(E?p[0][0][0]+x*p[0][1][0]+", "+(p[0][0][1]+x*p[0][1][1])+", "+(p[0][0][2]+x*p[0][1][2]):p[2][0][0]+x*p[2][1][0]+", "+(p[2][0][1]+x*p[2][1][1])+", "+(p[2][0][2]+x*p[2][1][2]))+")":a.missing}function T(e,t){if("button"in t||(t.button={}),"string"==typeof t.text&&(t.text=[t.text]),t.parts=l.createElement("span"),t.text.forEach((i=>{if(i in t.button){const a=t.button[i];if(t.parts.appendChild(l.createElement("button")),t.parts.lastElementChild.type="button",a.trigger=ae.bind({id:e.id+a.text,note:a.target,wrapper:t.parts.lastElementChild}),"note"===a.type)t.parts.lastElementChild.setAttribute("aria-description",a.target),t.parts.lastElementChild.setAttribute("data-of",e.id+a.text),t.parts.lastElementChild.className="has-note",t.parts.lastElementChild.addEventListener("mouseover",a.trigger),t.parts.lastElementChild.addEventListener("focus",a.trigger),t.parts.lastElementChild.addEventListener("blur",se);else{t.parts.lastElementChild.className="btn btn-link",Array.isArray(a.target)||(a.target=[a.target]);const e=new Map;a.target.forEach((t=>{const i=x[t];i&&"function"==typeof i[a.type]&&e.set(t,i[a.type])})),e.size&&(t.parts.lastElementChild.setAttribute("aria-label",a.text.join("")),t.parts.lastElementChild.addEventListener("click",function(){this.forEach((e=>e()))}.bind(e)))}}else t.parts.appendChild(l.createElement("span"));i in x&&e.depends.set(i,{id:i,u:x[i],parsed:""})})),"condition"in t)for(let i=t.condition.length;i--;){const a=t.condition[i];a.id&&("default"===a.id?a.check=function(){return!0}:(e.depends.set(a.id,a),a.check=function(){return"default"===this.id||DataHandler.checks[this.type](ie(this.id),ie(this.value))}.bind(a)))}}function N(e,i,a,s){if(!(i in r.data.sets))return void(r.data.data_queue[i][e.id]=function(){e.e.removeEventListener("click",e.loader),N(e,i,a,s),e.set_current(),e.current_set=i});a[i]={options:[],values:{},display:{}};const n=e.values,o=a[i].options,d=a[i].values,c=a[i].display,h="combobox"===e.type;let p=!e.sensitive&&!!e.current_set,u=0;e.settings.group&&(e.groups={e:[],by_name:{}},h&&e.settings.accordion&&(e.listbox.classList.add("accordion"),e.listbox.id=e.id+"-listbox")),Object.keys(r.data.entities).forEach((a=>{const s=r.data.entities[a];if(i===s.group)if(p&&!(a in n)&&(e.sensitive=!0,p=!1),e.groups){let i=s.features[e.settings.group]||["No Group"];Array.isArray(i)||(i=[i]);for(let n=i.length;n--;){const r=i[n];if(!(r in e.groups.by_name)){const i=l.createElement(h?"div":"optgroup");if(h){const a=e.id+"_"+r.replace(t.seps,"-");let s;e.settings.accordion?(i.setAttribute("data-group",r),i.className="combobox-group accordion-item combobox-component",i.appendChild(s=l.createElement("div")),s.id=a+"-label",s.className="accordion-header combobox-component",s.appendChild(s=l.createElement("button")),s.innerText=r,s.type="button",s.className="accordion-button combobox-component collapsed",s.setAttribute("data-bs-toggle","collapse"),s.setAttribute("data-bs-target","#"+a),s.setAttribute("aria-expanded",!1),s.setAttribute("aria-controls",a),i.appendChild(s=l.createElement("div")),s.id=a,s.className="combobox-component accordion-collapse collapse",s.setAttribute("aria-labelledby",a+"-label"),s.setAttribute("data-bs-parent","#"+e.id+"-listbox"),s.appendChild(s=l.createElement("div")),s.className="accordion-body combobox-component"):(i.className="combobox-group combobox-component",i.id=a,i.role="group",i.setAttribute("aria-labelledby",a+"-label"),i.appendChild(s=l.createElement("div")),s.appendChild(s=l.createElement("label")),s.innerText=r,s.id=a+"-label",s.for=a,s.className="combobox-group-label combobox-component")}else i.label=r;e.groups.by_name[r]=i,e.groups.e.push(i)}const o=e.add(a,s.features.name,!0);o.setAttribute("data-group",r),h&&e.settings.accordion?e.groups.by_name[r].lastElementChild.lastElementChild.appendChild(o):e.groups.by_name[r].appendChild(o)}}else o.push(e.add(a,s.features.name)),d[a]=u,c[s.features.name]=u++})),e.settings.group&&(u=0,Object.keys(e.groups.by_name).forEach((t=>{e.groups.by_name[t].querySelectorAll(h?".combobox-option":"option").forEach((e=>{o.push(e),d[h?e.dataset.value:e.value]=u,c[e.innerText]=u++}))}))),s&&s()}function A(e,i,s){s[i]={options:[],values:{},display:{}};const n=e.values,o=s[i].options,d=s[i].values,c=s[i].display,h="combobox"===e.type;let p=!e.sensitive&&!!e.current_set,u=0;e.settings.group&&(e.groups={e:[],by_name:{}},h&&e.settings.accordion&&(e.listbox.classList.add("accordion"),e.listbox.id=e.id+"-listbox"));const m=r.url_options[e.id];let f=!1;m&&!(m in r.data.variables)&&(r.url_options[e.id]=m.replace(t.pre_colon,""),r.url_options[e.id]in r.data.variables||(f=!0)),r.data.info[i].schema.fields.forEach((i=>{const a=r.data.variables[i.name];if(a&&!a.is_time){const a=r.data.format_label(i.name);if(p&&!(P in n)&&(e.sensitive=!0,p=!1),e.groups){let s=i.info&&i.info[e.settings.group]||["No Group"];Array.isArray(s)||(s=[s]);for(let n=s.length;n--;){const r=s[n];if(!(r in e.groups.by_name)){const i=l.createElement(h?"div":"optgroup");if(h){const a=e.id+"_"+r.replace(t.seps,"-");let s;e.settings.accordion?(i.setAttribute("data-group",r),i.className="combobox-group accordion-item combobox-component",i.appendChild(s=l.createElement("div")),s.id=a+"-label",s.className="accordion-header combobox-component",s.appendChild(s=l.createElement("button")),s.innerText=r,s.type="button",s.className="accordion-button combobox-component collapsed",s.setAttribute("data-bs-toggle","collapse"),s.setAttribute("data-bs-target","#"+a),s.setAttribute("aria-expanded",!1),s.setAttribute("aria-controls",a),i.appendChild(s=l.createElement("div")),s.id=a,s.className="combobox-component accordion-collapse collapse",s.setAttribute("aria-labelledby",a+"-label"),s.setAttribute("data-bs-parent","#"+e.id+"-listbox"),s.appendChild(s=l.createElement("div")),s.className="accordion-body combobox-component"):(i.className="combobox-group combobox-component",i.role="group",i.setAttribute("aria-labelledby",a),i.appendChild(s=l.createElement("div")),s.appendChild(s=l.createElement("label")),s.innerText=r,s.id=a,s.className="combobox-group-label combobox-component")}else i.label=r;e.groups.by_name[r]=i,e.groups.e.push(i)}const o=e.add(i.name,a,!0,i);o.setAttribute("data-group",r),h&&e.settings.accordion?e.groups.by_name[r].lastElementChild.lastElementChild.appendChild(o):e.groups.by_name[r].appendChild(o)}}else o.push(e.add(i.name,a,!0,i)),o[u].id=e.id+"-option"+u,d[i.name]=u,c[a]=u++;f&&m===i.name.replace(t.pre_colon,"")&&(r.url_options[e.id]=i.name,f=!1)}})),e.settings.group&&(u=0,Object.keys(e.groups.by_name).forEach((t=>{e.groups.by_name[t].querySelectorAll(h?".combobox-option":"option").forEach((t=>{o.push(t),o[u].id=e.id+"-option"+u,d[h?t.dataset.value:t.value]=u,c[t.firstChild&&t.firstChild.textContent||t.innerText]=u++}))}))),e.default in r.data.variables||(e.default=a.variable)}function q(e,t,i,a){const s=r.data.variables[i].info[t],n="string"===s.type?"levels":"ids",l=s[n];if(l){const s=t+i;a[s]={options:[],values:{},display:{}};const n=e.values,r=a[s].options,o=a[s].values,d=a[s].display;let c=!e.sensitive&&!!e.current_set,h=0;Object.keys(l).forEach((t=>{const i=l[t];c&&!(t in n)&&(e.sensitive=!0,c=!1),r.push(e.add(i.id,i.name,!0)),o[i.id]=h,d[i.name]=h++}))}else"ids"===n&&(r.data.data_queue[t][e.id]=function(){return q(e,t,i,a)})}function O(e,t){t&&!e.e.classList.contains("locked")?(e.e.removeAttribute("disabled"),e.e.classList.remove("disabled"),e.input_element&&e.input_element.removeAttribute("disabled")):(e.e.setAttribute("disabled",!0),e.e.classList.add("disabled"),e.input_element&&e.input_element.setAttribute("disabled",!0))}function S(e,t){return e.id in w&&t.id in w?w[e.id]._n.children-w[t.id]._n.children:-1/0}function j(e,t){e in C||(C[e]=[]),t.uid||(t.uid=JSON.stringify(t));const i=C[e];for(let e=i.length;e--;)if(t.uid===i[e].uid)return;i.push(t),e in w||(w[e]={_n:{children:0,parents:0},children:{},parents:{}}),t.id in w||(w[t.id]={_n:{children:0,parents:0},children:{},parents:{}}),w[e].children[t.id]=w[t.id],w[e]._n.children++,w[t.id].parents[e]=w[e],w[t.id]._n.parents++,i.sort(S),ce(e)}function M(e,t){e in v||(v[e]=[]),v[e].push(t)}function B(e,t,i){if(e in v)for(let a=v[e].length;a--;)t in v[e][a]&&v[e][a][t](i,x[e])}function I(e){if(e.dark_theme!==r.settings.theme_dark){e.dark_theme=r.settings.theme_dark;const t=getComputedStyle(l.body);"style"in e||(e.style=e.options.layout,"font"in e.style||(e.style.font={}),"modebar"in e.style||(e.style.modebar={}),"font"in e.style.xaxis||(e.style.xaxis.font={}),"font"in e.style.yaxis||(e.style.yaxis.font={})),e.style.paper_bgcolor=t.backgroundColor,e.style.plot_bgcolor=t.backgroundColor,e.style.font.color=t.color,e.style.modebar.bgcolor=t.backgroundColor,e.style.modebar.color=t.color,e.e._fullLayout.xaxis.showgrid&&(e.style.xaxis.gridcolor=t.borderColor),e.e._fullLayout.yaxis.showgrid&&(e.style.yaxis.gridcolor=t.borderColor),e.style.xaxis.font.color=t.color,e.style.yaxis.font.color=t.color,Plotly.relayout(e.e,e.options.layout)}}function R(e,t,i,s,n,l){if(t.data&&e.parsed.x in r.data.variables){const o=r.data.get_value({variable:e.parsed.x,entity:t}),d=r.data.get_value({variable:e.parsed.y,entity:t}),c=JSON.parse(e.traces[e.base_trace]),h=r.data.variables[e.parsed.y].time_range[e.parsed.dataset],p=r.data.variables[e.parsed.x].time_range[e.parsed.dataset],u=Math.min(h[1],p[1])+1,m=e.parsed.summary.n;for(let i=Math.max(h[0],p[0]);i<u;i++)(r.settings.show_empty_times||m[i-e.parsed.y_range[0]])&&(c.text.push(t.features.name),c.x.push(e.parsed.x_range[0]<=i&&i<=e.parsed.x_range[1]?o[i-e.parsed.x_range[0]]:NaN),c.y.push(e.parsed.y_range[0]<=i&&i<=e.parsed.y_range[1]?d[i-e.parsed.y_range[0]]:NaN));return c.type=e.parsed.base_trace,c.color=c.line.color=c.marker.color=c.textfont.color=l||k(t.get_value(e.parsed.color,e.parsed.time),e.parsed.palette,e.parsed.summary,e.parsed.time,i,s)||a.border,"bar"===c.type&&(c.marker.line.width=0),c.name=n||t.features.name,c.id=t.features.id,c}}function D(e){Array.isArray(e.author)||(e.author=[e.author]);const i=l.createElement("li"),a=e.author.length;let s="",n=1===a?"":2===a?" & ":", & ";for(let t=a;t--;){const i=e.author[t];s=(t?n:"")+("string"==typeof i?i:i.family)+(i.given?", "+i.given.substring(0,1)+".":"")+s,n=", "}return i.innerHTML=s+" ("+e.year+"). "+e.title+"."+(e.journal?" <em>"+e.journal+(e.volume?", "+e.volume:"")+"</em>"+(e.page?", "+e.page:"")+".":"")+(e.version?" Version "+e.version+".":"")+(e.doi||e.url?(e.doi?" doi: ":" url: ")+(e.doi||e.url?'<a rel="noreferrer" target="_blank" href="'+(e.doi?"https://doi.org/"+e.doi:e.url)+'">'+(e.doi||e.url.replace(t.http,""))+"</a>":""):""),i}function F(e,t){const i=l.createElement(t?"tr":"div");let a;return t?(e.name&&(i.appendChild(a=l.createElement("td")),e.url?(a.appendChild(a=l.createElement("a")),a.target="_blank",a.rel="noreferrer",a.href=e.url):a.appendChild(l.createElement("span")),i.firstElementChild.firstElementChild.innerText=e.name),e.date_accessed&&(i.appendChild(a=l.createElement("td")),a.appendChild(l.createElement("span")),a.firstElementChild.innerText=e.date_accessed)):(i.className="card",e.name&&(i.appendChild(a=l.createElement("div")),a.className="card-header",e.url?(a.appendChild(a=l.createElement("a")),a.target="_blank",a.rel="noreferrer",a.href=e.url):a.appendChild(l.createElement("span")),i.firstElementChild.firstElementChild.innerText=e.name),i.appendChild(l.createElement("div")),i.lastElementChild.className="card-body",e.location&&(i.lastElementChild.appendChild(a=l.createElement("p")),a.appendChild(l.createElement("span")),a.lastElementChild.innerText="Location: ",a.appendChild(l.createElement("span")),e.location_url?(a.lastElementChild.appendChild(a=l.createElement("a")),a.target="_blank",a.rel="noreferrer",a.href=e.location_url,a.innerText=e.location):a.lastElementChild.innerText=e.location),e.date_accessed&&(i.lastElementChild.appendChild(a=l.createElement("p")),a.appendChild(l.createElement("span")),a.lastElementChild.innerText="Date Accessed: ",a.appendChild(l.createElement("span")),a.lastElementChild.innerText=e.date_accessed)),i}function H(){const e=x[this.view],i=ie(this.v||e.y),a=r.data.variable_info[i];if(b.modal.info.header.firstElementChild.innerText=a.short_name,b.modal.info.title.innerText=a.long_name,function(e,i){var a=i.long_description||i.description||i.short_description||"",s=t.has_equation.test(a);if(s)for(var n=a.split(t.bracket_content),l=n.length;l--;){var r=n[l];if(r&&"/"!==r.substring(0,1)){var o=r.split(t.space),d=o.length;if(!(s=t.math_tags.test(o[0])))break;for(var c=1;c<d&&(s=t.math_attributes.test(o[c]));c++);if(!s)break}}e[s?"innerHTML":"innerText"]=a}(b.modal.info.description,a),b.modal.info.name.lastElementChild.innerText=i,b.modal.info.type.lastElementChild.innerText=a.type||"",a.sources&&a.sources.length?(b.modal.info.sources.lastElementChild.innerHTML="",b.modal.info.sources.classList.remove("hidden"),a.sources.forEach((e=>{b.modal.info.sources.lastElementChild.appendChild(F(e))}))):b.modal.info.sources.classList.add("hidden"),a.citations&&a.citations.length){if(b.modal.info.references.lastElementChild.innerHTML="",b.modal.info.references.classList.remove("hidden"),"string"==typeof a.citations&&(a.citations=[a.citations]),"references"in r.data&&(delete r.data.variable_info._references,delete r.data.references),!("_references"in r.data.variable_info)){const e={};r.data.variable_info._references=e,Object.keys(r.data.info).forEach((t=>{const i=r.data.info[t];"_references"in i&&Object.keys(i._references).forEach((t=>{t in e||(e[t]={reference:i._references[t],element:D(i._references[t])})}))}))}const e=r.data.variable_info._references;a.citations.forEach((t=>{t in e&&b.modal.info.references.lastElementChild.appendChild(e[t].element)}))}else b.modal.info.references.classList.add("hidden")}function z(e,a,s,n){if("statement"===a)for(let a,l;a=t.mustache.exec(e);)"value"===a[1]?(l=n?r.data.format_value(n.get_value(s.v,s.time),t.int_types.test(r.data.variable_info[s.v].type)):NaN,e=e.replace(a[0],NaN!==l&&r.data.variable_info[s.v].type in i?i[r.data.variable_info[s.v].type](l):l),t.mustache.lastIndex=0):n&&("region_name"===a[1]?(e=e.replace(a[0],n.features.name),t.mustache.lastIndex=0):t.features.test(a[1])?(e=e.replace(a[0],n.features[a[1].replace(t.features,"")]),t.mustache.lastIndex=0):t.variables.test(a[1])?(e=e.replace(a[0],n.variables[s.v][a[1].replace(t.variables,"")]),t.mustache.lastIndex=0):t.data.test(a[1])&&(e=e.replace(a[0],n.get_value(a[1].replace(t.data,""),s.time)),t.mustache.lastIndex=0));return e}let P,G,J,V,U;if(n.dataLayer||(n.dataLayer=[]),r.query=P=n.location.search.replace("?",""),r.url_options={},P)for(J=P.split("&"),G=J.length;G--;)U=J[G].split("="),U.length<2&&U.push("true"),U[1]=t.bool.test(U[1])?!!U[1]||"true"===U[1]:U[1].replace(t.url_spaces," "),r.url_options[U[0]]=U[1],t.settings.test(U[0])&&h.set(U[0].replace(t.settings,""),U[1]);if(("embedded"in r.url_options||"hide_navbar"in r.url_options)&&("hide_logo"in r.url_options||(r.url_options.hide_logo=!0),"hide_title"in r.url_options||(r.url_options.hide_title=!0),"hide_navcontent"in r.url_options||(r.url_options.hide_navcontent=!0),"hide_panels"in r.url_options||(r.url_options.hide_panels=!0),"embedded"in r.url_options&&!("close_menus"in r.url_options)&&(r.url_options.close_menus=!0)),J=b.navbar,J&&(J.querySelectorAll("button").forEach((e=>{const t=l.querySelector(e.getAttribute("data-bs-target"));t&&"false"===t.getAttribute("data-bs-backdrop")&&(t.addEventListener("show.bs.offcanvas",(function(){b.content_bounds.outer_right=t.getBoundingClientRect().width,K(void 0,!0),setTimeout(W,200)})),t.addEventListener("hide.bs.offcanvas",(function(){b.content_bounds.outer_right=0,K(void 0,!0),setTimeout(W,200)})))})),"navcolor"in r.url_options&&(""===r.url_options.navcolor&&(r.url_options.navcolor=n.location.hash),J.style.backgroundColor=r.url_options.navcolor.replace("%23","#")),r.url_options.hide_logo&&r.url_options.hide_title&&r.url_options.hide_navcontent?J.classList.add("hidden"):(J=l.querySelector(".navbar-brand"),J&&(r.url_options.hide_logo&&"IMG"===J.firstElementChild.tagName&&J.firstElementChild.classList.add("hidden"),r.url_options.hide_title&&"IMG"!==J.lastElementChild.tagName&&J.lastElementChild.classList.add("hidden")),r.url_options.hide_navcontent&&(l.querySelector(".navbar-toggler").classList.add("hidden"),J=l.querySelector(".navbar-nav"),J&&J.classList.add("hidden"))),r.url_options.hide_panels&&b.panels.length))for(G=b.panels.length;G--;)b.panels[G].classList.add("hidden");if(h.copy=h.get(),h.copy)for(const e in r.settings)if(e in h.copy){let i=h.copy[e];t.bool.test(i)?i=!!i||"true"===i:t.number.test(i)&&(i=parseFloat(i)),r.settings[e]=i}function Q(e,t,i){const a=i.length;let s=i[0][e]+t*i[1][e],n=2;for(;n<a;n++)s+=Math.pow(t,n)*i[n][e];return Math.max(0,Math.min(255,s))}function X(){r.data.inited&&clearTimeout(r.data.inited.load_screen),b.wrap.style.visibility="visible",b.load_screen.style.display="none"}function Y(){n.localStorage&&h.perm.removeItem(h.name),n.location.reload()}function K(e,t){const i=b[t?"wrap":"content"];t||(i.style.top=(b.top_menu&&"open"===b.top_menu.state?b.top_menu.getBoundingClientRect().height:b.content_bounds.top+(!b.top_menu&&!b.left_menu&&!b.right_menu||b.right_menu&&"open"===b.right_menu.state||b.left_menu&&"open"===b.left_menu.state?0:40))+"px",i.style.bottom=b.content_bounds.bottom+(b.bottom_menu&&"closed"!==b.bottom_menu.state?b.bottom_menu.getBoundingClientRect().height:0)+"px",i.style.left=b.content_bounds.left+(b.left_menu&&"closed"!==b.left_menu.state?b.left_menu.getBoundingClientRect().width:0)+"px"),i.style.right=b.content_bounds[t?"outer_right":"right"]+(b.right_menu&&"closed"!==b.right_menu.state?b.right_menu.getBoundingClientRect().width:0)+"px"}function W(){"undefined"==typeof module&&n.dispatchEvent(new Event("resize"))}function Z(){let e="";return E._u.forEach((i=>{const a=x[i];if(a.input&&!t.settings.test(i)&&(!a.range||a.range[0]!==a.range[1])){let t=a.value();("off_default"in a?a.off_default:t!==a.default)&&(Array.isArray(t)&&(t=t.join(",")),""!==t&&null!=t&&"-1"!=t&&(e+=(e?"&":"?")+i+"="+t))}})),r.data&&x._base_filter.c.size&&(e+=(e?"&":"?")+x._base_filter.value([])),n.location.protocol+"//"+n.location.host+n.location.pathname+e}function ee(){function i(e,i){if("A"===e.target.tagName){i=i||{};const s=l.createElement("tr"),n={e:s,index:x._base_filter.c.size,variable:e.target.dataset.value,component:i.component||"last",operator:i.operator||">=",value:i.value||"",active:!0,id:"vf"+x._base_filter.c.size,passed:0,failed:0,info:r.data.variables[e.target.dataset.value].info,view:x[a.dataview]},o=n.view.get.dataset(),d=n.info[o].time_range,h=r.data.meta.overall.value;let p;s.setAttribute("data-index",x._base_filter.c.size),x._base_filter.c.set(x._base_filter.c.size,n),i.time_component&&(n.component=String(h[n.component])),s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("p")),p.className="cell-text",p.innerText=e.target.innerText+(d?" ("+h[d[0]]+"-"+h[d[1]]+")":""),s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("p")),p.className="cell-text",p.innerText="0/0",s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("label")),p.innerText="Active",p.className="filter-label",p.id=n.id+"_switch",s.lastElementChild.appendChild(p=l.createElement("div")),p.className="form-check form-switch filter-form-input",p.appendChild(p=l.createElement("input")),p.className="form-check-input",p.type="checkbox",p.role="switch",p.setAttribute("aria-labelledby",n.id+"_switch"),p.checked=!0,p.addEventListener("change",function(){n.active=!n.active,ce("_base_filter")}.bind(n)),s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("label")),p.innerText="Component",p.className="filter-label",p.id=n.id+"_component";const u=c.combobox.create("component",m.Time);u.default=n.component,u.set(n.component),s.lastElementChild.appendChild(u.e.parentElement),u.e.parentElement.removeChild(u.e.parentElement.lastElementChild),u.e.parentElement.classList.add("filter-form-input"),u.e.setAttribute("aria-labelledby",n.id+"_component"),u.input_element.setAttribute("aria-labelledby",n.id+"_component"),u.onchange=function(){n.component=this.value(),ce("_base_filter")}.bind(u),s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("label")),p.innerText="Operator",p.className="filter-label",p.id=n.id+"_operator",s.lastElementChild.appendChild(p=l.createElement("select")),p.className="form-select filter-form-input",p.setAttribute("aria-labelledby",n.id+"_operator"),p.addEventListener("change",(e=>{n.operator=e.target.selectedOptions[0].value,ce("_base_filter")})),[">=","=","!=","<="].forEach((e=>{p.appendChild(l.createElement("option")),p.lastElementChild.value=p.lastElementChild.innerText=e,e===n.operator&&(p.lastElementChild.selected=!0)})),s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("label")),p.innerText="Value",p.className="filter-label",p.id=n.id+"_value";const f=c.combobox.create("component",["min","q1","median","mean","q3","max"]);f.value_type="number",f.default=n.value,f.set(n.value),s.lastElementChild.appendChild(f.e.parentElement),f.e.parentElement.removeChild(f.e.parentElement.lastElementChild),f.e.parentElement.classList.add("filter-form-input"),f.e.setAttribute("aria-labelledby",n.id+"_value"),f.input_element.setAttribute("aria-labelledby",n.id+"_value"),f.onchange=async function(e){if(e.value=this.value(),t.number.test(e.value))e.value=Number(e.value),e.value_source="";else{e.view.reparse();const t=await r.data.get_variable(e.variable,e.view.id),i=t&&t.views[e.view.id].summaries[e.view.parsed.dataset];if(i&&e.value in i){const t=e.view.parsed.variable_values[e.index];e.value_source=e.value,e.value=i[e.value][t.comp_fun(t,e.view.parsed)]}}ce("_base_filter")}.bind(f,n),s.appendChild(l.createElement("td")),s.lastElementChild.appendChild(p=l.createElement("label")),p.innerText="Remove",p.className="filter-label",p.id=n.id+"_remove",s.lastElementChild.appendChild(p=l.createElement("button")),p.className="btn-close filter-form-input",p.type="button",p.setAttribute("aria-labelledby",n.id+"_remove"),p.addEventListener("mouseup",function(e){1===e.which&&(this.e.parentElement.removeChild(this.e),x._base_filter.c.delete(this.index),x._base_filter.c.forEach(((e,t)=>{t>this.index&&(e.index-=1)})),ce("_base_filter"))}.bind(n)),ce("_base_filter"),b.modal.filter.variable_filters.lastElementChild.lastElementChild.appendChild(s)}}r.data.variables&&(a.variable=Object.keys(r.data.variables),a.variable=a.variable[a.variable.length-1]),r.map||(r.map={}),r.map._overlay_property_selectors||(r.map._overlay_property_selectors=[]),E._u.forEach((async i=>{if(x[i].type in c){const s=x[i],n="combobox"===s.type;if(s.optionSource)if(t.palette.test(s.optionSource))s.options=[],Object.keys(e).forEach((t=>s.options.push(s.add(t,e[t].name)))),-1===s.default&&(s.default=a.palette);else if(t.datasets.test(s.optionSource))s.options=[],r.metadata.datasets.forEach((e=>s.options.push(s.add(e))));else{s.sensitive=!1,s.option_sets={},t.properties.test(s.optionSource)&&r.map._overlay_property_selectors.push(s),s.depends&&j(s.depends,{type:"options",id:s.id}),s.dataset in x&&j(s.dataset,{type:"options",id:s.id}),s.view&&j(s.view,{type:"options",id:s.id});const e=ie(s.dataset)||a.dataset;s.dataset||(s.dataset=e),e in r.data.info&&d.options(s)}if(n||"select"===s.type){if(s.set_current=d.set_current.bind(s),Array.isArray(s.values)){s.values={},s.display={};let e=!0;const t="select"===s.type;s.options.forEach((i=>{t&&(i.dataset.value=i.value),e&&(e=i.dataset.value===i.innerText)})),s.options.forEach(((t,i)=>{s.values[t.dataset.value]=i,e&&(t.innerText=r.data.format_label(t.dataset.value)),s.display[t.innerText]=i})),s.default in s.values||s.default in x||(s.default=Number(s.default),isNaN(s.default)&&(s.default=-1),-1!==s.default&&s.default<s.options.length?s.default=s.options[s.default].dataset.value:s.default=-1),s.source="",s.id in r.url_options?s.set(r.url_options[s.id]):s.reset()}s.subset=s.e.getAttribute("data-subset")||"all",s.selection_subset=s.e.getAttribute("data-selectionSubset")||s.subset,s.type in r&&s.id in r[s.type]&&(s.settings=r[s.type][s.id],s.settings.filters&&(s.filters=s.settings.filters,s.current_filter={},Object.keys(s.filters).forEach((e=>{j(s.filters[e],{type:"filter",id:s.id})})),s.filter=function(){let e;Object.keys(this.filters).forEach((e=>{this.current_filter[e]=ie(this.filters[e])})),Object.keys(this.values).forEach(((t,i)=>{let a=!1;if(t in r.data.variables&&"meta"in r.data.variables[t])for(const e in this.current_filter)if(e in r.data.variables[t].meta&&(a=r.data.variables[t].meta[e]===this.current_filter[e],!a))break;a&&!e&&(e=t),this.options[i].classList[a?"remove":"add"]("hidden")})),this.current_index=this.values[this.value()],e&&(-1===this.current_index||this.options[this.current_index].classList.contains("hidden"))&&this.set(e)}.bind(s)))}else if("number"===s.type){if(s.min=s.e.getAttribute("min"),s.min_ref=parseFloat(s.min),s.min_indicator=s.e.parentElement.parentElement.querySelector(".indicator-min"),s.min_indicator&&s.min_indicator.addEventListener("click",function(){this.set(this.parsed.min)}.bind(s)),s.max=s.e.getAttribute("max"),s.max_ref=parseFloat(s.max),s.max_indicator=s.e.parentElement.parentElement.querySelector(".indicator-max"),s.max_indicator&&s.max_indicator.addEventListener("click",function(){this.set(this.parsed.max)}.bind(s)),s.ref=isNaN(s.min_ref)||isNaN(s.max_ref),s.range=[s.min_ref,s.max_ref],s.step=parseFloat(s.e.step)||1,s.parsed={min:void 0,max:void 0},s.depends={},s.default_max="max"===s.default||"last"===s.default,s.default_min="min"===s.default||"first"===s.default,s.update=async function(){const e=x[this.view],i=ie(this.variable||e.y);e.time_range||(e.time_range={time:[]});let a=e.get?e.get.dataset():ie(this.dataset),s=ie(this.min)||e.time,n=ie(this.max)||e.time;t.minmax.test(s)&&(s=x[this.min][s]),t.minmax.test(n)&&(n=x[this.max][n]),this.parsed.min=isNaN(this.min_ref)?void 0===s?e.time_range.time[0]:"number"==typeof s?s:s in r.data.variables?r.data.variables[s].info[a||r.data.variables[s].datasets[0]].min:parseFloat(s):this.min_ref,this.parsed.max=isNaN(this.max_ref)?void 0===n?e.time_range.time[1]:"number"==typeof n?n:n in r.data.variables?r.data.variables[n].info[a||r.data.variables[n].datasets[0]].max:parseFloat(n):this.min_ref,this.default_min?this.current_default=this.parsed.min:this.default_max&&(this.current_default=this.parsed.max),this.ref&&i in r.data.variables?(this.range[0]=this.e.min=isNaN(this.min_ref)?Math.max(e.time_range.time[0],this.parsed.min):this.min_ref,this.range[1]=this.e.max=isNaN(this.max_ref)?Math.min(e.time_range.time[1],this.parsed.max):this.max_ref,this.depends[e.y]||(this.depends[e.y]=!0,j(e.y,{type:"update",id:this.id})),(this.source>this.parsed.max||this.source<this.parsed.min)&&this.reset(),this.variable=await r.data.get_variable(i,this.view)):(this.e.min=this.parsed.min,(this.parsed.min>this.source||!this.source&&this.default_min)&&this.set(this.parsed.min),this.e.max=this.parsed.max,(this.parsed.max<this.source||!this.source&&this.default_max)&&this.set(this.parsed.max))}.bind(s),s.view&&j(s.view,{type:"update",id:s.id}),s.max in r.data.variables?s.view&&j(s.view+"_time",{type:"max",id:s.id}):s.max in x?j(s.max,{type:"max",id:s.id}):s.e.max=parseFloat(s.max),s.min in r.data.variables?s.view&&j(s.view+"_time",{type:"min",id:s.id}):s.min in x?j(s.min,{type:"min",id:s.id}):s.e.min=parseFloat(s.min),void 0!==s.default&&(t.number.test(s.default)?s.default=Number(s.default):s.reset=s.default_max?function(){this.range&&(this.current_default=ie(this.range[1]),this.set(this.current_default))}.bind(s):s.default_max?function(){this.range&&(this.current_default=ie(this.range[0]),this.set(this.current_default))}.bind(s):this.default in x?function(){this.current_default=ie(this.default),this.set(this.current_default)}.bind(s):function(){}),s.variable){const e=-1===r.metadata.datasets.indexOf(s.dataset)?a.dataset:s.dataset;s.variable in x?j(s.variable,{type:"update",id:s.id}):s.variable in r.data.variables&&(s.e.min=s.min=s.parsed.min=s.range[0]=r.data.variables[s.variable].info[e].min,s.e.max=s.max=s.parsed.max=s.range[1]=r.data.variables[s.variable].info[e].max)}}else"checkbox"===s.type&&(s.source=[],s.current_index=[],s.default=s.default.split(","));Array.isArray(s.values)&&(s.values.length||(s.values=[],s.options.length&&s.options.forEach((e=>s.values.push(e.value||e.dataset.value)))),s.values.length&&!(s.default in x)&&-1===s.values.indexOf(s.default)&&(s.default=parseInt(s.default),s.default=s.values.length>s.default?s.values[s.default]:"")),n||"select"===s.type||"number"===s.type||"intext"===s.type?(s.e.addEventListener("change",s.listen),s.e.parentElement.lastElementChild&&s.e.parentElement.lastElementChild.classList.contains("select-reset")&&s.e.parentElement.lastElementChild.addEventListener("click",s.reset)):"switch"===s.type?("boolean"!=typeof s.default&&(s.default=s.e.checked),s.e.addEventListener("change",s.listen)):s.listen&&s.options.forEach((e=>e.addEventListener("click",s.listen))),t.settings.test(s.id)&&(s.setting=s.id.replace(t.settings,""),null==s.default&&s.setting in r.settings&&(s.default=r.settings[s.setting]),j(s.id,{type:"setting",id:s.id})),s.view||(s.view=a.dataview);const l=r.url_options[s.id]||h.get(s.id.replace(t.settings,""));l?s.set(t.bool.test(l)?!!l||"true"===l:l):s.reset&&s.reset()}})),Object.keys(r.dataviews).forEach((e=>{const t=r.dataviews[e];x[e]=t,t.id=e,t.value=function(){if(this.get)return this.reparse(),""+this.parsed.dataset+x._entity_filter.entities.size+r.data.inited[this.parsed.dataset]+this.parsed.id_source+Object.keys(this.parsed.ids)+this.parsed.features+this.parsed.variables+r.settings.summary_selection}.bind(t),"string"==typeof t.palette&&t.palette in x&&j(t.palette,{type:"dataview",id:e}),"string"==typeof t.dataset&&t.dataset in x&&j(t.dataset,{type:"dataview",id:e}),"string"==typeof t.ids&&t.ids in x&&j(t.ids,{type:"dataview",id:e}),t.time_range={dataset:"",variable:"",index:[],time:[],filtered:[]},j(e,{type:"time_range",id:e}),j("_base_filter",{type:"dataview",id:e}),j("_entity_filter",{type:"dataview",id:e}),t.x in x&&j(t.x,{type:"time_range",id:e}),t.y in x&&j(t.y,{type:"time_range",id:e}),t.features&&Object.keys(t.features).forEach((i=>{"string"==typeof t.features[i]&&t.features[i]in x&&j(t.features[i],{type:"dataview",id:e})})),t.variables&&t.variables.forEach((i=>{"variable"in i?i.variable in x&&j(i.variable,{type:"dataview",id:e}):t.variables.splice(G,1),"type"in i?i.type in x&&j(i.type,{type:"dataview",id:e}):i.type="=","value"in i?i.value in x&&j(i.value,{type:"dataview",id:e}):i.value=0})),function(e){e.times=[],e.time_filters&&(e.time_filters=[{variable:a.time,type:">=",value:"filter.time_min"},{variable:a.time,type:"<=",value:"filter.time_max"}],j(e.id+"_time",{type:"min",id:"filter.time_min"}),j(e.id+"_time",{type:"max",id:"filter.time_max"}),e.time_filters.forEach((t=>{t.value in x&&j(t.value,{type:"time_filters",id:e.id})})));e.selection={ids:{},features:{},variables:[],dataset:{},filtered:{},full_filter:{},all:{}},e.n_selected={ids:0,features:0,variables:0,dataset:0,filtered:0,full_filter:0,all:0},e.get={dataset:function(){return ie("string"==typeof e.dataset&&e.dataset in x?x[e.dataset].value():e.dataset)||a.dataset},ids:function(t){const i=ie("string"==typeof e.ids&&e.ids in x?x[e.ids].value():e.ids);if(""!==i&&-1!=i){if(t)return i;const e={},a=r.data.entities[i];return e[i]=!0,a&&a.relations&&Object.keys(a.relations.children).forEach((t=>e[t]=!0)),e}return!(t||!x._entity_filter.selected.length)&&x._entity_filter.select_ids},features:function(){let t="";return e.features&&Object.keys(e.features).forEach((i=>{t+=i+ie(e.features[i])})),t},variables:function(){if(e.variables||x._base_filter.c.size){e.parsed.variable_values.length||e.reparse();let t="";return e.parsed.variable_values.forEach((e=>{t+=e.name+e.operator+e.component+e.value+e.active})),t}return""},time_filters:function(){let t="";return e.time_filters&&e.time_filters.forEach((e=>{t+=e.value in x?ie(e.value):e.value})),t}},e.ids_check=function(e,t){return!e||t in e},e.parsed={dataset:"",ids:"",features:"",variables:"",time_filters:"",time_agg:0,id_source:"",variable_values:[],feature_values:{}},e.reparse=function(){if(this.parsed.dataset=this.get.dataset(),this.parsed.ids=this.get.ids(),this.parsed.time_filters=this.get.time_filters(),this.parsed.time_agg=this.parsed.dataset in r.data.meta.times?ie(this.time_agg)-r.data.meta.times[this.parsed.dataset].range[0]:0,"string"==typeof this.ids&&this.ids in x&&("virtual"===x[this.ids].type&&x[this.ids].source in x||"depends"in x[this.ids]&&x[this.ids].depends in x)&&(this.parsed.id_source="virtual"===x[this.ids].type?ie(x[x[this.ids].source].dataset):x[x[this.ids].depends].value()),this.features){this.parsed.feature_values={};for(let e in this.features)e in this.features&&(this.parsed.feature_values[e]={value:ie(this.features[e])},this.parsed.feature_values[e].operator="string"==typeof this.parsed.feature_values[e].value?"equals":"includes");this.parsed.features=this.get.features()}else this.parsed.features="";if(this.parsed.variable_values=[],x._base_filter.c.size&&x._base_filter.c.forEach((e=>{this.parsed.variable_values.push({filter:e,name:e.variable,range:r.data.variables[e.variable].info[this.parsed.dataset].time_range,operator:e.operator,value:e.value?Number(e.value):NaN,value_type:"number",component:e.component,active:e.active,comp_fun:re(e.component)})})),this.variables||this.parsed.variable_values.length){if(this.variables)for(let e,t=this.variables.length;t--;)e=ie(this.variables[t].value),this.parsed.variable_values.push({name:ie(this.variables[t].variable),operator:ie(this.variables[t].type),value:e,value_type:typeof e});this.parsed.variables=this.get.variables()}else this.parsed.variables=""}.bind(e),e.checks={dataset:function(e){return this.parsed.dataset===e.group}.bind(e),ids:function(e){return e.features&&this.ids_check(this.parsed.ids,e.features.id)}.bind(e),features:function(e){if(e.features){let t,i,a=!0;for(t in this.parsed.feature_values)if(t in this.parsed.feature_values&&(i=this.parsed.feature_values[t],a=DataHandler.checks[i.operator](i.value,ie(e.features[t])),!a))break;return a}return!0}.bind(e),variables:function(e){if(e.data){let t=!0;for(let i=this.parsed.variable_values.length;i--;){const a=this.parsed.variable_values[i];if(a.active&&!isNaN(a.value)){const i=e.get_value(a.name,a.comp_fun(a,this.parsed)),s=!isNaN(i)&&DataHandler.checks[a.operator](i,a.value);a.filter[s?"passed":"failed"]++,t&&!s&&(t=!1)}else a.filter.failed++}return t}return!0}.bind(e)},e.check=function(e){return{ids:!this.ids||this.checks.ids(e),features:!this.features||this.checks.features(e),variables:!this.variables&&!x._base_filter.c.size||this.checks.variables(e),dataset:!this.dataset||this.checks.dataset(e)}}.bind(e)}(t),d.dataview(t),t.reparse()})),l.querySelectorAll(".auto-output").forEach(c.init_output),J=b.modal.filter,J.body.className="filter-dialog",J.body.appendChild(J.entity_filters=l.createElement("div")),J.entity_filters.appendChild(l.createElement("p")),J.entity_filters.lastElementChild.className="h6 text-muted",J.entity_filters.lastElementChild.innerText="Select Entities",J.entity_filters.appendChild(l.createElement("div")),J.entity_filters.lastElementChild.className="row",J.entity_inputs={},Object.keys(r.data.loaded).reverse().forEach((e=>{const t=c.combobox.create(e,void 0,{search:!0,multi:!0,clearable:!0},"filter."+e);J.entity_inputs[e]=t,J.entity_filters.lastElementChild.appendChild(l.createElement("div")),J.entity_filters.lastElementChild.lastElementChild.className="col-sm",J.entity_filters.lastElementChild.lastElementChild.appendChild(t.e.parentElement),t.e.parentElement.classList.add("form-floating"),t.listbox.classList.add("multi"),t.option_sets={},t.dataset=e,t.loader=function(){r.data.retrieve(this.dataset,r.data.info[this.dataset].site_file),this.e.removeEventListener("click",this.loader)}.bind(t),r.data.loaded[e]||t.e.addEventListener("click",t.loader),t.onchange=function(){d.id_filter(),ce("_entity_filter")}.bind(t),t.set_current=d.set_current.bind(t),N(t,e,t.option_sets,function(){this.set_current(),O(this,!!this.options.length),Object.keys(this.values).forEach((e=>{x._entity_filter.entities.set(e,r.data.entities[e])})),x._entity_filter.registered[e]=!0,this.set(this.id in r.url_options?r.url_options[this.id].split(","):-1)}.bind(t)),O(t,!!t.options.length)})),J.body.appendChild(J.variable_filters=l.createElement("div")),J.variable_filters.appendChild(l.createElement("p")),J.variable_filters.lastElementChild.className="h6 text-muted",J.variable_filters.lastElementChild.innerText="Variable Conditions",J.variable_filters.appendChild(V=l.createElement("div")),V.className="row",V.appendChild(l.createElement("div")),V.lastElementChild.className="col",V.lastElementChild.appendChild(U=l.createElement("div")),U.className="dropdown",U.appendChild(l.createElement("button")),U.lastElementChild.type="button",U.lastElementChild.id="filter_variable_dropdown",U.lastElementChild.className="btn dropdown-toggle",U.lastElementChild.setAttribute("data-bs-toggle","dropdown"),U.lastElementChild.setAttribute("aria-expanded",!1),U.lastElementChild.innerText="Add Variable Condition",U.appendChild(l.createElement("ul")),U.lastElementChild.addEventListener("click",i.bind(J)),U.lastElementChild.className="dropdown-menu",U.lastElementChild.setAttribute("aria-labelledby","filter_variable_dropdown"),Object.keys(r.data.variables).forEach((e=>{if(!r.data.variables[e].is_time){const t=l.createElement("li");t.appendChild(l.createElement("a")),t.lastElementChild.className="dropdown-item",t.lastElementChild.href="#",t.lastElementChild.dataset.value=e,t.lastElementChild.innerText=r.data.variable_info[e]&&r.data.variable_info[e].short_name||e,U.lastElementChild.appendChild(t)}})),J.variable_filters.appendChild(V=l.createElement("table")),V.className="table",V.appendChild(V=l.createElement("thead")),V.className="filter-header",J.variable_filters.lastElementChild.appendChild(l.createElement("tbody")),J.variable_filters.lastElementChild.lastElementChild.className="filter-body",V=V.appendChild(V=l.createElement("tr")),["Variable","Result","Active","Component","Operator","Value","Remove"].forEach((e=>{if(V.appendChild(l.createElement("th")),"Component"===e||"Result"===e){const t="Component"===e?{wrapper:l.createElement("label"),id:"filter_component_header",note:"Component refers to which single value to filter on for each entity; select a dynamic time reference, or enter a time."}:{wrapper:l.createElement("label"),id:"filter_result_header",note:"Passing / total entities across loaded datasets."};V.lastElementChild.appendChild(t.wrapper),V.lastElementChild.className="has-note",t.wrapper.innerText=e,t.wrapper.id=t.id,t.wrapper.setAttribute("data-of",t.id),t.wrapper.setAttribute("aria-description",t.note),V.lastElementChild.addEventListener("mouseover",ae.bind(t))}else V.lastElementChild.innerText=e})),E._u=Object.keys(x),r.query&&(r.parsed_query=r.data.parse_query(r.query),r.parsed_query.variables.conditions.length&&r.parsed_query.variables.conditions.forEach((e=>{const t=r.data.variable_info[e.name];t&&i({target:{tagName:"A",dataset:{value:e.name},innerText:t.short_name}},e)})))}function te(){r.settings.tracking&&n.dataLayer.push(arguments)}function ie(e){return e in x&&(e=x[e]),e&&e.value&&(e=ie(e.value())),e}function ae(){if(r.settings.hide_tooltips||this.id===b.tooltip.showing)return;b.tooltip.showing=this.id,b.tooltip.e.firstElementChild.innerText=this.note,b.tooltip.e.classList.remove("hidden");const e=this.wrapper.getBoundingClientRect(),t=b.tooltip.e.getBoundingClientRect();b.tooltip.e.style.left=Math.max(0,Math.min(e.x,e.x+e.width/2-t.width/2))+"px",b.tooltip.e.style.top=e.y+(e.y<t.height?e.height+5:-t.height-5)+"px"}function se(e){!b.tooltip.showing||"blur"!==e.type&&b.tooltip.showing===(e.target.getAttribute("data-of")||e.target.id)||(b.tooltip.showing="",b.tooltip.e.classList.add("hidden"))}async function ne(e,i,a){const s=i.name?i.name+(i.time||""):i.url;if(i.url in r.map._raw)!function(e,i){let a,s;const n="time"in e,l=e.name+(n?e.time:"");if(r.map[i.id]._layers[l]=L.geoJSON(JSON.parse(r.map._raw[e.url]),{onEachFeature:(l,o)=>{o.on({mouseover:c.map.mouseover.bind(i),mouseout:c.map.mouseout.bind(i),click:c.map.click.bind(i)}),o.setStyle({weight:0,fillOpacity:0}),o.source=e,a=o.feature.properties,s=a[e.id_property],!(s in r.data.entities)&&t.leading_zeros.test(s)&&(s=a[e.id_property]=s.replace(t.leading_zeros,"")),s in r.data.entities?"layer"in r.data.entities[s]||(r.data.entities[s].layer={}):r.data.entities[s]={layer:{},features:{id:s}},n?(i.id in r.data.entities[s].layer||(r.data.entities[s].layer[i.id]={has_time:!0}),r.data.entities[s].layer[i.id][e.time]=o):r.data.entities[s].layer[i.id]=o,o.entity=r.data.entities[s],r.data.entities[s].features&&Object.keys(a).forEach((e=>{e in r.data.entities[s].features||("name"!==e.toLowerCase()||"name"in r.data.entities[s].features&&r.data.entities[s].features.id!==r.data.entities[s].features.name?r.data.entities[s].features[e]=a[e]:r.data.entities[s].features[e.toLowerCase()]=a[e])}))}}),r.data.inited[l+i.id]=!0,r.map._waiting&&r.map._waiting[e.name])for(let t=r.map._waiting[e.name].length;t--;)ce(r.map._waiting[e.name][t])}(i,e),r.map._queue[s].retrieved=!0,a&&a();else if(r.map._queue[s]&&"retrieved"in r.map._queue[s])a&&(r.map._queue[s].callbacks||(r.map._queue[s].callbacks=[]),r.map._queue[s].callbacks.push(a));else{r.map._queue[s].retrieved=!1;const e=new n.XMLHttpRequest;e.onreadystatechange=()=>{4===e.readyState&&200===e.status&&(r.map._raw[i.url]=e.responseText,i.name&&(r.map._queue[s].retrieved=!0),r.map._queue[s].callbacks?(a&&r.map._queue[s].callbacks.push(a),r.map._queue[s].callbacks.forEach((e=>e()))):a&&a())},e.open("GET",i.url,!0),e.send()}}function le(e,t,i){let a=0,s="string"==typeof t.source?t.source:"";if(!s&&t.source)for(a=t.source.length;a--;)if(!t.source[a].time||i===t.source[a].time){t.source[a].name&&delete t.source[a].name,s=t.source[a].url;break}if(s){if(!(s in r.map._raw))return ne(e,t.source[a],le.bind(null,e,t,i));{if(!(s in r.map[e.id]._layers)){const t={};r.map._queue[s].processed||(r.map._queue[s].property_summaries=t),r.map[e.id]._layers[s]=L.geoJSON(JSON.parse(r.map._raw[s]),{pointToLayer:(e,t)=>L.circleMarker(t),onEachFeature:e=>{const i=e.properties;i&&Object.keys(i).forEach((e=>{const a=i[e];"number"==typeof a&&(e in t||(t[e]=[1/0,-1/0]),a<t[e][0]&&(t[e][0]=a),a>t[e][1]&&(t[e][1]=a))}))}}).on("mouseover",(e=>{const t=e.layer;if(t&&!t._tooltip){const e=t.feature&&t.feature.properties;if(e){const i=l.createElement("table");Object.keys(e).forEach((t=>{const a=e[t],s=l.createElement("tr");s.appendChild(l.createElement("td")),s.appendChild(l.createElement("td")),s.firstElementChild.innerText=t,s.lastElementChild.innerText=a,i.appendChild(s)})),t.bindTooltip(i),t.openTooltip()}}})),Object.keys(t).forEach((e=>{t[e].push(t[e][1]-t[e][0]),t[e][2]||delete t[e]})),r.map._overlay_property_selectors.forEach((e=>{s in e.option_sets||(!function(e,t,i){i[t]={options:[],values:{},display:{}};const a=e.values,s=i[t].options,n=i[t].values,l=i[t].display;e.type;let o=!e.sensitive&&!!e.current_set,d=0;e.settings.group&&(e.groups={e:[],by_name:{}}),Object.keys(r.map._queue[t].property_summaries).forEach((t=>{const i=r.data.format_label(t);o&&!(P in a)&&(e.sensitive=!0,o=!1),s.push(e.add(t,i)),s[d].id=e.id+"-option"+d,n[t]=d,l[i]=d++}))}(e,s,e.option_sets),e.dataset=s,e.variable="")}))}r.map._overlay_property_selectors.forEach((e=>{e.dataset=s,d.options(e)})),e.overlay.clearLayers();let i=0;const a=r.settings.circle_property&&r.map._queue[s].property_summaries,n=a&&a[r.settings.circle_property];r.map[e.id]._layers[s].eachLayer((a=>{if(t.filter)for(let e=t.filter.length;e--;)if(!t.filter[e].check(a.feature.properties[t.filter[e].feature],t.filter[e].value))return;i++,a.setRadius(n?((a.feature.properties[r.settings.circle_property]-n[0])/n[2]+.5)*r.settings.circle_radius:r.settings.circle_radius).setStyle({weight:r.settings.polygon_outline,color:"white",opacity:.5,fillOpacity:.5,fillColor:"black"}),a.addTo(e.overlay)})),i&&e.overlay_control.addTo(e.map)}}}function re(e){return"string"==typeof e&&t.number.test(e)&&-1===(e=r.data.meta.overall.value.indexOf(Number(e)))?function(){return NaN}:"number"==typeof e?f.number.bind(e):e in f?f[e]:function(){return NaN}}function oe(){g.retain_state=!1,E._u.forEach(ce)}function de(){g.retain_state=!1,E._u.forEach((e=>{!x[e].setting&&x[e].reset&&(x[e].reset(),ce(e))}))}function ce(e){_[e]=!0,_._timeout>0&&clearTimeout(_._timeout),_._timeout=setTimeout(he,20),g.lock_after=e}function he(){_._timeout>0&&clearTimeout(_._timeout),_._timeout=-1,E._u.forEach((e=>{if(_[e]){const t=function(e){if(e in C){const t=x[e],i=C[e],a=[],s=t&&t.value()+"";if(t&&(!g.retain_state||t.state!==s)){const n=r.dataviews[t.view],l=t.dataset?ie(t.dataset):n?n.get.dataset():s;if(r.data.info&&l in r.data.loaded&&!r.data.loaded[l])return t.deferred||r.data.retrieve(l,r.data.info[l].site_file),l;t.state=s,i.forEach((e=>{"rule"===e.type?-1===a.indexOf(e.rule)&&a.push(e.rule):"function"==typeof x[e.id][e.type]?x[e.id][e.type]():d[e.type](x[e.id],t)})),a.forEach((e=>{let t=!1;const i=r.rules[e],a=i.condition.length;for(let e=0;e<a;e++){const a=i.condition[e];if(t=a.check(),a.any?t:!t)break}Object.keys(i.effects).forEach((e=>{const a=i.effects[e];t?"display"===e?a.e.classList.remove("hidden"):"lock"===e?a.forEach((e=>{e.e.classList.remove("locked"),O(e,!0)})):e in x&&x[e].set(ie(a)):"display"===e?a.e.classList.contains("hidden")||(a.e.classList.add("hidden"),a.u&&a.u.reset&&a.u.reset(),a.e.querySelectorAll(".auto-input").forEach((e=>{e.id in x&&x[e.id].reset&&x[e.id].reset()}))):"lock"===e?a.forEach((e=>{e.e.classList.add("locked"),O(e)})):"default"in i&&e in x&&x[e].set(ie(i.default))}))})),e===g.lock_after&&(g.retain_state=!0)}}}(e);if(t)return e in r.data.data_queue[t]||(r.data.data_queue[t][e]=he),!1;_[e]=!1}}));let e=Z();r.data.inited.first&&e!==r.state&&(r.state=e,Object.keys(r.url_options).forEach((i=>{t.embed_setting.test(i)&&(e+="&"+i+"="+("navcolor"===i?r.url_options[i].replace(t.hashes,"%23"):r.url_options[i]))})),r.settings.hide_url_parameters||n.history.replaceState(Date.now(),"",e),setTimeout(K,50))}Object.keys(e).forEach((t=>{const i=e[t];if("continuous-polynomial"===i.type){const e=i.colors;i.type="discrete",i.colors=[];for(let t=0;t<255;t++){const a=t/255;i.colors.push("rgb("+Q(0,a,e)+", "+Q(1,a,e)+", "+Q(2,a,e)+")")}}i.odd=i.colors.length%2})),n.onload=function(){if(b.navbar=l.querySelector(".navbar"),b.navbar=b.navbar?b.navbar.getBoundingClientRect():{height:0},b.content=l.querySelector(".content"),b.menus=l.querySelectorAll(".menu-wrapper"),b.panels=l.querySelectorAll(".panel"),b.content_bounds={top:b.navbar.height,right:0,bottom:0,left:0,outer_right:0},b.script_style=l.head.appendChild(l.createElement("style")),r.settings.hide_tooltips&&b.script_style.sheet.insertRule(o,0),b.menu_toggler={hide:function(){b.menu_toggler.timeout=-1,this.classList.add("hidden"),K()},toggle:function(e){if(b.menu_toggler.timeout>0&&clearTimeout(b.menu_toggler.timeout),b.menu_toggler.timeout=-1,"closed"===this.parentElement.state)this.parentElement.state="open",this.parentElement.firstElementChild.classList.remove("hidden"),this.parentElement.style[e]="0px",b.content.style[e]=this.parentElement.getBoundingClientRect()["left"===e||"right"===e?"width":"height"]+"px","top"!==e&&"bottom"!==e||(this.style[e]=b.content_bounds[e]+"px"),setTimeout(W,300);else{if(this.parentElement.state="closed","left"===e||"right"===e)this.parentElement.style[e]=-this.parentElement.getBoundingClientRect().width+"px",b.content.style[e]=b.content_bounds[e]+"px";else{const t=this.parentElement.getBoundingClientRect();b.content.style[e]=b.content_bounds[e]+("top"===e?40:0)+"px",this.parentElement.style[e]=-t.height+("top"===e?b.content_bounds.top:0)+"px","top"!==e&&"bottom"!==e||(this.style[e]=t.height+"px")}b.menu_toggler.timeout=setTimeout(b.menu_toggler.hide.bind(this.parentElement.firstElementChild),300)}},timeout:-1},b.modal={info:{init:!1,e:l.createElement("div")},filter:{init:!1,e:l.createElement("div")}},b.load_screen=l.getElementById("load_screen"),r.settings.tracking&&r.tag_id&&(te("js",new Date),te("config",r.tag_id)),J=b.modal.info.e,l.body.appendChild(J),b.modal.info.init=!0,J.id="variable_info_display",J.className="modal fade",J.setAttribute("tabindex","-1"),J.setAttribute("aria-labelledby","variable_info_title"),J.ariaHidden="true",J.appendChild(l.createElement("div")),J.firstElementChild.className="modal-dialog modal-dialog-scrollable",J.firstElementChild.appendChild(l.createElement("div")),J.firstElementChild.firstElementChild.className="modal-content",J.firstElementChild.firstElementChild.appendChild(b.modal.info.header=l.createElement("div")),J=b.modal.info,J.header.className="modal-header",J.header.appendChild(l.createElement("p")),J.header.firstElementChild.className="h5 modal-title",J.header.firstElementChild.id="variable_info_title",J.header.appendChild(l.createElement("button")),J.header.lastElementChild.type="button",J.header.lastElementChild.className="btn-close",J.header.lastElementChild.setAttribute("data-bs-dismiss","modal"),J.header.lastElementChild.title="close",J.header.insertAdjacentElement("afterEnd",J.body=l.createElement("div")),J.body.className="modal-body",J.body.appendChild(J.title=l.createElement("p")),J.title.className="h4",J.body.appendChild(J.description=l.createElement("p")),J.body.appendChild(l.createElement("table")),J.body.lastElementChild.className="info-feature-table",J.body.lastElementChild.appendChild(J.name=l.createElement("tr")),J.name.appendChild(l.createElement("th")),J.name.firstElementChild.innerText="Name",J.name.appendChild(l.createElement("td")),J.body.lastElementChild.appendChild(J.type=l.createElement("tr")),J.type.appendChild(l.createElement("th")),J.type.firstElementChild.innerText="Type",J.type.appendChild(l.createElement("td")),J.body.appendChild(J.sources=l.createElement("div")),J.sources.appendChild(l.createElement("p")),J.sources.lastElementChild.innerText="Sources",J.sources.lastElementChild.className="h3",J.sources.appendChild(l.createElement("div")),J.sources.lastElementChild.className="sources-cards",J=b.modal.info,J.body.appendChild(J.references=l.createElement("div")),J.references.appendChild(l.createElement("p")),J.references.firstElementChild.className="h3",J.references.firstElementChild.innerText="References",J.references.appendChild(J=l.createElement("ul")),J.className="reference-list",l.body.appendChild(J=b.modal.filter.e),b.modal.filter.init=!0,J.id="filter_display",J.className="modal fade",J.setAttribute("tabindex","-1"),J.setAttribute("aria-labelledby","filter_title"),J.ariaHidden="true",J.appendChild(l.createElement("div")),J.firstElementChild.className="modal-dialog",J.firstElementChild.appendChild(l.createElement("div")),J.firstElementChild.firstElementChild.className="modal-content",J.firstElementChild.firstElementChild.appendChild(b.modal.filter.header=l.createElement("div")),J=b.modal.filter,J.header.className="modal-header",J.header.appendChild(l.createElement("p")),J.header.firstElementChild.className="h5 modal-title",J.header.firstElementChild.id="filter_title",J.header.firstElementChild.innerText="Filter",J.header.appendChild(l.createElement("button")),J.header.lastElementChild.type="button",J.header.lastElementChild.className="btn-close",J.header.lastElementChild.setAttribute("data-bs-dismiss","modal"),J.header.lastElementChild.title="close",J.header.insertAdjacentElement("afterEnd",J.body=l.createElement("div")),J.body.className="modal-body",J.body.appendChild(l.createElement("p")),J.body.lastElementChild.className="h6 text-muted",J.body.lastElementChild.innerText="Time Range",J.body.appendChild(J.time_range=l.createElement("div")),J.time_range.className="row",J.time_range.appendChild(l.createElement("div")),J.time_range.lastElementChild.className="col",J.time_range.lastElementChild.appendChild(V=l.createElement("div")),V.className="form-floating text-wrapper wrapper",V.appendChild(l.createElement("input")),V.lastElementChild.className="form-control auto-input",V.lastElementChild.setAttribute("data-autoType","number"),V.lastElementChild.setAttribute("data-default","min"),V.lastElementChild.max="filter.time_max",V.lastElementChild.type="number",V.lastElementChild.autoType="number",V.lastElementChild.id="filter.time_min",V.appendChild(l.createElement("label")),V.lastElementChild.innerText="First Time",V.lastElementChild.setAttribute("for","filter.time_min"),J.time_range.appendChild(l.createElement("div")),J.time_range.lastElementChild.className="col",J.time_range.lastElementChild.appendChild(V=l.createElement("div")),V.className="form-floating text-wrapper wrapper",V.appendChild(l.createElement("input")),V.lastElementChild.className="form-control auto-input",V.lastElementChild.setAttribute("data-autoType","number"),V.lastElementChild.setAttribute("data-default","max"),V.lastElementChild.min="filter.time_min",V.lastElementChild.type="number",V.lastElementChild.autoType="number",V.lastElementChild.id="filter.time_max",V.appendChild(l.createElement("label")),V.lastElementChild.innerText="Last Time",V.lastElementChild.setAttribute("for","filter.time_max"),b.panels.length&&b.panels.forEach((e=>{const t=e.classList.contains("panel-left")?"left":"right";b.content_bounds[t]=e.getBoundingClientRect().width,e.style.marginTop=b.content_bounds.top+"px",e.lastElementChild.addEventListener("click",function(){const i=e.getBoundingClientRect().width,a=e.lastElementChild.getBoundingClientRect().width;"true"===e.lastElementChild.getAttribute("aria-expanded")?(b.content_bounds[t]=a,b.top_menu&&(b.top_menu.style[t]=a+"px"),b.bottom_menu&&(b.bottom_menu.style[t]=a+"px"),e.style[t]=-i+a+"px",e.lastElementChild.setAttribute("aria-expanded","false")):(b.content_bounds[t]=i,b.top_menu&&(b.top_menu.style[t]=i+"px"),b.bottom_menu&&(b.bottom_menu.style[t]=i+"px"),e.style[t]="0px",e.lastElementChild.setAttribute("aria-expanded","true")),K(),setTimeout(W,200)}.bind(e))})),b.menus.length&&b.menus.forEach((e=>{const t="BUTTON"===e.lastElementChild.tagName;e.state=e.getAttribute("data-state"),e.classList.contains("menu-top")?(b.top_menu=e,b.top_menu.style.left=b.content_bounds.left+"px",b.top_menu.style.right=b.content_bounds.right+"px",t&&(e.lastElementChild.addEventListener("click",b.menu_toggler.toggle.bind(e.lastElementChild,"top")),e.lastElementChild.style.top=b.content_bounds.top+"px")):e.classList.contains("menu-right")?(b.right_menu=e,b.right_menu.style.right=b.content_bounds.right+"px",t&&(e.lastElementChild.addEventListener("click",b.menu_toggler.toggle.bind(e.lastElementChild,"right")),e.lastElementChild.style.top=b.content_bounds.top+"px")):e.classList.contains("menu-bottom")?(b.bottom_menu=e,b.content_bounds.bottom=40,b.bottom_menu.style.left=b.content_bounds.left+"px",b.bottom_menu.style.right=b.content_bounds.right+"px",t&&e.lastElementChild.addEventListener("click",b.menu_toggler.toggle.bind(e.lastElementChild,"bottom"))):e.classList.contains("menu-left")&&(b.left_menu=e,b.left_menu.style.left=b.content_bounds.left+"px",t&&(e.lastElementChild.addEventListener("click",b.menu_toggler.toggle.bind(e.lastElementChild,"left")),e.lastElementChild.style.top=b.content_bounds.top+"px")),r.url_options.close_menus&&"open"===e.state&&e.lastElementChild.click()})),b.tooltip={e:l.createElement("div"),showing:""},b.tooltip.e.className="tooltip hidden",b.tooltip.e.appendChild(l.createElement("p")),l.body.appendChild(b.tooltip.e),l.body.addEventListener("mouseover",se),r.dataviews){for(const e in r.dataviews)if(e in r.dataviews){a.dataview=e;break}}else r.dataviews={},r.dataviews[a.dataview]={};if(l.querySelectorAll(".auto-input").forEach(c.init_input),r.variables&&r.variables.length&&r.variables.forEach((e=>{const t=e.id,i={id:t,type:"virtual",source:e.default,previous:void 0,default:e.default,display:e.display,current_index:-1,values:[],states:e.states,update:function(){this.source=void 0;for(let e,t=this.states.length;t--;){e=!0;for(let i=this.states[t].condition.length;i--;){const a=this.states[t].condition[i];if(DataHandler.checks[a.type](ie(a.id),ie(a.value))){if(a.any){e=!0;break}}else e=!1}if(e){this.source=this.states[t].value;break}}if(this.source||(this.source=this.default),this.source!==this.previous)this.previous=this.source,ce(this.id);else if(this.source in x){const e=x[this.source].value();e!==this.previous&&(this.previous=e,ce(this.id))}},value:function(){return ie(this.source)},set:function(e){if(-1!==this.values.indexOf(e))this.previous=this.source,this.source=e;else if(this.source){const t=x[this.source];("select"===t.type||"combobox"===t.type?e in t.values||e in t.display:-1!==t.values.indexOf(e))&&t.set(e)}ce(this.id)}};x[t]=i,i.source&&i.values.push(i.source);const a={};i.states.forEach((e=>{i.values.push(e.value),e.condition.forEach((e=>{a[e.id]={type:"update",id:t},j(e.id,{type:"update",id:t})}))})),i.values.forEach((e=>{e in x&&j(e,{type:"update",id:t})}))})),r.rules&&r.rules.length&&r.rules.forEach(((e,t)=>{if("display"in e.effects&&(e.effects.display={e:l.getElementById(e.effects.display)},J=e.effects.display.e.querySelector(".auto-input"),J)){const t=x[J.id];t.rule=e,e.effects.display.u=t}if("lock"in e.effects){const t=new Map;l.querySelectorAll("#"+e.effects.lock+" .auto-input").forEach((e=>t.set(e.id,x[e.id]))),e.effects.lock=t}e.condition.forEach((i=>{i.type in DataHandler.checks&&(i.check=function(){return DataHandler.checks[this.type](ie(this.id),ie(this.value))}.bind(i),i.id in x&&(j(i.id,{type:"rule",id:i.id,condition:i,rule:t}),i.id in y||(y[i.id]={}),y[i.id][t]=e),i.check()?Object.keys(e.effects).forEach((t=>{t in x&&x[t].set(ie(e.effects[t]))})):i.default&&Object.keys(e.effects).forEach((e=>{e in x&&x[e].set(ie(i.default))})))}))})),E._u=Object.keys(x),n.addEventListener("resize",K),r.metadata.datasets||X(),!r.dataviews[a.dataview].dataset){if(1===r.metadata.datasets.length)a.dataset=r.metadata.datasets[0];else{const e=r.data.info;for(let t=E._u.length;t--;){const i=x[E._u[t]];if(i.dataset in e){a.dataset=i.dataset;break}if(i.default in e){a.dataset=i.default;break}if("select"===i.type&&i.options[i.default]&&i.options[i.default].value in e){a.dataset=i.options[i.default].value;break}if(Array.isArray(i.values)&&i.values[i.default]&&i.values[i.default]in e){a.dataset=i.values[i.default];break}}a.dataset||(a.dataset=r.metadata.datasets[r.metadata.datasets.length-1])}E._u.forEach((e=>{const t=x[e];t.dataset||(t.dataset=a.dataset)})),r.dataviews[a.dataview].dataset=a.dataset}"undefined"==typeof DataHandler?r.data={}:(a.dataset=ie(r.dataviews[a.dataview].dataset),"number"==typeof a.dataset&&(a.dataset=r.metadata.datasets[a.dataset]),r.data=new DataHandler(r,a,r.data,{init:ee,onload:function(){r.data.inited&&clearTimeout(r.data.inited.load_screen),setTimeout(X,600),delete this.onload},data_load:function(){Object.keys(C).forEach(ce)}})),b.load_screen&&r.data.inited?r.data.inited.load_screen=setTimeout(X,3e3):b.wrap.style.visibility="visible"}};"undefined"==typeof module?n(window,document,site):module.exports=n}));
//# sourceMappingURL=community.min.js.map
