!function(){"use strict";Object.hasOwn||Object.defineProperty(Object,"hasOwn",{value:function(object,property){if(null==object)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(object),property)},configurable:!0,enumerable:!1,writable:!0});const palettes={divergent:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],reds:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],greens:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],greys:["#f7f7f7","#cccccc","#969696","#525252"],cats:["#a6cee3","#1f78b4","#b2df8a","#33a02c"]},patterns={single_decimal:/(\.\d$)/,seps:/[\s._-]/g,word_start:/\b(\w)/g,datasets:/^dat/,variables:/^var/,levels:/^lev/,minmax:/^m[inax]{2}$/},conditionals={options:function(u,c){var v,i,s,n,ns,k,d=valueOf(u.dataset)||valueOf(c.dataset),va=valueOf(u.variable);if(Object.hasOwn(u,"option_sets")||(u.option_sets={}),u.e.innerHTML="",c&&Object.hasOwn(u.option_sets,k=d+(va||""))){if(u.values=u.option_sets[k].values,u.display=u.option_sets[k].display,u.view&&"ID"===u.variable)for(v=site.dataviews[u.view].selection.all,n=(s=u.option_sets[k].options).length,ns=0,i=0;i<n;i++)u.e.appendChild(s[i]),Object.hasOwn(v,s[i].value)?(s[i].classList.remove("hidden"),ns++):s[i].classList.add("hidden");else for(n=(s=u.option_sets[k].options).length,i=0;i<n;i++)u.e.appendChild(s[i]),ns++;u.e[ns<2?"setAttribute":"removeAttribute"]("disabled",!0)}else Object.hasOwn(_u,u.depends)&&(patterns.variables.test(u.options_source)?(d=c.value())&&fill_variables_options(u,d,u.option_sets):patterns.levels.test(u.options_source)&&fill_levels_options(u,d,va,u.option_sets));u.set(u.value())},map_colors:function(u){const v=site.dataviews[u.view],c=valueOf(u.color||v.y),d=v.get.dataset(),ys=u.time?_u[u.time]:v.time_agg?Object.hasOwn(_u,v.time_agg)?_u[v.time_agg]:"last"===v.time_agg&&c?variables[c][u.view].summaries[d].time_range[1]:parseInt(v.time_agg):0;if(c&&Object.hasOwn(v,"get")){var l,y=ys.parsed?ys.value()-ys.parsed.min:0,s=v.selection.all,k;if(Object.hasOwn(site.maps,d)&&Object.hasOwn(variables[c],u.view))for(k in l=variables[c][u.view].summaries[d],s)Object.hasOwn(s,k)&&Object.hasOwn(variables[c],u.view)&&s[k].layer&&s[k].layer.setStyle({fillOpacity:.7,color:"#000000",fillColor:pal(s[k].data[c][y],v.palette,l,y),weight:1});else Object.hasOwn(site.maps,"_waiting")||(site.maps._waiting={}),Object.hasOwn(site.maps._waiting,d)||(site.maps._waiting[d]=[]),-1===site.maps._waiting[d].indexOf(c.id)&&site.maps._waiting[d].push(c.id),-1===site.maps._waiting[d].indexOf(u.view)&&site.maps._waiting[d].push(u.view)}},map_shapes:function(u){if(u.view&&u.displaying){u.displaying.clearLayers();var s=site.dataviews[u.view].selection.all,k,n=0;if(s)for(k in s)Object.hasOwn(s,k)&&s[k].layer&&(n++,s[k].layer.addTo(u.displaying));n&&u.map.flyToBounds(u.displaying.getBounds())}},min:function(u,c){var cv=c.value(),uv=u.value(),v=_u[u.view],variable;patterns.minmax.test(cv)&&(cv=c.parsed.min),v&&v.time_range&&(variable=valueOf(v.y),Object.hasOwn(variables,variable)&&(v.time_range.time.length||conditionals.time_range(v,u,!0),cv=Math.max(v.time_range.time[0],parseFloat(cv)))),u.e.min=void 0===u.parsed.min?parseFloat(cv):Math.max(u.parsed.min,parseFloat(cv)),u.e.value?"number"==typeof uv&&isFinite(uv)&&uv<cv&&u.set(cv):u.reset()},max:function(u,c){var cv=c.value(),uv=u.value(),v=_u[u.view],variable;patterns.minmax.test(cv)&&(cv=c.parsed.max),v&&v.y&&(variable=valueOf(v.y),Object.hasOwn(variables,variable)&&(v.time_range.time.length||conditionals.time_range(v,u,!0),cv=Math.min(v.time_range.time[1],parseFloat(cv)))),u.e.max=void 0===u.parsed.max?parseFloat(cv):Math.min(u.parsed.max,parseFloat(cv)),u.e.value?"number"==typeof uv&&isFinite(uv)&&uv>cv&&u.set(cv):u.reset()},dataview:function(f){f.check||compile_dataview(f),f.n_selected.ids=0,f.n_selected.features=0,f.n_selected.dataset=0,f.n_selected.all=0,f.selection.ids={},f.selection.features={},f.selection.dataset={},f.selection.all={};var c,k,id,first_all="";for(id in entities)Object.hasOwn(entities,id)&&((c=f.check(entities[id])).all=0,c.ids&&(f.selection.ids[id]=entities[id],f.n_selected.ids++,c.all++),c.features&&(f.selection.features[id]=entities[id],f.n_selected.features++,c.all++),c.dataset&&(f.selection.dataset[id]=entities[id],f.n_selected.dataset++,c.all++),3===c.all&&(first_all||(first_all=id),f.selection.all[id]=entities[id],f.n_selected.all++));if(first_all){for(k in variables)Object.hasOwn(f.selection.all[first_all].data,k)&&calculate_summary(k,f.id,!0);update_subs(f.id,"update")}request_queue(f.id)},time_filters:function(u){u.time_range.filtered[0]=1/0,u.time_range.filtered[1]=-1/0;const s=variables[u.time][u.id].summaries[u.get.dataset()],c=_c[u.id+"_filter"];for(var f,v={},pass,i=s.mean.length;i--;){if(i>=u.time_range.index[0]&&i<=u.time_range.index[1])for(f=u.time_filters.length,pass=!1;f--&&(Object.hasOwn(v,u.time_filters[f].value)||(v[u.time_filters[f].value]=valueOf(u.time_filters[f].value)),pass=check_funs[u.time_filters[f].type](s.mean[i],v[u.time_filters[f].value])););else pass=!1;u.times[i]=pass,pass&&(u.time_range.filtered[0]>s.mean[i]&&(u.time_range.filtered[0]=s.mean[i]),u.time_range.filtered[1]<s.mean[i]&&(u.time_range.filtered[1]=s.mean[i]))}if(c)for(var i=c.length;i--;)"update"===c[i].type?_u[c[i].id].update():Object.hasOwn(conditionals,c[i].type)&&conditionals[c[i].type](_u[c[i].id],u)},time_range:function(u,c,passive){const v=c.value(),d=u.get.dataset(),t=variables[valueOf(u.time)].info[d].min,s=_c[u.id+"_time"];var r=variables[Object.hasOwn(variables,v)?v:valueOf(u.y)];if(r&&(r=r[u.id].summaries[d].time_range,u.time_range.index[0]=r[0],u.time_range.time[0]=t+r[0],u.time_range.index[1]=r[1],u.time_range.time[1]=t+r[1],!passive&&s))for(var i=s.length;i--;)"min"===s[i].type?isFinite(u.time_range.time[0])&&parseFloat(_u[s[i].id].e.min)!==u.time_range.time[0]&&(_u[s[i].id].e.min=u.time_range.time[0],_u[s[i].id].set(u.time_range.time[0])):"max"===s[i].type&&isFinite(u.time_range.time[1])&&parseFloat(_u[s[i].id].e.min)!==u.time_range.time[0]&&(_u[s[i].id].e.max=u.time_range.time[1],_u[s[i].id].set(u.time_range.time[1]))}},elements={buttongroup:{retrieve:function(){for(var i=this.options.length;i--;)if(this.options[i].checked){this.set(i);break}},setter:function(v){this.previous=this.value(),this.current_index="string"==typeof v?this.values.indexOf(v):v,-1!==this.current_index?(this.source=Object.hasOwn(_u,this.values[this.current_index])?_u[this.values[this.current_index]]:this.values[this.current_index],this.options[this.current_index].checked=!0):this.source=void 0,request_queue(this.id)},listener:function(e){this.set(e.target.value)},adder:function(i,value,display){var e=[document.createElement("input"),document.createElement("label")];return e[0].className="btn-check",e[0].type="radio",e[0].name=this.e.id+"_options",e[0].autocomplete="off",e[0].value=value,e[0].id=this.e.id+"_option"+i,e[1].className="btn btn-primary",e[1].innerText=display,e[1].setAttribute("for",e[0].id),this.e.appendChild(e[0]),this.e.appendChild(e[1]),e}},radio:{retrieve:function(){for(var i=this.options.length;i--;)if(this.options[i].checked){this.set(i);break}},setter:function(v){this.current_index="string"==typeof v?this.values.indexOf(v):v,-1!==this.current_index?(this.source=Object.hasOwn(_u,this.values[this.current_index])?_u[this.values[this.current_index]]:this.values[this.current_index],this.options[this.current_index].checked=!0):this.source=void 0,request_queue(this.id)},listener:function(e){this.set(e.target.value)},adder:function(value,display){var e=document.createElement("div");return this.e.appendChild(e),e.className="form-check",e.appendChild(document.createElement("input")),e.appendChild(document.createElement("label")),e.firstElementChild.class="form-check-input",e.firstElementChild.type="radio",e.firstElementChild.name=this.e.id+"_options",e.firstElementChild.id=this.e.id+"_option"+this.e.childElementCount,e.firstElementChild.value=value,e.lastElementChild.innerText=display,e.lastElementChild.className="form-check-label",e.lastElementChild.setAttribute("for",e.firstElementChild.id),this.e}},checkbox:{retrieve:function(){this.source=[],this.current_index=[];for(var i=this.options.length;i--;)this.options[i].checked&&(this.source.push(this.values[i]),this.current_index.push(i));request_queue(this.id)},setter:function(v){if("object"==typeof v){this.source=[],this.current_index=[];for(var i=v.length;i--;)this.source.push(this.values[i]),this.current_index.push(i)}else if("string"==typeof v){const i=this.values.indexOf(v);-1!==i&&(this.options[i].checked=!0)}else-1!==v&&(this.options[v].checked=!0);request_queue(this.id)},listener:function(e){if(e.target.checked)this.source.push(e.target.value),this.current_index.push(this.values.indexOf(e.target.value));else{var i=this.source.indexOf(e.target.value);-1!==i&&(this.source.splice(i,1),this.current_index.splice(i,1))}request_queue(this.id)},adder:function(value,display){var e=document.createElement("div");return this.e.appendChild(e),e.className="form-check",e.appendChild(document.createElement("input")),e.appendChild(document.createElement("label")),e.firstElementChild.class="form-check-input",e.firstElementChild.type="checkbox",e.firstElementChild.name=this.e.id+"_options",e.firstElementChild.id=this.e.id+"_option"+this.e.childElementCount,e.firstElementChild.value=value,e.lastElementChild.innerText=display,e.lastElementChild.className="form-check-label",e.lastElementChild.setAttribute("for",e.firstElementChild.id),this.e}},number:{retrieve:function(){this.set(this.e.value)},setter:function(v){this.previous=this.value(),"string"==typeof v&&(v=parseFloat(v)),isFinite(v)&&v!==this.previous&&(this.e.value=this.source=v,this.current_index=v-this.parsed.min,"range"===this.e.type&&(this.e.nextElementSibling.firstElementChild.innerText=this.e.value),request_queue(this.id))},listener:function(e){this.set(e.target.value)}},select:{retrieve:function(){this.set(this.e.selectedIndex)},setter:function(v){"string"==typeof v&&(v=this.values.indexOf(v)),this.e.selectedIndex=v,this.source=this.values[v],request_queue(this.id)},listener:function(e){this.set(e.target.selectedIndex)},adder:function(value,display){var e=document.createElement("option");return e.value=value,e.innerText=display,this.e.appendChild(e),e}},plot:{mouseover:function(d){d.points&&1===d.points.length&&this.e.data[d.points[0].fullData.index]&&(this.e.data[d.points[0].fullData.index].line.width=4,Plotly.react(this.e,this.e.data,this.e.layout),update_subs(this.id,"show",entitiesByName[d.points[0].text]))},mouseout:function(d){d.points&&1===d.points.length&&this.e.data[d.points[0].fullData.index]&&(this.e.data[d.points[0].fullData.index].line.width=2,Plotly.react(this.e,this.e.data,this.e.layout),update_subs(this.id,"revert",entitiesByName[d.points[0].text]))},click:function(d){this.clickto.set(d.points[0].data.id)},update:function(){if(this.e.layout){const v=_u[this.view],s=v.selection&&v.selection.all;if(s&&v.n_selected.all){this.parsed.x=valueOf(this.x),this.parsed.y=valueOf(this.y);var k,b,traces=[],summary=variables[this.parsed.y][this.view].summaries[v.get.dataset()];for(k in s)Object.hasOwn(s,k)&&traces.push(make_data_entry(this,s[k]));Object.hasOwn(this.traces,"box")&&s[k]&&(traces.push(b=JSON.parse(this.traces.box)),b.x=s[k].data[this.parsed.x],b.upperfence=summary.max,b.q3=summary.q3,b.median=summary.median,b.q1=summary.q1,b.lowerfence=summary.min),"boolean"!=typeof this.e.layout.yaxis.title&&(this.e.layout.yaxis.title=format_label(this.parsed.y)),"boolean"!=typeof this.e.layout.xaxis.title&&(this.e.layout.xaxis.title=format_label(this.parsed.x)),this.parsed.x===meta.time_variable&&(this.e.layout.xaxis.autorange?(this.e.layout.xaxis.autorange=!1,this.e.layout.xaxis.type="linear",this.e.layout.xaxis.dtick=1,this.e.layout.xaxis.range=[v.time_range.filtered[0]-.5,v.time_range.filtered[1]+.5]):(this.e.layout.xaxis.range[0]=v.time_range.filtered[0]-.5,this.e.layout.xaxis.range[1]=v.time_range.filtered[1]+.5)),Plotly.react(this.e,traces,this.e.layout)}}}},map:{mouseover:function(e){e.target.setStyle({color:"#ffffff"}),e.target.bringToFront(),update_subs(this.id,"show",entities[e.target.feature.properties.id])},mouseout:function(e){update_subs(this.id,"revert"),e.target.setStyle({color:"#000000"})},click:function(e){this.clickto.set(e.target.feature.properties.id)}},info:{update:function(entity){var p,k,i,v;if(entity)for((p=this.temp.children)[0].innerText=entity.features.name,i=p[1].childElementCount;i--;)k=p[1].children[i].firstElementChild.innerText,Object.hasOwn(entity.features,k)?(p[1].children[i].classList.remove("hidden"),p[1].children[i].lastElementChild.innerText=entity.features[k]):p[1].children[i].classList.add("hidden");else if(this.view)if(v=site.dataviews[this.view],p=this.base.children,v.ids&&(k=v.get.ids())){for(entity=entities[k],p[0].innerText=entity.features.name,i=p[2].childElementCount;i--;)k=p[2].children[i].firstElementChild.innerText,Object.hasOwn(entity.features,k)?(p[2].children[i].classList.remove("hidden"),p[2].children[i].lastElementChild.innerText=entity.features[k]):p[2].children[i].classList.add("hidden");p[1].classList.add("hidden"),p[2].classList.remove("hidden")}else p[0].innerText=this.defaults.title,p[1].classList.remove("hidden"),p[2].classList.add("hidden")}},table:{update:function(){if(this.table){const v=_u[this.view],d=v.get.dataset();if(this.table.clear(),v.selection){var k,c,i,n,vn,pass;if(this.options.single_variable){if("data."+(vn=valueOf(this.options.variables))!==this.headers[d][1].data){for(this.table.destroy(),n=this.headers[d].length,i=1;i<n;i++)this.headers[d][i].data="data."+vn;this.options.columns=this.headers[d],this.table=$(this.e).DataTable(this.options)}for(n=this.headers[d].length,i=1;i<n;i++)this.table.column(i).visible(v.times[i-1])}if(this.options.wide){for(k in v.selection.all)if(Object.hasOwn(v.selection.all,k))if(vn)Object.hasOwn(v.selection.all[k].summaries,d)&&Object.hasOwn(v.selection.all[k].summaries[d],vn)&&v.selection.all[k].summaries[d][vn].n&&this.table.row.add(v.selection.all[k]);else for(i=meta.time_n;i--;)this.i=i,this.table.row.add(v.selection.all[k])}else for(k in v.selection.all)if(Object.hasOwn(v.selection.all,k))if(this.options.single_variable)Object.hasOwn(v.selection.all[k].summaries,d)&&Object.hasOwn(v.selection.all[k].summaries[d],vn)&&v.selection.all[k].summaries[d][vn].n&&this.table.row.add(v.selection.all[k]);else{for(c in this.filters)Object.hasOwn(this.filters,c)&&(this.current_filter[c]=valueOf(this.filters[c]));for(vn in variables){if(pass=!1,Object.hasOwn(variables,vn)&&Object.hasOwn(variables[vn],"meta"))for(c in this.current_filter)if(Object.hasOwn(variables[vn].meta,c)&&!(pass=variables[vn].meta[c]===this.current_filter[c]))break;if(pass)for(n=v.selection.all[k].summaries[d][vn].time_range[1],i=v.selection.all[k].summaries[d][vn].time_range[0];i<=n;i++)this.i=i,this.v=vn,this.table.row.add(v.selection.all[k])}}}this.table.draw()}}}},check_funs={"!":function(a){return!a||-1!=a},"":function(a){return!!a&&-1!=a},"=":function(a,b){return a===b},"!=":function(a,b){return a!=b},">":function(a,b){return a>b},"<":function(a,b){return a<b},">=":function(a,b){return a>=b},"<=":function(a,b){return a<=b},equals:function(s,e){return!s||s===e},includes:function(s,e){return!s.length||-1!==s.indexOf(e)}};var page={},variables={},variable_info={},queue={_timeout:0},meta={time_n:0,time_range:[],time:[],time_variable:""},subs={},data_maps={},entities={},entitiesByName={},rule_conditions={},_u={},_c={};function pal(value,which,summary,index){const colors=palettes[Object.hasOwn(palettes,which)?which:"reds"],min=summary?summary.min[index]:0,max=summary?summary.max[index]:1,nm=summary?summary.norm_median[index]:.5;return"number"==typeof value?colors[Math.max(0,Math.min(colors.length-1,Math.floor("divergent"===which?colors.length/2+colors.length*(max-min?(value-min)/(max-min)-nm:0):colors.length*(max-min?(value-min)/(max-min):0))))]:"#808080"}function format_value(v){return"number"==typeof v?(Math.round(100*v)/100+"").replace(patterns.single_decimal,"$10"):v}function format_label(l){return Object.hasOwn(variables,l)&&variables[l].meta?variables[l].meta.short_name:l.replace(patterns.seps," ").replace(patterns.word_start,(function(w){return w.toUpperCase()}))}function fill_variables_options(u,d,out){var s,i,m,n,l;for(out[d]={options:[],values:[],display:[]},s=out[d].options,u.values=out[d].values,u.display=out[d].display,n=(m=site.metadata.info[d].schema.fields).length,i=0;i<n;i++)l=format_label(m[i].name),s[i]=u.add(i,l,m[i].name),u.values.push(m[i].name),u.display.push(l)}function fill_levels_options(u,d,v,out){var m=variables[v].info[d],l=m["string"===m.type?"levels":"ids"],k,i,n,s;if(l)if(k=d+v,Object.hasOwn(out,k))for(u.values=out[k].values,u.display=out[k].display,n=(s=out[k].options).length,i=0;i<n;i++)s[i].length?(u.e.appendChild(s[i][0]),u.e.appendChild(s[i][1])):u.e.appendChild(s[i]);else for(k in out[k]={options:[],values:[],display:[]},s=out[k].options,u.values=out[k].values,u.display=out[k].display,i=0,l)Object.hasOwn(l,k)&&(s[i++]=u.add(l[k].id,l[k].name),u.values.push(l[k].id),u.display.push(l[k].name))}function add_dependency(id,o){Object.hasOwn(_c,id)||(_c[id]=[]),_c[id].push(o),request_queue(id)}function add_subs(id,o){Object.hasOwn(subs,id)||(subs[id]=[]),subs[id].push(o)}function update_subs(id,fun,e){if(Object.hasOwn(subs,id))for(var i=subs[id].length;i--;)Object.hasOwn(subs[id][i],fun)&&subs[id][i][fun](e)}function make_data_entry(u,e,name,color){const v=u.view&&_u[u.view],t=JSON.parse(u.traces.scatter);var i,c=valueOf(u.colors||v.y),y=_u[u.time||v.time_agg];if(y=y?y.value()-y.parsed.min:0,Object.hasOwn(e.data,u.parsed.x)){for(i=e.data[u.parsed.x].length;i--;)t.text[i]=e.features.name,t.x[i]=e.data[u.parsed.x][i],t.y[i]=e.data[u.parsed.y][i];t.color=t.line.color=t.marker.color=t.marker.line.color=t.textfont.color=color||pal(e.data[c][y],v.palette,variables[c][v.id].summaries[v.get.dataset()],y)||"#808080",t.name=name||e.features.name,t.id=e.features.id}return t}function init_location_table(t){var l,k,e;for(l in data_maps.tract)if(Object.hasOwn(data_maps.tract,l)){for(k in t.innerHTML="",data_maps.tract[l])Object.hasOwn(data_maps.tract[l],k)&&"name"!==k&&((e=document.createElement("tr")).appendChild(document.createElement("td")),e.firstElementChild.innerText=k,e.appendChild(document.createElement("td")),t.appendChild(e));break}}function init_legend(e){e.innerHTML="";const p=palettes[e.parentElement.parentElement.parentElement.getAttribute("palette")||"divergent"];for(var i=0,n=p.length;i<n;i++)e.appendChild(document.createElement("span")),e.lastElementChild.style.background=p[i]}function init(){var k,i,e,c,p,ce,ci,n,o,cond,v;for(k in _u)if(Object.hasOwn(_u,k)&&Object.hasOwn(elements,_u[k].type)){if((o=_u[k]).options_source)if(patterns.datasets.test(o.options_source)){for(ci=site.metadata.datasets.length;ci--;)o.add(ci,site.metadata.datasets[ci],format_label(site.metadata.datasets[ci]));o.options=o.e.getElementsByTagName("select"===o.type?"option":"input")}else o.option_sets={},v=valueOf(o.dataset),Object.hasOwn(site.metadata.info,v)&&(patterns.variables.test(o.options_source)?fill_variables_options(o,v,o.option_sets):patterns.levels.test(o.options_source)&&Object.hasOwn(variables,o.variable)&&fill_levels_options(o,v,o.variable,o.option_sets),o.reset()),o.depends&&add_dependency(o.depends,{type:"options",id:o.id}),o.view&&add_dependency(o.view,{type:"options",id:o.id});if("number"===o.type)o.min=o.e.getAttribute("min"),o.max=o.e.getAttribute("max"),o.step=parseFloat(o.e.step)||1,o.parsed={min:void 0,max:void 0},o.depends={},o.update=function(){const view=_u[this.view],variable=view&&valueOf(view.y);var d=view?view.get.dataset():valueOf(this.dataset),min=valueOf(this.min)||view.time,max=valueOf(this.max)||view.time,v;patterns.minmax.test(min)&&(min=_u[this.min][min]),patterns.minmax.test(max)&&(max=_u[this.max][max]),!d&&this.view&&(d=view.get.dataset()),this.parsed.min=void 0===min?view.time_range.time[0]:"number"==typeof min?min:Object.hasOwn(variables,min)?variables[min].info[d||variables[min].datasets[0]].min:parseFloat(min),this.parsed.max=void 0===max?view.time_range.time[1]:"number"==typeof max?max:Object.hasOwn(variables,max)?variables[max].info[d||variables[max].datasets[0]].max:parseFloat(max),variable&&Object.hasOwn(variables,variable)?(this.e.min=v=Math.max(view.time_range.time[0],this.parsed.min),v>this.source&&this.set(v),this.e.max=v=Math.min(view.time_range.time[1],this.parsed.max),v<this.source&&this.set(v),this.depends[view.y]||(this.depends[view.y]=!0,add_dependency(view.y,{type:"update",id:this.id}))):(this.e.min=this.parsed.min,(this.parsed.min>this.source||!this.source&&"min"===this.default)&&this.set(this.parsed.min),this.e.max=this.parsed.max,(this.parsed.max<this.source||!this.source&&"max"===this.default)&&this.set(this.parsed.max))}.bind(o),setTimeout(o.update,0),o.view?add_dependency(o.view,{type:"update",id:o.id}):o.dataset&&add_dependency(o.dataset,{type:"update",id:o.id}),o.max&&!Object.hasOwn(variables,o.max)?Object.hasOwn(_u,o.max)?add_dependency(o.max,{type:"max",id:o.id}):o.e.max=parseFloat(o.max):o.view&&add_dependency(o.view+"_time",{type:"max",id:o.id}),o.min&&!Object.hasOwn(variables,o.min)?Object.hasOwn(_u,o.min)?add_dependency(o.min,{type:"min",id:o.id}):o.e.min=parseFloat(o.min):o.view&&add_dependency(o.view+"_time",{type:"min",id:o.id}),o.default&&(isNaN(parseFloat(o.default))?o.reset=function(){const d=Object.hasOwn(_u,this.view)&&_u[this.view].get.dataset();"max"===this.default?void 0!==this.parsed.max&&this.set(this.parsed.max):"min"===this.default?void 0!==this.parsed.min&&this.set(this.parsed.min):Object.hasOwn(_u,this.default)&&this.set(valueOf(this.default))}.bind(o):o.default=parseFloat(o.default));else{if(!o.values.length)for(ci=o.options.length;ci--;)o.values[ci]=o.options[ci].value,o.display[ci]=format_label(o.options[ci].innerText.trim()||o.values[ci]);if("checkbox"===o.type){if(o.default=o.default.split(","),o.options.length)for(ci=o.options.length;ci--;)o.values[ci]=o.options[ci].value}else o.values.length&&!Object.hasOwn(_u,o.default)&&-1===o.values.indexOf(o.default)&&(o.default=parseInt(o.default),o.default=o.values[o.default]?o.values[o.default]:"")}if("select"===o.type||"number"===o.type){if(o.e.addEventListener("input",o.listen),o.e.nextElementSibling&&o.e.nextElementSibling.classList.contains("select-reset")&&o.e.nextElementSibling.addEventListener("click",o.reset),Object.hasOwn(site,o.type)&&Object.hasOwn(site[o.type],o.id)){for(c in o.filters=site[o.type][o.id],o.current_filter={},o.filters)Object.hasOwn(o.filters,c)&&Object.hasOwn(_u,o.filters[c])&&add_dependency(o.filters[c],{type:"filter",id:o.id});o.filter=function(){var k,i,pass,last;for(k in this.filters)Object.hasOwn(this.filters,k)&&(this.current_filter[k]=valueOf(this.filters[k]));for(i=this.values.length;i--;){if(pass=!1,Object.hasOwn(variables,this.values[i])&&Object.hasOwn(variables[this.values[i]],"meta"))for(k in this.current_filter)if(Object.hasOwn(variables[this.values[i]].meta,k)&&!(pass=variables[this.values[i]].meta[k]===this.current_filter[k]))break;pass&&(last=this.values[i]),this.options[i].classList[pass?"remove":"add"]("hidden")}this.current_index=this.values.indexOf(this.value()),last&&(-1===this.current_index||this.options[this.current_index].classList.contains("hidden"))&&this.set(last)}.bind(o)}}else for(ci=o.options.length;ci--;)o.options[ci].addEventListener("click",o.listen);o.reset()}if(site.dataviews)for(k in site.dataviews)if(Object.hasOwn(site.dataviews,k))for(cond in _u[k]=e=site.dataviews[k],Object.hasOwn(e,"time")||(e.time=meta.time_variable),e.id=k,e.value=function(){if(this.get){var k,s=""+this.get.dataset()+this.get.ids();for(k in this.get.features)Object.hasOwn(this.get.features,k)&&(s+=this.get.features[k]());return s}}.bind(e),e.dataset&&"string"==typeof e.dataset&&Object.hasOwn(_u,e.dataset)&&add_dependency(e.dataset,{type:"dataview",id:k}),e.ids&&"string"==typeof e.ids&&Object.hasOwn(_u,e.ids)&&add_dependency(e.ids,{type:"dataview",id:k}),e.time_range={index:[],time:[],filtered:[]},add_dependency(k,{type:"time_range",id:k}),Object.hasOwn(_u,e.x)&&add_dependency(e.x,{type:"time_range",id:k}),Object.hasOwn(_u,e.y)&&add_dependency(e.y,{type:"time_range",id:k}),e.features)Object.hasOwn(e.features,cond)&&"string"==typeof e.features[cond]&&Object.hasOwn(_u,e.features[cond])&&add_dependency(e.features[cond],{type:"dataview",id:k});for(i=(c=document.getElementsByClassName("auto-output")).length,n=0;i--;)if(e=c[i],n=meta.time_n,o={type:e.getAttribute("auto-type"),view:e.getAttribute("data-view"),id:e.id||"out"+n++,e:e},_u[o.id]=o,o.view&&(Object.hasOwn(_c,o.view)||(_c[o.view]=[]),Object.hasOwn(_c,o.view+"_filter")||(_c[o.view+"_filter"]=[])),"info"===o.type){if(o.base=e.firstElementChild,o.temp=e.children[1],o.temp.lastElementChild.classList.remove("hidden"),o.defaults={title:e.firstElementChild.children[0].innerText,message:e.firstElementChild.children[1].innerText},o.update=elements.info.update.bind(o),o.show=function(e){this.update(e),this.base.classList.add("hidden"),this.temp.classList.remove("hidden")},o.revert=function(){this.base.classList.remove("hidden"),this.temp.classList.add("hidden")},o.view&&add_subs(o.view,o),o.options=site.info[o.id],o.options&&o.options.subto)for(ci=o.options.subto.length;ci--;)add_subs(o.options.subto[ci],o);for(ci=(ce=e.getElementsByClassName("location-table")).length;ci--;)init_location_table(ce[ci])}else if("table"===o.type){if(e.appendChild(document.createElement("tHead")),e.appendChild(document.createElement("tBody")),o.options=site.tables&&site.tables[o.id]||{},o.update=elements.table.update.bind(o),o.headers={},"tabpanel"===o.e.parentElement.getAttribute("role")&&document.getElementById(o.e.parentElement.getAttribute("aria-labelledby")).addEventListener("click",function(){setTimeout(this.update,155)}.bind(o)),o.options.single_variable){if("object"==typeof o.options.variables&&(o.options.variables=o.options.variables[0]),Object.hasOwn(_u,o.options.variables)&&add_dependency(o.options.variables,{type:"update",id:o.id}),k=valueOf(o.options.variables),Object.hasOwn(variables,k))for(Object.hasOwn(o.options,"order")||(o.options.order=[[meta.time_n,"asc"]]),ci=variables[k].datasets.length;ci--;)for(p=variables[k].datasets[ci],Object.hasOwn(o.headers,p)||(o.headers[p]=[]),o.headers[p].push({title:"Region",data:"features.name"}),n=meta.time_n;n--;)o.headers[p][n+1]={title:meta.time[n]+"",data:"data."+k,render:function(d){return"number"==typeof d[this]?format_value(d[this]):d[this]}.bind(n)}}else if(o.options.wide){for(k in variables)if(Object.hasOwn(variables,k))for(ci=variables[k].datasets.length;ci--;)p=variables[k].datasets[ci],Object.hasOwn(o.headers,p)||(o.headers[p]=[]),o.headers[p].push("ID"===k?{title:k,data:"features."+k.toLowerCase()}:{title:format_label(k),data:"data."+k,render:function(d){return"number"==typeof d[this.i]?format_value(d[this.i]):d[this.i]}.bind(o)})}else{if(o.filters=o.options.filters,o.current_filter={},Object.hasOwn(o.options,"xfilters")){for(p in o.filters)Object.hasOwn(o.filters,p)&&Object.hasOwn(_u,o.filters[p])&&add_dependency(o.filters[p],{type:"filter",id:o.id});o.filter=function(){var k,c,y,i=0,pass;for(k in this.filters)Object.hasOwn(this.filters,k)&&(this.current_filter[k]=valueOf(this.filters[k]));for(k in variables){if(pass=!1,Object.hasOwn(variables,k)&&Object.hasOwn(variables[k],"meta"))for(c in this.current_filter)if(Object.hasOwn(variables[k].meta,c)&&!(pass=variables[k].meta[c]===this.current_filter[c]))break;for(y=meta.time_n;y--;)this.table.row(i++).visible(pass)}}.bind(o)}for(k in site.data)Object.hasOwn(site.data,k)&&(o.headers[k]=[{title:"ID",data:"features.id"},{title:"Name",data:"features.name"},{title:"Type",data:"features.type"},{title:"Year",data:"data.time",render:function(d){return"number"==typeof d[this.i]?format_value(d[this.i]):d[this.i]}.bind(o)},{title:"Measure",data:function(d){return Object.hasOwn(d.variables,this.v)?d.variables[this.v].short_name:this.v}.bind(o)},{title:"Value",data:function(d){return Object.hasOwn(d.data,this.v)?d.data[this.v]:[]}.bind(o),render:function(d){return"number"==typeof d[this.i]?format_value(d[this.i]):d[this.i]}.bind(o)}])}o.view&&(_c[o.view].push({type:"update",id:o.id}),_c[o.view+"_filter"].push({type:"update",id:o.id})),queue_init_table.bind(o)()}else if("plot"===o.type){if(Object.hasOwn(site.plots,o.id)){if(o.update=elements.plot.update.bind(o),o.x=e.getAttribute("x"),o.y=e.getAttribute("y"),o.colors=e.getAttribute("color"),o.time=e.getAttribute("color-time"),o.click=e.getAttribute("click"),o.click&&Object.hasOwn(_u,o.click)&&(o.clickto=_u[o.click]),o.parsed={},o.config=site.plots[o.id],o.traces={},o.show=function(e){var trace=make_data_entry(this,e,"hover_line","#000");trace.line.width=4,Plotly.addTraces(this.e,trace,this.e.data.length)}.bind(o),o.revert=function(){"hover_line"===this.e.data[this.e.data.length-1].name&&Plotly.deleteTraces(this.e,this.e.data.length-1)}.bind(o),o.config&&o.config.subto)for(ci=o.config.subto.length;ci--;)add_subs(o.config.subto[ci],o);for(ci=site.plots[o.id].data.length;ci--;)p=site.plots[o.id].data[ci],Object.hasOwn(p,"textfont")||(p.textfont={}),Object.hasOwn(p.textfont,"color")||(p.textfont.color="#808080"),Object.hasOwn(p,"line")||(p.line={}),Object.hasOwn(p.line,"color")||(p.line.color="#808080"),Object.hasOwn(p,"marker")||(p.marker={}),Object.hasOwn(p.marker,"color")||(p.marker.color="#808080"),Object.hasOwn(p.marker,"line")||(p.marker.line={}),Object.hasOwn(p.marker.line,"color")||(p.marker.lin.color="#808080"),Object.hasOwn(p,"text")||(p.text=[]),Object.hasOwn(p,"x")||(p.x=[]),"box"===p.type||Object.hasOwn(p,"y")||(p.y=[]),o.traces[site.plots[o.id].data[ci].type]=JSON.stringify(site.plots[o.id].data[ci]);o.x&&!Object.hasOwn(variables,o.x)&&add_dependency(o.x,{type:"update",id:o.id}),o.y&&!Object.hasOwn(variables,o.y)&&add_dependency(o.y,{type:"update",id:o.id}),o.time&&Object.hasOwn(_u,o.time)&&add_dependency(o.time,{type:"update",id:o.id}),o.view&&(_c[o.view].push({type:"update",id:o.id}),_c[o.view+"_filter"].push({type:"update",id:o.id}),_u[o.view].time_agg&&Object.hasOwn(_u,_u[o.view].time_agg)&&add_dependency(_u[o.view].time_agg,{type:"update",id:o.id})),queue_init_plot.bind(o)()}}else if("map"===o.type){if(o.options=site.maps[o.id].options,o.colors=e.getAttribute("color"),o.time=e.getAttribute("color-time"),o.click=e.getAttribute("click"),o.click&&Object.hasOwn(_u,o.click)&&(o.clickto=_u[o.click]),o.show=function(e){e.layer&&e.layer.setStyle({color:"#ffffff"})},o.revert=function(e){e.layer&&e.layer.setStyle({color:"#000000"})},o.options&&o.options.subto)for(ci=o.options.subto.length;ci--;)add_subs(o.options.subto[ci],o);o.view&&(add_dependency(o.view,{type:"map_colors",id:o.id}),_u[o.view].time_agg&&Object.hasOwn(_u,_u[o.view].time_agg)&&add_dependency(_u[o.view].time_agg,{type:"map_colors",id:o.id}),_c[o.view].push({type:"map_shapes",id:o.id}),_u[o.view].y&&add_dependency(_u[o.view].y,{type:"map_colors",id:o.id})),o.colors&&add_dependency(o.colors,{type:"map_colors",id:o.id}),o.time&&add_dependency(o.time,{type:"map_colors",id:o.id}),e.style.height||(e.style.height=o.options.height?o.options.height:"400px"),queue_init_map.bind(o)()}else if("text"===o.type&&site.text&&Object.hasOwn(site.text,o.id)){for(o.text=site.text[o.id].text,o.depends=site.text[o.id].depends,n=o.text.length,ci=0;ci<n;ci++){for(Object.hasOwn(o.text[ci],"button")||(o.text[ci].button={}),o.e.appendChild(o.text[ci].parts=document.createElement("span")),ce=o.text[ci].text.length,c=0;c<ce;c++)Object.hasOwn(o.text[ci].button,o.text[ci].text[c])?(p=o.text[ci].button[o.text[ci].text[c]],o.text[ci].parts.appendChild(document.createElement("button")),o.text[ci].parts.lastElementChild.type="button",o.text[ci].parts.lastElementChild.className="btn btn-light",Object.hasOwn(_u,p.target)&&"function"==typeof _u[p.target][p.type]&&(o.text[ci].parts.lastElementChild.setAttribute("aria-label",p.text.join("")),o.text[ci].parts.lastElementChild.addEventListener("click",_u[p.target][p.type]))):o.text[ci].parts.appendChild(document.createElement("span"));if(Object.hasOwn(o.text[ci],"condition"))for(v=o.text[ci].condition.length;v--;)o.text[ci].condition[v].check=function(){return check_funs[this.type](valueOf(this.id),valueOf(this.value))}.bind(o.text[ci].condition[v])}for(v in o.depends)Object.hasOwn(_u,v)&&add_dependency(v,{type:"update",id:o.id});o.update=function(){var k,i,t,s,pass,bt;for(k in this.depends)Object.hasOwn(this.depends,k)&&(this.depends[k]=valueOf(k),Object.hasOwn(entities,this.depends[k])&&(this.depends[k]=entities[this.depends[k]].features.name));for(i=this.text.length;i--;){if(pass=!0,Object.hasOwn(this.text[i],"condition"))for(t=this.text[i].condition.length;t--&&(pass=this.text[i].condition[t].check()););if(pass){for(t=this.text[i].text.length;t--;)if(k=this.text[i].text[t],Object.hasOwn(this.depends,k))this.text[i].parts.children[t].innerText=this.depends[k];else if(Object.hasOwn(this.text[i].button,k)){for(s="",bt=this.text[i].button[k].text.length;bt--;)s=(Object.hasOwn(this.depends,this.text[i].button[k].text[bt])?this.depends[this.text[i].button[k].text[bt]]:this.text[i].button[k].text[bt])+s;this.text[i].parts.children[t].innerText=s}else this.text[i].parts.children[t].innerText=k;this.text[i].parts.classList.remove("hidden")}else this.text[i].parts.classList.add("hidden")}}.bind(o)}}function valueOf(v){return(v="string"==typeof v&&Object.hasOwn(_u,v)?_u[v]:v)&&v.value&&(v=valueOf(v.value())),v}function add_layer_listeners(feature,layer){layer.on({mouseover:elements.map.mouseover.bind(this),mouseout:elements.map.mouseout.bind(this),click:elements.map.click.bind(this)})}function retrieve_layer(u,group,url){if(!Object.hasOwn(site.maps,url)){var f=new XMLHttpRequest;f.onreadystatechange=function(group){if(4===f.readyState&&200===f.status){var k,id;for(k in site.maps[group]=L.geoJSON(JSON.parse(f.responseText),{onEachFeature:add_layer_listeners.bind(u)}),site.maps[group]._layers){if(!Object.hasOwn(site.maps[group]._layers,k))throw new Error("retrieve_layer failed: "+f.responseText);id=site.maps[group]._layers[k].feature.properties.id,entities[id].layer=site.maps[group]._layers[k]}if(site.maps._waiting&&site.maps._waiting[group])for(var i=site.maps._waiting[group].length;i--;)request_queue(site.maps._waiting[group][i],!0)}}.bind(null,group),f.open("GET",url,!0),f.send()}}function quantile_inds(p,n){const q=[p*(n-1),0,0,0];return q[1]=q[0]%1,q[2]=1-q[1],q[3]=Math.ceil(q[0]),q[0]=Math.floor(q[0]),q}function init_summaries(view){var m,v,s,y;for(v in view=view||"default",variables)if(Object.hasOwn(variables,v))for(s in variables[v][view]=m={order:{},summaries:{}},site.data)if(Object.hasOwn(site.data,s))for(m.order[s]=[],m.summaries[s]={time_range:[0,0],missing:[],n:[],sum:[],max:[],q3:[],mean:[],norm_median:[],median:[],q1:[],min:[]},y=meta.time_n;y--;)m.order[s].push([]),m.summaries[s].missing.push(0),m.summaries[s].n.push(0),m.summaries[s].sum.push(0),m.summaries[s].max.push(-1/0),m.summaries[s].q3.push(0),m.summaries[s].mean.push(0),m.summaries[s].norm_median.push(0),m.summaries[s].median.push(0),m.summaries[s].q1.push(0),m.summaries[s].min.push(1/0)}function calculate_summary(measure,view,full){Object.hasOwn(variables[measure],view)||(variables[measure][view]=JSON.parse(JSON.stringify(variables[measure].default)));const v=site.dataviews[view],dataset=v.get.dataset(),m=variables[measure][view],mo=m.order[dataset],ms=m.summaries[dataset],ny=meta.time_n;for(var k,id,dim,en,q1,q3,y=meta.time_n;y--;)mo[y]=[],ms.missing[y]=0,ms.n[y]=0,ms.sum[y]=0,ms.mean[y]=0,ms.max[y]=-1/0,ms.min[y]=1/0;for(k in v.selection.all)if(Object.hasOwn(v.selection.all,k))for(en=v.selection.all[k],Object.hasOwn(en.summaries,dataset)||(en.summaries[dataset]={}),Object.hasOwn(en.summaries[dataset],measure)||(en.summaries[dataset][measure]={n:0,time_range:[1/0,-1/0]}),en.summaries[dataset][measure].n=0,en.summaries[dataset][measure].time_range[0]=1/0,en.summaries[dataset][measure].time_range[1]=-1/0,id=en.features.id,y=0;y<ny;y++)dim=en.data[measure][y],full&&mo[y].push([id,dim]),"number"==typeof dim?(en.summaries[dataset][measure].n++,y<en.summaries[dataset][measure].time_range[0]&&(en.summaries[dataset][measure].time_range[0]=y),y>en.summaries[dataset][measure].time_range[1]&&(en.summaries[dataset][measure].time_range[1]=y),ms.sum[y]+=dim,ms.n[y]++,dim>ms.max[y]&&(ms.max[y]=dim),dim<ms.min[y]&&(ms.min[y]=dim)):ms.missing[y]++;if(ms.time_range[0]=1/0,ms.time_range[1]=-1/0,full){for(y=0;y<ny;y++)ms.n[y]&&mo[y].sort((function sf(a,b){return a[1]-b[1]}));for(y=0;y<ny;y++)ms.n[y]?(y<ms.time_range[0]&&(ms.time_range[0]=y),y>ms.time_range[1]&&(ms.time_range[1]=y),q1=quantile_inds(.25,ms.n[y]),q3=quantile_inds(.75,ms.n[y]),ms.mean[y]=ms.sum[y]/ms.n[y],isFinite(ms.min[y])||(ms.min[y]=ms.mean[y]),isFinite(ms.max[y])||(ms.max[y]=ms.mean[y]),ms.median[y]="numeric"==typeof mo[y][Math.floor(.5*ms.n[y])]?Math.min(ms.q3[y],mo[y][Math.floor(.5*ms.n[y])][1]):ms.mean[y],ms.q3[y]="numeric"==typeof q3[2]?q3[2]*mo[y][q3[0]][1]+q3[1]*mo[y][q3[3]][1]:ms.median[y]?(ms.max[y]+ms.median[y])/2:ms.mean[y],ms.q1[y]="numeric"==typeof q1[2]?Math.min(ms.median[y],q1[2]*mo[y][q1[0]][1]+q1[1]*mo[y][q1[3]][1]):ms.median[y]?(ms.min[y]+ms.median[y])/2:ms.mean[y]):(ms.max[y]=0,ms.q3[y]=0,ms.median[y]=0,ms.q1[y]=0,ms.min[y]=0),ms.norm_median[y]=ms.max[y]-ms.min[y]?(ms.median[y]-ms.min[y])/(ms.max[y]-ms.min[y]):ms.median[y]}else for(y=0;y<ny;y++)ms.n[y]&&(y<ms.time_range[0]&&(ms.time_range[0]=y),y>ms.time_range[1]&&(ms.time_range[1]=y),ms.mean[y]=ms.sum[y]/ms.n[y])}function load_id_maps(){var ids,i,f,k,queued=!1;for(k in site.metadata.info)if(Object.hasOwn(site.metadata.info,k))for(i=(ids=site.metadata.info[k].ids).length;i--;)Object.hasOwn(ids[i],"map")&&(Object.hasOwn(data_maps,ids[i].map)?data_maps[ids[i].map].retrieved?(site.metadata.info[k].schema.fields[fi].ids=data_maps[k]=Object.hasOwn(data_maps[ids[i].map].resource,k)?data_maps[ids[i].map].resource[k]:data_maps[ids[i].map].resource,map_entities(k)):data_maps[ids[i].map].queue.push(k):(f=new XMLHttpRequest,data_maps[ids[i].map]={queue:[k],resource:{},retrieved:!1},f.onreadystatechange=function(url,fi){if(4===f.readyState){if(200!==f.status)throw new Error("load_id_maps failed: "+f.responseText);data_maps[url].resource=JSON.parse(f.responseText),data_maps[url].retrieved=!0;for(var k,i=data_maps[url].queue.length;i--;)site.metadata.info[data_maps[url].queue[i]].schema.fields[fi].ids=data_maps[data_maps[url].queue[i]]=Object.hasOwn(data_maps[url].resource,data_maps[url].queue[i])?data_maps[url].resource[data_maps[url].queue[i]]:data_maps[url].resource,map_entities(data_maps[url].queue[i]);for(k in map_variables(),init_summaries(),init(),_c)Object.hasOwn(_c,k)&&request_queue(k)}}.bind(null,ids[i].map,i),f.open("GET",ids[i].map,!0),f.send(),queued=!0));return queued}function map_variables(){var k,v,i,t,ti,m;for(k in site.metadata.info)if(Object.hasOwn(site.metadata.info,k))for(t=(m=site.metadata.info[k]).time,i=(v=m.schema.fields).length;i--;)if(Object.hasOwn(variables,v[i].name))variables[v[i].name].datasets.push(k),variables[v[i].name].components[k]=[],variables[v[i].name].info[k]=v[i];else if(variables[v[i].name]={datasets:[k],info:{},components:{}},variables[v[i].name].components[k]=[],variables[v[i].name].info[k]=v[i],variables[v[i].name].meta=variables[v[i].name].info[k].info,variables[v[i].name].meta||(variables[v[i].name].meta={full_name:v[i].name,measure:v[i].name.split(":")[1],short_name:format_label(v[i].name)}),Object.hasOwn(variables[v[i].name].meta,"full_name")||(variables[v[i].name].meta.full_name=variables[v[i].name].meta.short_name),Object.hasOwn(variable_info,variables[v[i].name].meta.full_name)||(variable_info[variables[v[i].name].meta.full_name]=variables[v[i].name].meta),!meta.time.length&&v[i].name===t){for(meta.time_range[0]=v[i].min,meta.time_range[1]=v[i].max,meta.time_variable=t,ti=v[i].max-v[i].min+1;ti--;)meta.time[ti]=v[i].min+ti;meta.time_n=meta.time.length}}function map_entities(g){var id,f;for(var id in site.data[g])Object.hasOwn(site.data[g],id)&&(f=data_maps[g][id],entities[id]={group:g,data:site.data[g][id],variables:variable_info,features:f,summaries:{}},f&&(entitiesByName[f.name]=entities[id],Object.hasOwn(f,"district")&&id.length>4&&(f.county=id.substr(0,5))))}function get_checkfun(e){return check_funs[e&&"string"!=typeof e?"includes":"equals"]}function compile_dataview(v){var i,k;if(v.times={},v.time_filters)for(i=v.time_filters.length;i--;)Object.hasOwn(_u,v.time_filters[i].value)&&add_dependency(v.time_filters[i].value,{type:"time_filters",id:v.id});if(v.selection={ids:{},features:{},dataset:{},all:{}},v.n_selected={ids:0,features:0,dataset:0,all:0},v.get={dataset:function(){return valueOf("string"==typeof v.dataset&&Object.hasOwn(_u,v.dataset)?_u[v.dataset].value():v.dataset)},ids:function(){return valueOf("string"==typeof v.ids&&Object.hasOwn(_u,v.ids)?_u[v.ids].value():v.ids)},features:{}},v.ids_check=get_checkfun(v.get.ids()),v.feature_checks={},v.features)for(k in v.features)Object.hasOwn(v.features,k)&&(v.get.features[k]=function(){return valueOf(v.features[k])},v.feature_checks[k]=get_checkfun(valueOf(v.features[k])));v.k="",v.checks={dataset:function(e){return this.get.dataset()===e.group}.bind(v),ids:("string"==typeof v.ids&&Object.hasOwn(_u,v.ids)&&("virtual"===_u[v.ids].type&&Object.hasOwn(_u,_u[v.ids].source)||Object.hasOwn(_u[v.ids],"depends")&&Object.hasOwn(_u,_u[v.ids].depends))?"virtual"===_u[v.ids].type?function(e){const c=_u[_u[this.ids].source];return e.features&&this.ids_check(this.get.ids(),e.features[c&&e.group!==valueOf(c.dataset)?valueOf(c.dataset):"id"])}:function(e){const f=_u[_u[this.ids].depends].value();return e.features&&this.ids_check(this.get.ids(),Object.hasOwn(e.features,f)?valueOf(e.features[f]):e.features.id)}:function(e){return e.features&&this.ids_check(this.get.ids(),e.features.id)}).bind(v),features:function(e){for(this.k in this.features)if(Object.hasOwn(this.features,this.k))return e.features&&this.feature_checks[this.k](valueOf(this.features[this.k]),valueOf(e.features[this.k]))}.bind(v)},v.check=function(e){return{ids:!this.ids||this.checks.ids(e),features:!this.features||this.checks.features(e),dataset:!this.dataset||this.checks.dataset(e)}}.bind(v)}function request_queue(id,force){queue[id]=!0,cancelAnimationFrame(queue._timeout),queue._timeout=requestAnimationFrame(run_queue.bind(null,force))}function run_queue(force){for(var k in queue)"_timeout"!==k&&Object.hasOwn(queue,k)&&queue[k]&&(queue[k]=!1,refresh_conditions(k,force))}function refresh_conditions(id,force){if(Object.hasOwn(_c,id)){var c=_u[id],d=_c[id],v,i,ci,n,r=[],pass,k,v=c&&c.value()+"";if(c&&(force||c.state!==v)){for(c.state=v,i=d.length;i--;)"rule"===d[i].type?-1===r.indexOf(d[i].rule)&&r.push(site.rules[d[i].rule]):"function"==typeof _u[d[i].id][d[i].type]?_u[d[i].id][d[i].type]():conditionals[d[i].type](_u[d[i].id],c);for(i=r.length;i--;){for(n=r[i].condition.length,ci=0;ci<n&&(pass=r[i].condition[ci].check());ci++);for(k in r[i].effects)pass?"display"===k?r[i].effects[k].e.classList.remove("hidden"):Object.hasOwn(_u,k)&&_u[k].set(valueOf(r[i].effects[k])):"display"===k?(r[i].effects[k].e.classList.add("hidden"),r[i].effects[k].u&&r[i].effects[k].u.reset()):Object.hasOwn(r[i],"default")&&Object.hasOwn(_u,k)&&_u[k].set(valueOf(r[i].default))}}}}function queue_init_plot(){window.Plotly?(Plotly.newPlot(this.e,this.config),this.e.on("plotly_hover",elements.plot.mouseover.bind(this)).on("plotly_unhover",elements.plot.mouseout.bind(this)).on("plotly_click",elements.plot.click.bind(this))):setTimeout(queue_init_plot.bind(this),10)}function queue_init_map(){if(window.L){if(this.map=L.map(this.e,this.options),this.displaying=L.featureGroup().addTo(this.map),Object.hasOwn(site.maps,this.id))for(var k in site.maps[this.id].tiles&&site.maps[this.id].tiles.url&&L.tileLayer(site.maps[this.id].tiles.url,site.maps[this.id].tiles.options).addTo(this.map),site.maps[this.id].shapes)Object.hasOwn(site.maps[this.id].shapes,k)&&retrieve_layer(this,k,site.maps[this.id].shapes[k])}else setTimeout(queue_init_map.bind(this),10)}function queue_init_table(){window.jQuery&&window.DataTable&&Object.hasOwn(site.dataviews[this.view],"get")?(this.options.columns=this.headers[site.dataviews[this.view].get.dataset()],this.table=$(this.e).DataTable(this.options),this.update()):setTimeout(queue_init_table.bind(this),10)}function queue_init(){if("loading"!==document.readyState){if(!load_id_maps())for(var k in init(),init_summaries(),map_variables(),_c)Object.hasOwn(_c,k)&&request_queue(k)}else setTimeout(queue_init,5)}function load_data(url){var f=new XMLHttpRequest;f.onreadystatechange=function(){if(4===f.readyState){if(200!==f.status)throw new Error("load_data failed: "+f.responseText);site.data=JSON.parse(f.responseText),queue_init()}},f.open("GET",url,!0),f.send()}document.onreadystatechange=function(){var k,i,e,c,p,ci,n,o;for(page.navbar=document.getElementsByClassName("navbar")[0],page.navbar=page.navbar?page.navbar.getBoundingClientRect():{height:0},page.content=document.getElementsByClassName("content")[0],page.menus=document.getElementsByClassName("menu-wrapper"),page.content_bounds={top:page.navbar.height,right:0,bottom:0,left:0},page.menu_toggler={hide:function(){this.classList.add("hidden")},toggle:function(type){clearTimeout(page.menu_toggler.timeout),this.nextElementSibling.classList.contains("hidden")?(this.nextElementSibling.classList.remove("hidden"),this.parentElement.style[type]="0px",page.content.style[type]=page.content_bounds[type]-("top"===type?40:0)+this.parentElement.getBoundingClientRect()["left"===type||"right"===type?"width":"height"]+"px"):(this.parentElement.style[type]=-this.parentElement.getBoundingClientRect()["left"===type||"right"===type?"width":"height"]+("top"===type?page.content_bounds.top-40:0)+"px",page.content.style[type]=page.content_bounds[type]+"px",page.menu_toggler.timeout=setTimeout(page.menu_toggler.hide.bind(this.nextElementSibling),700))},timeout:-1},i=page.menus.length;i--;)page.menus[i].classList.contains("menu-top")?(page.top_menu=page.menus[i],page.content_bounds.top+=40,"BUTTON"===page.menus[i].firstElementChild.tagName&&(page.menus[i].firstElementChild.addEventListener("click",page.menu_toggler.toggle.bind(page.menus[i].firstElementChild,"top")),page.menus[i].style.height=page.menus[i].getBoundingClientRect().height+"px")):page.menus[i].classList.contains("menu-right")?(page.right_menu=page.menus[i],page.content_bounds.right=40,"BUTTON"===page.menus[i].firstElementChild.tagName&&page.menus[i].firstElementChild.addEventListener("click",page.menu_toggler.toggle.bind(page.menus[i].firstElementChild,"right"))):page.menus[i].classList.contains("menu-bottom")?(page.bottom_menu=page.menus[i],page.content_bounds.bottom=40,"BUTTON"===page.menus[i].firstElementChild.tagName&&(page.menus[i].firstElementChild.addEventListener("click",page.menu_toggler.toggle.bind(page.menus[i].firstElementChild,"bottom")),page.menus[i].style.height=page.menus[i].getBoundingClientRect().height+"px")):page.menus[i].classList.contains("menu-left")&&(page.left_menu=page.menus[i],page.content_bounds.left=40,"BUTTON"===page.menus[i].firstElementChild.tagName&&page.menus[i].firstElementChild.addEventListener("click",page.menu_toggler.toggle.bind(page.menus[i].firstElementChild,"left")));function content_resize(){page.content.style.top=page.content_bounds.top+(page.top_menu&&!page.top_menu.lastElementChild.classList.contains("hidden")?page.top_menu.getBoundingClientRect().height-40:0)+"px",page.right_menu?page.content.style.right=page.content_bounds.right+(page.right_menu.lastElementChild.classList.contains("hidden")?0:page.right_menu.getBoundingClientRect().width)+"px":page.bottom_menu?page.content.style.bottom=page.content_bounds.bottom+(page.bottom_menu.lastElementChild.classList.contains("hidden")?0:page.bottom_menu.getBoundingClientRect().height)+"px":page.left_menu&&(page.content.style.left=page.content_bounds.left+(page.left_menu.lastElementChild.classList.contains("hidden")?0:page.left_menu.getBoundingClientRect().width)+"px")}for(i=(c=document.getElementsByClassName("legend-scale")).length;i--;)init_legend(c[i]);for(i=(c=document.getElementsByClassName("auto-input")).length,n=0;i--;)o={type:(e=c[i]).getAttribute("auto-type"),source:void 0,value:function(){return valueOf(this.source)||valueOf(this.default)},default:e.getAttribute("default"),options_source:e.getAttribute("auto-options"),depends:e.getAttribute("depends"),variable:e.getAttribute("variable"),dataset:e.getAttribute("dataset")||site.metadata.datasets[0],view:e.getAttribute("data-view"),id:e.id||e.options_source||"ui"+n++,current_index:-1,previous:"",e:e,values:[],display:[],data:[]},Object.hasOwn(elements,o.type)&&(p=elements[o.type],o.options="select"===o.type?o.e.children:o.e.getElementsByTagName("input"),o.set=p.setter.bind(o),o.get=p.retrieve.bind(o),p.adder&&(o.add=p.adder.bind(o)),o.reset=function(){this.set(valueOf(this.default))}.bind(o),o.listen=p.listener.bind(o),_u[o.id]=o);if(site.variables&&site.variables.length)for(n=site.variables.length;n--;){for(k=site.variables[n].id,_u[k]={id:k,type:"virtual",source:site.variables[n].default,previous:void 0,default:site.variables[n].default,current_index:-1,values:[],states:site.variables[n].states,update:function(){this.source=void 0;for(var p,r,c,i=this.states.length;i--;){for(c=this.states[i].condition.length,p=!0;c--;)r=this.states[i].condition[c],check_funs[r.type](valueOf(r.id),valueOf(r.value))||(p=!1);if(p){this.source=this.states[i].value;break}}this.source||(this.source=this.default),this.source!==this.previous&&(this.previous=this.source,request_queue(this.id))},value:function(){return valueOf(this.source)},set:function(v){-1!==this.values.indexOf(v)?(this.previous=this.source,this.source=v):Object.hasOwn(_u,this.source)&&-1!==_u[this.source].values.indexOf(v)&&_u[this.source].set(v),request_queue(this.id)}},_u[k].source&&_u[k].values.push(_u[k].source),p={},i=_u[k].states.length;i--;)for(_u[k].values.push(_u[k].states[i].value),ci=_u[k].states[i].condition.length;ci--;)Object.hasOwn(p,_u[k].states[i].condition[ci].id)||(p[_u[k].states[i].condition[ci].id]={type:"update",id:k});for(k in p)Object.hasOwn(p,k)&&add_dependency(k,p[k])}if(site.rules&&site.rules.length)for(ci=site.rules.length;ci--;){for(k in site.rules[ci].effects)"display"===k&&(site.rules[ci].effects[k]={e:document.getElementById(site.rules[ci].effects[k])},(e=site.rules[ci].effects[k].e.getElementsByClassName("auto-input")).length&&(site.rules[ci].effects[k].u=_u[e[0].id]));for(n=(e=site.rules[ci].condition).length,i=0;i<n;i++)if(Object.hasOwn(check_funs,e[i].type))if(e[i].check=function(){return check_funs[this.type](valueOf(this.id),valueOf(this.value))}.bind(e[i]),Object.hasOwn(_u,e[i].id)&&(add_dependency(e[i].id,{type:"rule",id:e[i].id,condition:e[i],rule:ci}),Object.hasOwn(rule_conditions,e[i].id)||(rule_conditions[e[i].id]={}),rule_conditions[e[i].id][ci]=site.rules[ci]),e[i].check())for(k in site.rules[ci].effects)Object.hasOwn(_u,k)&&_u[k].set(valueOf(site.rules[ci].effects[k]));else if(e[i].default)for(k in site.rules[ci].effects)Object.hasOwn(_u,k)&&_u[k].set(valueOf(e[i].default))}if(content_resize(),window.addEventListener("resize",content_resize),site&&site.data)queue_init();else{if(!site||!site.metadata.file)throw new Error("No data or metadata information present");load_data(site.metadata.file)}}}();