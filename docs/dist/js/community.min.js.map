{"version":3,"file":"community.min.js","sources":["../../../../../js/site/index.ts"],"sourcesContent":["import DataHandler from '../data_handler/index'\r\nimport type {DataSets, Generic, MapInfo, Query, SiteCondition, SiteRule, SiteSpec, Summary} from '../types'\r\nimport {defaults} from './defaults'\r\nimport type {BaseInput, RegisteredInputs, SiteInputs} from './inputs/index'\r\nimport type {RegisteredOutputs, SiteOutputs} from './outputs/index'\r\nimport {GlobalView} from './global_view'\r\nimport {patterns} from './patterns'\r\nimport {storage} from './storage'\r\nimport {Subscriptions} from './subscriptions'\r\nimport * as conditionals from './conditionals'\r\nimport * as utils from './utils'\r\nimport {DiscretePalette, palettes} from './palettes'\r\nimport {InputSelect} from './inputs/select'\r\nimport {InputNumber} from './inputs/number'\r\nimport {SiteDataView} from './dataview'\r\nimport {Page} from './page'\r\nimport {InputVirtual} from './inputs/virtual'\r\nimport {InputButton} from './inputs/button'\r\nimport {InputCombobox} from './inputs/combobox'\r\nimport {InputRadio} from './inputs/radio'\r\nimport {InputCheckbox} from './inputs/checkbox'\r\nimport {OutputInfo} from './outputs/info'\r\nimport {OutputMap} from './outputs/map'\r\nimport {OutputPlotly} from './outputs/plotly'\r\nimport {InputButtonGroup} from './inputs/buttongroup'\r\nimport {InputSwitch} from './inputs/switch'\r\nimport {InputText} from './inputs/text'\r\nimport {OutputDataTable} from './outputs/datatables'\r\nimport {OutputTable} from './outputs/table'\r\nimport {OutputLegend} from './outputs/legend'\r\nimport {OutputText} from './outputs/text'\r\n\r\ntype Queue = {\r\n  timeout: NodeJS.Timer | number\r\n  elements: Map<string, boolean>\r\n}\r\n\r\nconst inputs = {\r\n  button: InputButton,\r\n  buttongroup: InputButtonGroup,\r\n  combobox: InputCombobox,\r\n  select: InputSelect,\r\n  number: InputNumber,\r\n  radio: InputRadio,\r\n  switch: InputSwitch,\r\n  checkbox: InputCheckbox,\r\n  text: InputText,\r\n}\r\nconst outputs = {\r\n  info: OutputInfo,\r\n  map: OutputMap,\r\n  plotly: OutputPlotly,\r\n  datatable: OutputDataTable,\r\n  table: OutputTable,\r\n  legend: OutputLegend,\r\n  text: OutputText,\r\n}\r\n\r\nexport type Dependency = {\r\n  id: string\r\n  type: 'rule' | 'update' | 'filter' | 'display' | 'dataview' | keyof typeof conditionals | keyof BaseInput\r\n  conditional?: keyof typeof conditionals\r\n  condition?: SiteCondition\r\n  uid?: string\r\n  rule?: number\r\n}\r\n\r\ntype Tree = {\r\n  _n: {children: number; parents: number}\r\n  children: {[index: string]: Tree}\r\n  parents: {[index: string]: Tree}\r\n}\r\n\r\nexport default class Community {\r\n  spec: SiteSpec\r\n  storage = storage\r\n  patterns = patterns\r\n  palettes = palettes\r\n  conditionals: {[index: string]: Function} = {}\r\n  data: DataHandler\r\n  page: Page\r\n  view: GlobalView\r\n  subs: Subscriptions\r\n  registered_inputs: Map<string, SiteInputs> = new Map()\r\n  registered_outputs: Map<string, SiteOutputs> = new Map()\r\n  defaults = defaults\r\n  dataviews: {[index: string]: SiteDataView} = {}\r\n  inputs: RegisteredInputs = {}\r\n  outputs: RegisteredOutputs = {}\r\n  dependencies: {[index: string]: Dependency[]} = {}\r\n  url_options: {[index: string]: boolean | string} = {}\r\n  queue: Queue = {timeout: 0, elements: new Map()}\r\n  tree: {[index: string]: Tree} = {}\r\n  maps: MapInfo = {\r\n    queue: {},\r\n    waiting: {},\r\n    overlay_property_selectors: [],\r\n  }\r\n  meta = {\r\n    retain_state: true,\r\n    lock_after: '',\r\n  }\r\n  state = ''\r\n  query = ''\r\n  parsed_query: Query = {}\r\n  endpoint?: string\r\n  rule_conditions: {[index: string]: SiteRule[]} = {}\r\n  constructor(spec?: SiteSpec) {\r\n    if (spec) {\r\n      this.spec = spec\r\n      spec.active = this\r\n    }\r\n    if (!spec.settings) spec.settings = {}\r\n    if (!('dataLayer' in window)) (window as any).dataLayer = []\r\n    storage.copy = storage.get() as Generic\r\n    if (storage.copy)\r\n      for (const k in spec.settings) {\r\n        if (k in storage.copy) {\r\n          let c = storage.copy[k]\r\n          if ('string' === typeof c) {\r\n            if (patterns.bool.test(c)) {\r\n              c = !!c || 'true' === c\r\n            } else if (patterns.number.test(c)) c = parseFloat(c)\r\n          }\r\n          spec.settings[k] = c\r\n        }\r\n      }\r\n    function poly_channel(ch: number, pos: number, coefs: number[][]) {\r\n      const n = coefs.length\r\n      let v = coefs[0][ch] + pos * coefs[1][ch],\r\n        i = 2\r\n      for (; i < n; i++) {\r\n        v += Math.pow(pos, i) * coefs[i][ch]\r\n      }\r\n      return Math.max(0, Math.min(255, v))\r\n    }\r\n    Object.keys(palettes).forEach(k => {\r\n      const n = 255\r\n      let p = palettes[k]\r\n      if ('continuous-polynomial' === p.type) {\r\n        const c = p.colors as number[][],\r\n          r: DiscretePalette = {name: k, type: 'discrete', colors: []}\r\n        for (let i = 0; i < n; i++) {\r\n          const v = i / n\r\n          r.colors.push(\r\n            'rgb(' + poly_channel(0, v, c) + ', ' + poly_channel(1, v, c) + ', ' + poly_channel(2, v, c) + ')'\r\n          )\r\n        }\r\n        p = palettes[k] = r\r\n      }\r\n      p.odd = p.colors.length % 2\r\n    })\r\n    this.query = window.location.search.replace('?', '')\r\n    if (this.query) {\r\n      this.query.split('&').forEach(a => {\r\n        const c = a.split('='),\r\n          k = c[0]\r\n        let v: string | boolean\r\n        if (c.length < 2) c.push('true')\r\n        v = patterns.bool.test(c[1]) ? !!c[1] || 'true' === c[1] : c[1].replace(patterns.url_spaces, ' ')\r\n        this.url_options[c[0]] = v\r\n        if (patterns.settings.test(c[0])) storage.set(c[0].replace(patterns.settings, ''), v)\r\n      })\r\n    }\r\n    if ('embedded' in this.url_options || 'hide_navbar' in this.url_options) {\r\n      if (!('hide_logo' in this.url_options)) this.url_options.hide_logo = true\r\n      if (!('hide_title' in this.url_options)) this.url_options.hide_title = true\r\n      if (!('hide_navcontent' in this.url_options)) this.url_options.hide_navcontent = true\r\n      if (!('hide_panels' in this.url_options)) this.url_options.hide_panels = true\r\n      if ('embedded' in this.url_options && !('close_menus' in this.url_options)) this.url_options.close_menus = true\r\n    }\r\n    this.init = this.init.bind(this)\r\n    this.request_queue = this.request_queue.bind(this)\r\n    this.run_queue = this.run_queue.bind(this)\r\n    this.global_reset = this.global_reset.bind(this)\r\n    Object.keys(conditionals).forEach(\r\n      (k: keyof typeof conditionals) => (this.conditionals[k] = conditionals[k].bind(this))\r\n    )\r\n    if (this.spec.dataviews) {\r\n      this.defaults.dataview = Object.keys(this.spec.dataviews)[0]\r\n    } else {\r\n      this.spec.dataviews = {}\r\n      this.spec.dataviews[this.defaults.dataview] = {}\r\n    }\r\n    if (!this.maps.overlay_property_selectors) this.maps.overlay_property_selectors = []\r\n    this.view = new GlobalView(this)\r\n    new Page(this)\r\n    document.querySelectorAll('.auto-input').forEach((e: HTMLElement) => {\r\n      if (e.dataset.autotype in inputs && !(e.id in this.inputs)) {\r\n        const u = new inputs[e.dataset.autotype as keyof typeof inputs](e, this)\r\n        this.registered_inputs.set(u.id, u)\r\n        this.inputs[u.id] = u\r\n      }\r\n    })\r\n    this.subs = new Subscriptions(this)\r\n    document.querySelectorAll('.auto-output').forEach((e: HTMLElement) => {\r\n      if (e.dataset.autotype in outputs && !(e.id in this.outputs)) {\r\n        const u = new outputs[e.dataset.autotype as keyof typeof outputs](e, this)\r\n        this.registered_outputs.set(u.id, u)\r\n        this.outputs[u.id] = u\r\n        const opt = 'options' in u ? u.options : u.spec\r\n        if ('subto' in opt) {\r\n          if ('string' === typeof opt.subto) opt.subto = [opt.subto]\r\n          if (Array.isArray(opt.subto)) opt.subto.forEach(v => this.subs.add(v, u))\r\n        }\r\n      }\r\n    })\r\n    if (spec.variables && spec.variables.length)\r\n      spec.variables.forEach(v => {\r\n        const u = new InputVirtual(v, this)\r\n        this.registered_inputs.set(v.id, u)\r\n        this.inputs[v.id] = u\r\n      })\r\n    this.defaults.dataset = this.spec.dataviews[defaults.dataview].dataset\r\n    if (!this.spec.metadata) this.spec.metadata = {datasets: []}\r\n    const sets = this.spec.metadata.datasets\r\n    if (sets && sets.length && -1 === sets.indexOf(this.defaults.dataset)) {\r\n      if (1 === sets.length) {\r\n        this.defaults.dataset = sets[0]\r\n      } else {\r\n        this.registered_inputs.forEach(u => {\r\n          if (!this.defaults.dataset) {\r\n            const d = u.default\r\n            if (-1 !== sets.indexOf(u.dataset)) {\r\n              this.defaults.dataset = u.dataset\r\n            } else if ('string' === typeof d && -1 !== sets.indexOf(d)) {\r\n              this.defaults.dataset = d\r\n            } else if (\r\n              'select' === u.type &&\r\n              'number' === typeof d &&\r\n              u.options[d] &&\r\n              -1 !== sets.indexOf(u.options[d].value)\r\n            ) {\r\n              this.defaults.dataset = u.options[d].value\r\n            } else if (\r\n              ('select' === u.type || 'combobox' === u.type) &&\r\n              Array.isArray(u.values) &&\r\n              u.values[u.default] &&\r\n              -1 !== sets.indexOf(u.values[u.default])\r\n            ) {\r\n              this.defaults.dataset = u.values[u.default]\r\n            }\r\n          }\r\n        })\r\n        if (!this.defaults.dataset) this.defaults.dataset = sets[sets.length - 1]\r\n      }\r\n      this.defaults.dataset = this.valueOf(this.defaults.dataset) as string\r\n      if (-1 === sets.indexOf(this.defaults.dataset)) this.defaults.dataset = sets[0]\r\n      this.registered_inputs.forEach(u => {\r\n        if (!u.dataset) u.dataset = this.defaults.dataset\r\n      })\r\n      if (!this.spec.dataviews[defaults.dataview].dataset)\r\n        this.spec.dataviews[defaults.dataview].dataset = this.defaults.dataset\r\n    }\r\n    if (spec.rules && spec.rules.length) {\r\n      spec.rules.forEach((r, i) => {\r\n        r.parsed = {}\r\n        if ('display' in r.effects) {\r\n          r.parsed.display = {e: document.getElementById(r.effects.display)}\r\n          const e = r.parsed.display.e.querySelector('.auto-input')\r\n          if (e) {\r\n            const u = this.inputs[e.id]\r\n            u.rule = r\r\n            r.parsed.display.u = u\r\n          }\r\n        }\r\n        if ('lock' in r.effects) {\r\n          const us = new Map()\r\n          document.querySelectorAll('#' + r.effects.lock + ' .auto-input').forEach(e => us.set(e.id, this.inputs[e.id]))\r\n          r.parsed.lock = us\r\n        }\r\n        r.condition.forEach(c => {\r\n          if (c.type in DataHandler.checks) {\r\n            c.check = function (this: {c: SiteCondition; site: Community}) {\r\n              return DataHandler.checks[this.c.type](this.site.valueOf(this.c.id), this.site.valueOf(this.c.value))\r\n            }.bind({c, site: this})\r\n            if (c.id in this.inputs) {\r\n              this.add_dependency(c.id, {type: 'rule', id: c.id, condition: c, rule: i})\r\n              if (!(c.id in this.rule_conditions)) this.rule_conditions[c.id] = []\r\n              this.rule_conditions[c.id][i] = r\r\n            }\r\n            if (c.check()) {\r\n              Object.keys(r.effects).forEach(k => {\r\n                if (k in this.inputs) this.inputs[k].set(this.valueOf(r.effects[k]) as string)\r\n              })\r\n            } else if (c.default) {\r\n              Object.keys(r.effects).forEach(k => {\r\n                if (k in this.inputs) this.inputs[k].set(this.valueOf(c.default) as string)\r\n              })\r\n            }\r\n          }\r\n        })\r\n      })\r\n    }\r\n    const dataset = this.valueOf(this.spec.dataviews[this.defaults.dataview].dataset) as string | number\r\n    this.defaults.dataset = 'number' === typeof dataset ? sets[dataset] : dataset\r\n    if (-1 === sets.indexOf(this.defaults.dataset)) this.defaults.dataset = sets[0]\r\n    this.data = new DataHandler(this.spec, this.defaults, this.data as unknown as DataSets, {\r\n      init: this.init,\r\n      onload: function (this: Community) {\r\n        if (this.data.inited) clearTimeout(this.data.inited.load_screen as NodeJS.Timeout)\r\n        setTimeout(this.drop_load_screen.bind(this), 600)\r\n        delete this.data.onload\r\n      }.bind(this),\r\n      data_load: function (this: Community) {\r\n        Object.keys(this.dependencies).forEach(k => this.request_queue(false, k))\r\n      }.bind(this),\r\n    })\r\n  }\r\n  init() {\r\n    if (this.data.variables) {\r\n      const variable = Object.keys(this.data.variables)\r\n      this.defaults.variable = variable[variable.length - 1]\r\n    }\r\n    Object.keys(this.spec.dataviews).forEach(id => new SiteDataView(this, id, this.spec.dataviews[id]))\r\n    this.view.init()\r\n    this.page.init()\r\n    if (this.query) {\r\n      this.parsed_query = this.data.parse_query(this.query)\r\n      if (this.parsed_query.variables.conditions.length) {\r\n        this.parsed_query.variables.conditions.forEach(f => {\r\n          const info = this.data.variable_info[f.name]\r\n          if (info) this.page.add_filter_condition(f.name, f)\r\n        })\r\n      }\r\n    }\r\n    this.run_queue()\r\n    this.registered_inputs.forEach(async o => {\r\n      const combobox = 'combobox' === o.type\r\n      if (o.optionSource && 'options' in o) {\r\n        if (patterns.palette.test(o.optionSource)) {\r\n          o.options = []\r\n          Object.keys(palettes).forEach(v => o.add(v, palettes[v].name))\r\n          if (-1 === o.default) o.default = defaults.palette\r\n        } else if (patterns.datasets.test(o.optionSource)) {\r\n          if (-1 === o.default) o.default = defaults.dataset\r\n          o.options = []\r\n          this.spec.metadata.datasets.forEach(d => o.add(d))\r\n        } else if ('option_sets' in o) {\r\n          o.sensitive = false\r\n          if (patterns.properties.test(o.optionSource)) {\r\n            this.maps.overlay_property_selectors.push(o)\r\n          }\r\n          if (o.depends) this.add_dependency(o.depends as string, {type: 'options', id: o.id})\r\n          if (o.dataset in this.inputs) this.add_dependency(o.dataset, {type: 'options', id: o.id})\r\n          if (o.view) this.add_dependency(o.view, {type: 'options', id: o.id})\r\n          const v = this.valueOf(o.dataset) || defaults.dataset\r\n          if ('string' === typeof v) {\r\n            if (!o.dataset) o.dataset = v\r\n            if (v in this.data.info) this.conditionals.options(o)\r\n          }\r\n        }\r\n      }\r\n      if (combobox || 'select' === o.type) {\r\n        // resolve options\r\n        if (Array.isArray(o.values)) {\r\n          o.values = {}\r\n          o.display = {}\r\n          let new_display = true\r\n          const select = 'select' === o.type\r\n          o.options.forEach(e => {\r\n            if (select) e.dataset.value = (e as HTMLOptionElement).value\r\n            if (new_display) new_display = e.dataset.value === e.innerText\r\n          })\r\n          o.options.forEach((e, i) => {\r\n            o.values[e.dataset.value] = i\r\n            if (new_display) e.innerText = this.data.format_label(e.dataset.value)\r\n            o.display[e.innerText] = i\r\n          })\r\n          if (!(o.default in o.values) && !(o.default in this.inputs)) {\r\n            o.default = +o.default\r\n            if (isNaN(o.default)) o.default = -1\r\n            if (-1 !== o.default && o.default < o.options.length) {\r\n              o.default = o.options[o.default].dataset.value\r\n            } else {\r\n              o.default = -1\r\n            }\r\n          }\r\n          o.source = ''\r\n          o.id in this.url_options ? o.set(this.url_options[o.id] as string) : o.reset()\r\n        }\r\n        o.subset = o.e.dataset.subset || 'all'\r\n        o.selection_subset = o.e.dataset.selectionSubset || o.subset\r\n        if (o.type in this.spec && o.id in this.spec[o.type]) {\r\n          o.settings = this.spec[o.type][o.id]\r\n          if (o.settings.filters) {\r\n            Object.keys(o.settings.filters).forEach(f => {\r\n              this.add_dependency(o.settings.filters[f], {type: 'filter', id: o.id})\r\n            })\r\n          }\r\n        }\r\n      } else if ('number' === o.type) {\r\n        // retrieve option values\r\n        o.min = o.e.getAttribute('min')\r\n        o.min_ref = parseFloat(o.min)\r\n        o.min_indicator = o.e.parentElement.parentElement.querySelector('.indicator-min')\r\n        if (o.min_indicator) {\r\n          o.min_indicator.addEventListener(\r\n            'click',\r\n            function (this: InputNumber) {\r\n              this.set(this.parsed.min)\r\n            }.bind(o)\r\n          )\r\n        }\r\n        o.max = o.e.getAttribute('max')\r\n        o.max_ref = parseFloat(o.max)\r\n        o.max_indicator = o.e.parentElement.parentElement.querySelector('.indicator-max')\r\n        if (o.max_indicator) {\r\n          o.max_indicator.addEventListener(\r\n            'click',\r\n            function (this: InputNumber) {\r\n              this.set(this.parsed.max)\r\n            }.bind(o)\r\n          )\r\n        }\r\n        o.ref = isNaN(o.min_ref) || isNaN(o.max_ref)\r\n        o.range = [o.min_ref, o.max_ref]\r\n        o.step = parseFloat(o.e.step) || 1\r\n        o.parsed = {min: undefined, max: undefined}\r\n        o.depends = {}\r\n        o.default_max = 'max' === o.default || 'last' === o.default\r\n        o.default_min = 'min' === o.default || 'first' === o.default\r\n        if (o.view) this.add_dependency(o.view, {type: 'update', id: o.id})\r\n        if (!(o.max in this.data.variables)) {\r\n          if (o.max in this.inputs) {\r\n            this.add_dependency(o.max, {type: 'max', id: o.id})\r\n          } else o.e.max = o.max\r\n        } else if (o.view) {\r\n          this.add_dependency(o.view + '_time', {type: 'max', id: o.id})\r\n        }\r\n        if (!(o.min in this.data.variables)) {\r\n          if (o.min in this.inputs) {\r\n            this.add_dependency(o.min, {type: 'min', id: o.id})\r\n          } else o.e.min = o.min\r\n        } else if (o.view) {\r\n          this.add_dependency(o.view + '_time', {type: 'min', id: o.id})\r\n        }\r\n        if ('undefined' !== typeof o.default) {\r\n          if (patterns.number.test(o.default as string)) {\r\n            o.default = +o.default\r\n          } else\r\n            o.reset = o.default_max\r\n              ? function (this: InputNumber) {\r\n                  if (this.range) {\r\n                    this.current_default = this.site.valueOf(this.range[1]) as number\r\n                    this.set(this.current_default)\r\n                  }\r\n                }.bind(o)\r\n              : o.default_max\r\n              ? function (this: InputNumber) {\r\n                  if (this.range) {\r\n                    this.current_default = this.site.valueOf(this.range[0]) as number\r\n                    this.set(this.current_default)\r\n                  }\r\n                }.bind(o)\r\n              : o.default in this.inputs\r\n              ? function (this: InputNumber) {\r\n                  this.current_default = this.site.valueOf(this.default) as number\r\n                  this.set(this.current_default)\r\n                }.bind(o)\r\n              : function () {}\r\n        }\r\n        if (o.variable) {\r\n          const d = -1 === this.spec.metadata.datasets.indexOf(o.dataset) ? defaults.dataset : o.dataset\r\n          if (o.variable in this.inputs) {\r\n            this.add_dependency(o.variable, {type: 'update', id: o.id})\r\n          } else if (o.variable in this.data.variables) {\r\n            o.min = o.parsed.min = o.range[0] = this.data.variables[o.variable].info[d].min\r\n            o.e.min = o.min + ''\r\n            o.max = o.parsed.max = o.range[1] = this.data.variables[o.variable].info[d].max\r\n            o.e.max = o.max + ''\r\n          }\r\n        }\r\n      }\r\n      if ('select' === o.type || 'number' === o.type || 'text' === o.type) {\r\n        if (\r\n          o.e.parentElement.lastElementChild &&\r\n          o.e.parentElement.lastElementChild.classList.contains('select-reset')\r\n        ) {\r\n          o.e.parentElement.lastElementChild.addEventListener('click', o.reset.bind(o))\r\n        }\r\n      }\r\n      if (patterns.settings.test(o.id)) {\r\n        o.setting = o.id.replace(patterns.settings, '')\r\n        if (null == o.default && o.setting in this.spec.settings) o.default = this.spec.settings[o.setting] as string\r\n        this.add_dependency(o.id, {type: 'setting', id: o.id})\r\n      }\r\n      if (!o.view) o.view = defaults.dataview\r\n      const v = this.url_options[o.id] || storage.get(o.id.replace(patterns.settings, ''))\r\n      if ('init' in o) o.init()\r\n      if (v) {\r\n        o.set(v as string)\r\n      } else {\r\n        o.reset()\r\n      }\r\n    })\r\n    this.registered_outputs.forEach(o => {\r\n      if ('init' in o) o.init()\r\n    })\r\n  }\r\n  global_update() {\r\n    this.meta.retain_state = false\r\n    this.queue.elements.forEach(this.request_queue)\r\n    this.registered_outputs.forEach(u => u.update())\r\n  }\r\n  global_reset() {\r\n    this.meta.retain_state = false\r\n    this.registered_inputs.forEach((u, k) => {\r\n      if (!u.setting && u.reset) {\r\n        u.reset()\r\n        this.request_queue(false, k)\r\n      }\r\n    })\r\n  }\r\n  clear_storage() {\r\n    if (window.localStorage) storage.perm.removeItem(storage.name)\r\n    window.location.reload()\r\n  }\r\n  request_queue(waiting: boolean | string, id?: string) {\r\n    if ('boolean' !== typeof waiting) {\r\n      id = waiting as string\r\n      waiting = false\r\n    }\r\n    if (!waiting && (-1 === this.queue.timeout || !this.queue.elements.get(id))) {\r\n      this.queue.elements.set(id, true)\r\n      if ((this.queue.timeout as number) > 0) clearTimeout(this.queue.timeout as number)\r\n      this.queue.timeout = setTimeout(this.run_queue, 20)\r\n      this.meta.lock_after = id\r\n    }\r\n  }\r\n  run_queue() {\r\n    if ((this.queue.timeout as number) > 0) clearTimeout(this.queue.timeout as number)\r\n    this.queue.timeout = -1\r\n    this.queue.elements.forEach((fire, k) => {\r\n      if (fire) {\r\n        const d = this.refresh_conditions(k) as string\r\n        if (d) {\r\n          if (!(k in this.data.data_queue[d])) this.data.data_queue[d][k] = this.run_queue\r\n          return false\r\n        }\r\n        this.queue.elements.set(k, false)\r\n      }\r\n    })\r\n    let k = this.get_options_url()\r\n    if (this.data.inited.first && k !== this.state) {\r\n      this.state = k\r\n      Object.keys(this.url_options).forEach(s => {\r\n        const v = this.url_options[s]\r\n        if ('string' === typeof v && patterns.embed_setting.test(s))\r\n          k += '&' + s + '=' + ('navcolor' === s ? v.replace(patterns.hashes, '%23') : v)\r\n      })\r\n      if (!this.spec.settings.hide_url_parameters) {\r\n        window.history.replaceState(Date.now(), '', k)\r\n      }\r\n      setTimeout(this.page.resize, 50)\r\n    }\r\n  }\r\n  refresh_conditions(id: string) {\r\n    if (id in this.dependencies) {\r\n      const d = this.dependencies[id],\r\n        r: number[] = [],\r\n        c = 'view.' === id.substring(0, 5) ? this.view : id in this.dataviews ? this.dataviews[id] : this.inputs[id],\r\n        is_view = c instanceof SiteDataView,\r\n        is_global = c instanceof GlobalView,\r\n        part = 'id' === id.substring(5) ? 'id_state' : 'filter_state',\r\n        v = is_global ? c[part]() : c && c.value() + '',\r\n        state = is_global ? c.states[part] : c && c.state\r\n      if (c && (!this.meta.retain_state || state !== v)) {\r\n        if (is_global) {\r\n          c.states[part] = v\r\n        } else if (!is_view) {\r\n          const view = this.dataviews[c.view],\r\n            dd =\r\n              v in this.data.loaded ? v : c.dataset ? (this.valueOf(c.dataset) as string) : view && view.get.dataset()\r\n          if (this.data.info && dd in this.data.loaded && !this.data.loaded[dd]) {\r\n            if (!c.deferred) this.data.retrieve(dd, this.data.info[dd].site_file)\r\n            return dd\r\n          }\r\n          c.state = v\r\n        } else {\r\n          c.state = v\r\n        }\r\n        d.forEach(di => {\r\n          if ('rule' === di.type) {\r\n            if (-1 === r.indexOf(di.rule)) {\r\n              r.push(di.rule)\r\n            }\r\n          } else if ('dataview' === di.type) {\r\n            this.dataviews[di.id].update()\r\n          } else if (di.conditional) {\r\n            this.conditionals[di.conditional](di.id in this.dataviews ? this.dataviews[di.id] : this.inputs[di.id], c)\r\n          } else if (di.id in this.inputs) {\r\n            const du = this.inputs[di.id]\r\n            di.type in du && (du[di.type as keyof BaseInput] as Function)()\r\n          } else if (di.id in this.outputs) {\r\n            const du = this.outputs[di.id]\r\n            di.type in du && du[di.type as 'update']()\r\n          }\r\n        })\r\n        r.forEach(i => {\r\n          let pass = false\r\n          const ri = this.spec.rules[i],\r\n            n = ri.condition.length\r\n          for (let i = 0; i < n; i++) {\r\n            const ck = ri.condition[i]\r\n            pass = ck.check()\r\n            if (ck.any ? pass : !pass) break\r\n          }\r\n          Object.keys(ri.parsed).forEach(k => {\r\n            if (pass) {\r\n              if ('display' === k) {\r\n                ri.parsed[k].e.classList.remove('hidden')\r\n              } else if ('lock' === k) {\r\n                ri.parsed[k].forEach((u: InputSelect) => {\r\n                  u.e.classList.remove('locked')\r\n                  utils.toggle_input(u, true)\r\n                })\r\n              } else if (k in this.inputs) {\r\n                const value = this.valueOf(ri.effects[k]) as string\r\n                this.inputs[k].set(value)\r\n              }\r\n            } else if ('display' === k) {\r\n              const e = ri.parsed[k]\r\n              if (!e.e.classList.contains('hidden')) {\r\n                e.e.classList.add('hidden')\r\n                if (e.u && e.u.reset) e.u.reset()\r\n                e.e.querySelectorAll('.auto-input').forEach(c => {\r\n                  const input = this.inputs[c.id]\r\n                  if (input && input.reset) input.reset()\r\n                })\r\n              }\r\n            } else if ('lock' === k) {\r\n              ri.parsed[k].forEach((u: InputSelect) => {\r\n                u.e.classList.add('locked')\r\n                utils.toggle_input(u)\r\n              })\r\n            } else if ('default' in ri) {\r\n              if (k in this.inputs) {\r\n                this.inputs[k].set(this.valueOf(ri.default) as string)\r\n              }\r\n            }\r\n          })\r\n        })\r\n      }\r\n      if (id === this.meta.lock_after) this.meta.retain_state = true\r\n    }\r\n  }\r\n  valueOf(v: boolean | string | number | (string | number)[]): boolean | string | number | (string | number)[] {\r\n    return 'string' === typeof v && v in this.inputs ? this.valueOf(this.inputs[v].value()) : v\r\n  }\r\n  get_options_url() {\r\n    let s = ''\r\n    this.registered_inputs.forEach((u, k) => {\r\n      if ('virtual' !== u.type && !patterns.settings.test(k)) {\r\n        if (!('range' in u) || u.range[0] !== u.range[1]) {\r\n          let v = u.value() as number | string | string[]\r\n          if ('off_default' in u ? u.off_default : v !== u.default) {\r\n            if (Array.isArray(v)) v = v.join(',')\r\n            if ('' !== v && null != v && '-1' != v) s += (s ? '&' : '?') + k + '=' + v\r\n          }\r\n        }\r\n      }\r\n    })\r\n    if (this.data && this.view.filters.size) s += (s ? '&' : '?') + this.view.filter_state([])\r\n    return window.location.protocol + '//' + window.location.host + window.location.pathname + s\r\n  }\r\n  gtag(...args: any) {\r\n    if (this.spec.settings.tracking) (window as any).dataLayer.push(arguments)\r\n  }\r\n  drop_load_screen() {\r\n    if (this.data && this.data.inited) clearTimeout(+this.data.inited.load_screen)\r\n    this.page.wrap.style.visibility = 'visible'\r\n    this.page.load_screen.style.display = 'none'\r\n    if (this.spec.tutorials && 'tutorial' in this.url_options) {\r\n      setTimeout(\r\n        this.page.tutorials.start_tutorial.bind(this.page.tutorials, {\r\n          target: {dataset: {name: this.url_options.tutorial}},\r\n        }),\r\n        0\r\n      )\r\n    }\r\n  }\r\n  add_dependency(id: string, o: Dependency): void {\r\n    if (!(id in this.dependencies)) this.dependencies[id] = []\r\n    if (!o.uid) o.uid = JSON.stringify(o)\r\n    if (o.type in this.conditionals) {\r\n      o.conditional = o.type as keyof typeof conditionals\r\n    }\r\n    const c = this.dependencies[id]\r\n    for (let i = c.length; i--; ) if (o.uid === c[i].uid) return void 0\r\n    c.push(o)\r\n    if (!(id in this.tree)) this.tree[id] = {_n: {children: 0, parents: 0}, children: {}, parents: {}}\r\n    if (!(o.id in this.tree)) this.tree[o.id] = {_n: {children: 0, parents: 0}, children: {}, parents: {}}\r\n    this.tree[id].children[o.id] = this.tree[o.id]\r\n    this.tree[id]._n.children++\r\n    this.tree[o.id].parents[id] = this.tree[id]\r\n    this.tree[o.id]._n.parents++\r\n    c.sort((a, b) => {\r\n      return !(a.id in this.tree) || !(b.id in this.tree)\r\n        ? -Infinity\r\n        : this.tree[a.id]._n.children - this.tree[b.id]._n.children\r\n    })\r\n    this.request_queue(true, id)\r\n  }\r\n  get_color(value: number, which: string, summary: Summary, index: number, rank: number, total: number) {\r\n    const pal = palettes[which]\r\n    if (isNaN(value) || 'continuous-polynomial' === pal.type) return this.defaults.missing\r\n    const settings = this.spec.settings,\r\n      centered = 'none' !== settings.color_scale_center && !settings.color_by_order,\r\n      fixed = 'discrete' === pal.type,\r\n      string = 'string' === summary.type,\r\n      min = !string ? summary.min[index] : 0,\r\n      range = string ? summary.levels.length - min : summary.range[index],\r\n      stat =\r\n        'none' === settings.color_scale_center || patterns.median.test(settings.color_scale_center as string)\r\n          ? 'median'\r\n          : 'mean',\r\n      center_source = ((settings.color_by_order ? 'break_' : 'norm_') + stat) as 'break_mean',\r\n      center = settings.color_by_order\r\n        ? centered\r\n          ? summary[center_source][index] / total\r\n          : 0.5\r\n        : isNaN(summary[center_source][index])\r\n        ? 0.5\r\n        : summary[center_source][index],\r\n      r = fixed\r\n        ? centered && !settings.color_by_order\r\n          ? Math.ceil(pal.colors.length / 2) - pal.odd / 2\r\n          : pal.colors.length\r\n        : 1,\r\n      p = settings.color_by_order\r\n        ? (rank + 0.5) / total\r\n        : range\r\n        ? ((string ? summary.level_ids[value] : value) - min) / range\r\n        : 0.5,\r\n      upper = p > (centered ? center : 0.5),\r\n      bound_ref = upper ? 'upper_' : 'lower_',\r\n      value_min = (bound_ref + stat + '_min') as 'upper_mean_min',\r\n      value_range = (bound_ref + stat + '_range') as 'upper_mean_range'\r\n    let v = centered\r\n      ? range\r\n        ? ((upper ? p - center : p + center) - summary[value_min][index]) / summary[value_range][index]\r\n        : 1\r\n      : p\r\n    if (!fixed) {\r\n      v = Math.max(0, Math.min(1, v))\r\n      if (upper) v = 1 - v\r\n      if (!centered) v *= 2\r\n    }\r\n    return (string ? value in summary.level_ids : 'number' === typeof value)\r\n      ? fixed\r\n        ? pal.colors[\r\n            Math.max(0, Math.min(pal.colors.length - 1, Math.floor(centered ? (upper ? r + r * v : r * v) : r * v)))\r\n          ]\r\n        : 'rgb(' +\r\n          (upper\r\n            ? pal.colors[0][0][0] +\r\n              v * pal.colors[0][1][0] +\r\n              ', ' +\r\n              (pal.colors[0][0][1] + v * pal.colors[0][1][1]) +\r\n              ', ' +\r\n              (pal.colors[0][0][2] + v * pal.colors[0][1][2])\r\n            : pal.colors[2][0][0] +\r\n              v * pal.colors[2][1][0] +\r\n              ', ' +\r\n              (pal.colors[2][0][1] + v * pal.colors[2][1][1]) +\r\n              ', ' +\r\n              (pal.colors[2][0][2] + v * pal.colors[2][1][2])) +\r\n          ')'\r\n      : defaults.missing\r\n  }\r\n}\r\n"],"names":["index_1","tslib_1","__importDefault","require","defaults_1","global_view_1","patterns_1","storage_1","subscriptions_1","conditionals","__importStar","utils","palettes_1","select_1","number_1","dataview_1","page_1","virtual_1","button_1","combobox_1","radio_1","checkbox_1","info_1","map_1","plotly_1","buttongroup_1","switch_1","text_1","datatables_1","table_1","legend_1","text_2","inputs","button","InputButton","buttongroup","InputButtonGroup","combobox","InputCombobox","select","InputSelect","number","InputNumber","radio","InputRadio","switch","InputSwitch","checkbox","InputCheckbox","text","InputText","outputs","info","OutputInfo","map","OutputMap","plotly","OutputPlotly","datatable","OutputDataTable","table","OutputTable","legend","OutputLegend","OutputText","exports","default","constructor","spec","this","storage","patterns","palettes","registered_inputs","Map","registered_outputs","defaults","dataviews","dependencies","url_options","queue","timeout","elements","tree","maps","waiting","overlay_property_selectors","meta","retain_state","lock_after","state","query","parsed_query","rule_conditions","active","settings","window","dataLayer","copy","get","k","c","bool","test","parseFloat","poly_channel","ch","pos","coefs","n","length","v","i","Math","pow","max","min","Object","keys","forEach","p","type","colors","r","name","push","odd","location","search","replace","split","a","url_spaces","set","hide_logo","hide_title","hide_navcontent","hide_panels","close_menus","init","bind","request_queue","run_queue","global_reset","dataview","view","Page","document","querySelectorAll","e","dataset","autotype","id","u","subs","opt","options","subto","Array","isArray","add","variables","InputVirtual","metadata","datasets","sets","indexOf","d","value","values","valueOf","rules","parsed","effects","display","getElementById","querySelector","rule","us","lock","condition","checks","check","site","add_dependency","data","onload","inited","clearTimeout","load_screen","setTimeout","drop_load_screen","data_load","variable","SiteDataView","page","parse_query","conditions","f","variable_info","add_filter_condition","o","__awaiter","optionSource","palette","sensitive","properties","depends","new_display","innerText","format_label","isNaN","source","reset","subset","selection_subset","selectionSubset","filters","getAttribute","min_ref","min_indicator","parentElement","addEventListener","max_ref","max_indicator","ref","range","step","undefined","default_max","default_min","current_default","lastElementChild","classList","contains","setting","global_update","update","clear_storage","localStorage","perm","removeItem","reload","fire","refresh_conditions","data_queue","get_options_url","first","s","embed_setting","hashes","hide_url_parameters","history","replaceState","Date","now","resize","substring","is_view","is_global","GlobalView","part","states","dd","loaded","deferred","retrieve","site_file","di","conditional","du","pass","ri","ck","any","remove","toggle_input","input","off_default","join","size","filter_state","protocol","host","pathname","gtag","args","tracking","arguments","wrap","style","visibility","tutorials","start_tutorial","target","tutorial","uid","JSON","stringify","_n","children","parents","sort","b","Infinity","get_color","which","summary","index","rank","total","pal","missing","centered","color_scale_center","color_by_order","fixed","string","levels","stat","median","center_source","center","ceil","level_ids","upper","bound_ref","value_range","floor"],"mappings":"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"}