"use strict";function DataCommons(e,t,i){Object.hasOwn||Object.defineProperty(Object,"hasOwn",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(e),t)},configurable:!0,enumerable:!1,writable:!0}),this.definition=e,this.manifest=t,this.views=i,this.named_view={},this.counts={views:0,repos:0,files:0,variables:0,ids:0},this.variables=new Map,this.ids={},this.repos={},this.providers={},this.dists={},this.file_ids={},this.files={},this.page={current_tab:"#search",menu:{check_all:document.getElementById("refresh_button")},body:document.getElementsByClassName("content")[0],container:document.createElement("div"),tooltip:document.createElement("div"),tabs:{search:document.createElement("div"),repos:document.createElement("div"),views:document.createElement("div")},modal:{frame:document.createElement("div"),title:document.createElement("div"),body:document.createElement("div"),files:document.createElement("div"),dashboards:document.createElement("div"),measure_info:document.createElement("div")},views:{},repos:{},files:{},order:[]},this.page.body.appendChild(this.page.container),this.page.container.className="commons",this.page.container.appendChild(this.page.tabs.repos),this.page.container.appendChild(this.page.tabs.search);const a=this.page.modal;document.body.appendChild(a.frame),a.frame.className="modal fade",a.frame.id="general_modal",a.frame.tabIndex=-1,a.frame.setAttribute("data-bs-theme","dark"),a.frame.setAttribute("aria-labelledby","general_modal_label"),a.frame.setAttribute("aria-hidden","true"),a.frame.appendChild(document.createElement("div")),a.frame.lastElementChild.className="modal-dialog",a.frame.lastElementChild.appendChild(document.createElement("div")),a.frame.lastElementChild.lastElementChild.className="modal-content",a.frame.lastElementChild.lastElementChild.appendChild(a.title),a.title.className="modal-header",a.title.appendChild(document.createElement("h3")),a.title.firstElementChild.className="modal-title",a.title.firstElementChild.id="general_modal_label",a.title.appendChild(document.createElement("button")),a.title.lastElementChild.type="button",a.title.lastElementChild.className="btn-close",a.title.lastElementChild.setAttribute("data-bs-dismiss","modal"),a.title.lastElementChild.setAttribute("aria-label","Close"),a.frame.lastElementChild.lastElementChild.appendChild(a.body),a.body.className="modal-body",a.body.appendChild(a.files),a.files.appendChild(document.createElement("h4")),a.files.lastElementChild.innerText="Data Files",a.files.appendChild(document.createElement("ul")),a.body.appendChild(a.dashboards),a.dashboards.appendChild(document.createElement("h4")),a.dashboards.lastElementChild.innerText="Dashboards",a.dashboards.appendChild(document.createElement("ul")),a.body.appendChild(a.measure_info),a.measure_info.appendChild(document.createElement("h4")),a.measure_info.lastElementChild.innerText="Measure Info",a.measure_info.appendChild(document.createElement("ul")),a.measure_info.appendChild(document.createElement("table")),(()=>{let e=document.createElement("div");this.page.tabs.search.appendChild(e),e.className="search-wrapper",e.appendChild(e=document.createElement("div")),e.className="search-field",e.appendChild(document.createElement("label")),e.lastElementChild.setAttribute("for","searchInput"),e.lastElementChild.className="form-label",e.lastElementChild.innerText="Search Variables",e.appendChild(document.createElement("input")),e.lastElementChild.type="text",e.lastElementChild.id="searchInput",e.lastElementChild.className="form-control",e.lastElementChild.addEventListener("keyup",this.search.bind(this)),this.page.tabs.search.firstElementChild.appendChild(e=document.createElement("div")),e.className="search-results"})(),this.requester.onmessage=e=>{const t=e.data;if(t.response){E.test(t.response)||(t.response=JSON.stringify({message:t.response}));const e=JSON.parse(t.response);var i=200!==t.status?t.status:e.status?e.status:e.message?"ERROR":"OK";if("provider"===t.type){this.repos[t.repo].providers[t.provider+t.dir]=JSON.parse(t.response);const e=this.repos[t.repo],r=e.providers[t.provider+t.dir],h=[],c=e.distributions[t.provider].display;var a,s,l=0,n=0,d=!1;if(c.lastElementChild.lastElementChild.className="","OK"===i){if(c.classList.add("passed-check"),c.classList.remove("failed-check"),"github"===t.provider)for(n=r.length;l<n;l++)Object.hasOwn(this.file_ids,r[l].path)&&(d=!0,s=this.file_ids[r[l].path],this.files[s].remote.github=r[l],Object.hasOwn(e.all_files,this.files[s].local.github.md5)||h.push(r[l].path));else if("dataverse"===t.provider)for(a=r.data.latestVersion.files,n=a.length;l<n;l++)Object.hasOwn(this.file_ids,a[l].dataFile.filename)&&(d=!0,s=this.file_ids[a[l].dataFile.filename],this.files[s].remote.dataverse=a[l].dataFile,Object.hasOwn(e.all_files,this.files[s].local.dataverse.md5)||h.push(a[l].dataFile.filename));d?h.length&&(i="WARN",r.message=(1===h.length?"A file was":"Files were")+" not associated with the distribution on record: "+h):(i="WARN",r.message=n?"None of the distribution files match those from the local record.":"The distribution had no files.")}"OK"!==i&&(c.classList.remove("passed-check"),c.classList.add("failed-check"),c.lastElementChild.setAttribute("aria-description",r.message)),c.lastElementChild.lastElementChild.innerText=i,this.display_repo(t.repo)}else if("view"===t.type){const a=this.named_view[t.view];var r,h;if(a.checks.github.lastElementChild.innerText=i,"OK"===i)for(r in e)if(Object.hasOwn(e,r)){if(!Object.hasOwn(this.repos,r)){e.message="A listed repository is not a part of this data commons: "+r+".",i="FAIL";break}for(l=e[r].files.length;l--;)if(h=e[r].files[l],!Object.hasOwn(this.file_ids,h.md5)){e.message="One of the files in "+r+" was not found in the data commons: "+h.md5,i="FAIL";break}}"OK"===i?(a.manifest=e,a.checks.github.classList.add("passed-check")):(a.checks.github.lastElementChild.setAttribute("aria-description",e.message),a.checks.github.classList.remove("passed-check"),a.checks.github.classList.add("failed-check"))}else"datapackage"===t.type&&(Object.hasOwn(t,"index")?(this.named_view[t.view].view.children[t.index].datapackage=e,this.check_child(this.named_view[t.view],t.index)):(this.named_view[t.view].datapackage=e,this.check_view(this.named_view[t.view])))}},this.page.menu.check_all&&this.page.menu.check_all.addEventListener("click",(()=>{var e,t;for(e in this.repos)if(Object.hasOwn(this.repos,e))for(t in this.repos[e].distributions)Object.hasOwn(this.repos[e].distributions,t)&&this.request_provider(e,t)}));var s,l,n,d,r,h,c,o,m,p=0,u=/^.*(?:\d{4}(?:q\d)?_)|\..*$/g,E=/^[[{]/;for(s in this.page.current_tab=window.location.hash||this.page.current_tab,(c=document.createElement("div")).className="toast",c.role="alert",c.setAttribute("aria-live","assertive"),c.setAttribute("aria-atomic","true"),c.appendChild(document.createElement("div")),c.lastElementChild.className="toast-header",c.lastElementChild.appendChild(document.createElement("strong")),c.lastElementChild.lastElementChild.className="me-auto",c.lastElementChild.appendChild(document.createElement("button")),c.lastElementChild.lastElementChild.type="button",c.lastElementChild.lastElementChild.className="btn-close",c.lastElementChild.lastElementChild.setAttribute("data-bs-dismiss","toast"),c.lastElementChild.lastElementChild.setAttribute("aria-label","close"),c.appendChild(document.createElement("div")),c.lastElementChild.className="toast-body",this.page.toast=new bootstrap.Toast(c),this.page.body.insertAdjacentElement("afterEnd",c),(c=this.page.tooltip).className="hover-note hidden",c.appendChild(document.createElement("p")),this.page.body.insertAdjacentElement("afterEnd",c),this.page.body.parentElement.addEventListener("mouseover",(e=>{const t=e.target.getAttribute("aria-description"),i=t||e.target.parentElement.getAttribute("aria-description");if(i){this.page.tooltip.firstElementChild.innerText=i,this.page.tooltip.classList.remove("hidden");const a=(t?e.target:e.target.parentElement).getBoundingClientRect(),s=this.page.tooltip.getBoundingClientRect();this.page.tooltip.style.top=a.bottom+10+"px",this.page.tooltip.style.left=Math.max(0,a.left+a.width/2-s.width/2)+"px"}else this.page.tooltip.classList.add("hidden")})),this.page.tabs)Object.hasOwn(this.page.tabs,s)&&(this.page.menu[s]=c=document.createElement("button"),c.addEventListener("click",this.show_tab.bind(this)),this.page.menu.check_all.insertAdjacentElement("beforeBegin",c),c.innerText=s,c.className="btn",c.type="button",h=s+"_tab",c.id=h+"_button",c.setAttribute("aria-controls",h),this.page.container.appendChild(c=this.page.tabs[s]),c.className="hidden",c.role="tabpanel",c.id=h,c.setAttribute("aria-labelledby",h+"_button"),this.page.current_tab==="#"+s&&this.show_tab({target:this.page.menu[s]}));for(s in t.repos)if(Object.hasOwn(t.repos,s)){for(n in this.counts.repos++,(l=this.repos[s]=t.repos[s]).checks={},l.providers={},l.file_ids=[],l.ufiles={},l.all_files=t.files[s],l.variables={},l.all_files)if(Object.hasOwn(l.all_files,n)){if(d=(r=l.all_files[n]).name,"string"==typeof r.providers&&(r.providers=[r.providers]),o="",Object.hasOwn(this.file_ids,n)?o=this.file_ids[n]:Object.hasOwn(this.file_ids,d)&&(o=this.file_ids[d]),o||(o="f"+p++,this.file_ids[n]=this.file_ids[d]=o),r.uid=o,!Object.hasOwn(this.files,o)){if(this.counts.files++,this.files[o]={content:r,local:{},remote:{},display:document.createElement("div")},r.prefix=r.name.replace(u,""),r.variables)for("string"==typeof r.variables&&(r.variables=[r.variables]),m=r.variables.length;m--;){if(!((h=r.variables[m])in l.variables)){this.counts.variables++;const e=document.createElement("div");l.variables[h]={string:h.toLowerCase(),display:e,files:[],repos:[],info:{},info_files:[]},this.variables.set(h,l.variables[h]),e.className="variable",e.appendChild(document.createElement("button")),e.lastElementChild.type="button",e.lastElementChild.innerText=h,e.lastElementChild.className="btn",e.lastElementChild.setAttribute("data-bs-toggle","modal"),e.lastElementChild.setAttribute("data-bs-target","#general_modal"),e.lastElementChild.addEventListener("click",function(e,t){const i=t.info;this.page.modal.title.firstElementChild.innerText=i.short_name||i.long_name,this.page.modal.files.lastElementChild.innerHTML="",t.files.forEach((e=>{const i=document.createElement("li");i.appendChild(document.createElement("a")),i.lastElementChild.target="_blank",i.lastElementChild.rel="noreferrer",i.lastElementChild.innerText=t.repos[0]+": "+e.content.name,i.lastElementChild.href=this.repos[t.repos[0]].base_url+"/"+e.content.name,this.page.modal.files.lastElementChild.appendChild(i)})),this.page.modal.dashboards.lastElementChild.innerHTML="",this.views.forEach((e=>{if(t.name in e.variables){const i=document.createElement("li");i.appendChild(document.createElement("a")),i.lastElementChild.target="_blank",i.lastElementChild.rel="noreferrer",i.lastElementChild.href=e.view.url+"?selected_variable="+t.name,i.lastElementChild.innerText=e.name,this.page.modal.dashboards.lastElementChild.appendChild(i)}})),this.page.modal.measure_info.children[1].innerHTML="",t.info_files.forEach((e=>{e=e.replace(/^[^\/]+\//,"");const i=document.createElement("li");i.appendChild(document.createElement("a")),i.lastElementChild.target="_blank",i.lastElementChild.rel="noreferrer",i.lastElementChild.innerText=t.repos[0]+": "+e,i.lastElementChild.href=this.repos[t.repos[0]].base_url+"/"+e,this.page.modal.measure_info.children[1].appendChild(i)})),this.page.modal.measure_info.lastElementChild.innerHTML="",this.page.modal.measure_info.appendChild(this.display_object({measure:t.name,...i},this.page.modal.measure_info.lastElementChild))}.bind(this,null,l.variables[h])),e.appendChild(document.createElement("p")),e.lastElementChild.className="variable-name",e.appendChild(document.createElement("p"))}const e=l.variables[h];e.files.push(this.files[o]),-1===e.repos.indexOf(s)&&e.repos.push(s)}r.ids&&("string"==typeof r.ids&&(r.ids=[r.ids]),r.ids.forEach((e=>{if(!(e in this.ids)){this.counts.ids++;const t=document.createElement("div");this.ids[e]={display:t,files:[]},t.className="id",t.appendChild(document.createElement("p")),t.lastElementChild.innerText=e,t.lastElementChild.className="h5"}this.ids[e].files.push(this.files[o])})))}for(h in Object.hasOwn(l.ufiles,o)||(l.file_ids.push(o),l.ufiles[o]=this.files[o]),Object.hasOwn(l.files,d)&&(l.files[d].uid=o,l.files[d].parent=l,l.url="https://github.com/"+s,this.files[o].local.github=l.files[d]),l.distributions)Object.hasOwn(l.distributions,h)&&(Object.hasOwn(this.dists,h)||(this.dists[h]={}),Object.hasOwn(this.dists[h],l.distributions[h].doi)||(this.dists[h][l.distributions[h].doi]={}),this.dists[h][l.distributions[h].doi][s]=l,l.distributions[h].files&&Object.hasOwn(l.distributions[h].files,d)&&(l.distributions[h].files[d].uid=o,l.distributions[h].files[d].parent=l.distributions[h],this.files[o].local[h]=l.distributions[h].files[d]))}this.page.tabs.repos.appendChild(this.display_repo(s))}for(Object.keys(t.variables).forEach((e=>{const i=t.variables[e];Object.keys(i).forEach((t=>{if(this.variables.has(t)){const a=this.variables.get(t);a.info_files.push(e),a.name=t,a.info=i[t],a.display.children[0].innerText=a.info.short_name||a.info.long_name||t,a.display.children[1].innerText=t,a.display.children[2].innerText=a.info.short_description||a.info.long_description||"",a.string+=" "+JSON.stringify(a.info).toLowerCase()}}))})),this.counts.views=i.length,m=i.length;m--;)this.named_view[i[m].name]=i[m],i[m].parent=this,i[m].checks={},this.page.tabs.views.appendChild(this.display_view(i[m])),Object.hasOwn(i[m].view,"remote")&&this.requester.postMessage({type:"datapackage",view:i[m].name,url:"https://raw.githubusercontent.com/"+i[m].view.remote+"/main/docs/data/datapackage.json"})}DataCommons.prototype={constructor:DataCommons,requester:new Worker("request.js"),rates:{github:{resources:{core:{remaining:0,reset:-1/0}}}},queues:{distributions:[]},format:{date:Intl.DateTimeFormat("en-us",{month:"2-digit",day:"2-digit",year:"2-digit"}).format,time:Intl.DateTimeFormat("en-us",{hour:"numeric",minute:"numeric"}).format,size:function(e){return e<1e6?e/1e3+" KB":e<1e9?e/1e6+" MB":e/1e9+" GB"}},checks:{has_files:{name:"Files",domain:"repo",description:"Number of latent files between the repository and distributions.",check:function(e){return e.file_ids.length}},has_dist:{name:"Dist",domain:"repo",description:"Has an associated distribution repository.",check:function(e){return Object.keys(e.distributions).length>1}},aligned:{name:"Aligned",domain:"repo",description:"All latent file instances are aligned.",check:function(e){var t,i,a,s,l,n,d,r=!0;for(n in e.ufiles)if(Object.hasOwn(e.ufiles,n))for(i in t=e.ufiles[n],a=Object.hasOwn(t.local,"github")?"github":"dataverse",t.local)Object.hasOwn(t.local,i)&&(s="github"===i?"sha":"md5",d=!0,"remote"===(l=Object.hasOwn(t.remote,i)?"remote":"local")&&(d=t.local[i][s]===t.remote[i][s]),(d=d&&t.local[a].md5===t.local[i].md5)||(r=!1),t.local[i].display.classList[d&&"local"===l?"add":"remove"]("pending-check"),t.local[i].display.classList[d?"remove":"add"]("failed-check"),t.local[i].display.lastElementChild.setAttribute("aria-description","Source: "+l),t.local[i].display.lastElementChild.innerText=t[l][i][s]);return r}.bind(this)},missed_variables:{name:"All Variables",domain:"view",description:"All of the requested variables were found in a dataset.",check:function(e){e.missed_variables=[];for(var t,i=!0,a=e.view.variables.length;a--;)t=e.view.variables[a],e.parent.variables.has(t)?(e.variables[t].firstElementChild.innerText=e.parent.variables.get(t).files.length,e.variables[t].firstElementChild.classList.add("passed-check")):(e.variables[t].firstElementChild.classList.remove("passed-check"),e.variables[t].firstElementChild.innerText=0,e.missed_variables.push(t),i=!1);return i}},missed_ids:{name:"All IDs",domain:"view",description:"All of the requested IDs were found in a dataset.",check:function(e){e.missed_ids=[];for(var t,i=!0,a=e.view.ids.length;a--;)t=e.view.ids[a],Object.hasOwn(e.parent.ids,t)?(e.ids[t].firstElementChild.innerText=e.parent.ids[t].files.length,e.ids[t].classList.add("hidden")):(e.ids[t].firstElementChild.innerText=0,e.ids[t].classList.remove("hidden"),e.missed_ids.push(t),i=!1);return i}},datapackage:{name:"datapackage",domain:"view",description:"Retrieved the associated datapackage.json file.",check:function(e){return Object.hasOwn(e,"datapackage")}},updated:{name:"Up-To-Date",domain:"child",description:"The child site's datapackage points to the same files as the parent's.",check:function(e,t){if(Object.hasOwn(e,"datapackage")){var i=!1,a=e.datapackage.resources.length;if(Object.hasOwn(e.view.children[t],"datapackage")&&a===e.view.children[t].datapackage.resources.length)for(;a--&&(i=e.datapackage.resources[a].md5===e.view.children[t].datapackage.resources[a].md5););return i}return!0}}},show_tab:function(e){if(!e.target.classList.contains("active")&&Object.hasOwn(this.page.tabs,e.target.innerText)){const i=e.target.parentElement.getElementsByClassName("active");for(var t=i.length;t--;)this.page.tabs[i[t].innerText].classList.add("hidden"),i[t].classList.remove("disabled"),i[t].classList.remove("active");this.page.tabs[e.target.innerText].classList.remove("hidden"),e.target.classList.add("disabled"),e.target.classList.add("active"),this.page.current_tab=e.target.innerText,window.history.replaceState(Date.now(),"","#"+this.page.current_tab)}},check_repo:function(e){for(var t in this.checks)if(Object.hasOwn(this.checks,t)&&"repo"===this.checks[t].domain){const i=this.checks[t].check(e);e.checks[t].lastElementChild.innerText=i,e.checks[t].classList[i?"remove":"add"]("failed-check")}},check_view:function(e){var t,i;for(t in this.checks)if(Object.hasOwn(this.checks,t)&&"view"===this.checks[t].domain){const i=this.checks[t].check(e);e.checks[t].lastElementChild.innerText=i,e.checks[t].classList[i?"remove":"add"]("failed-check"),"missed_ids"!==t&&"missed_variables"!==t||this.page.views[e.name].lastElementChild.children["missed_ids"===t?2:1].classList[i?"add":"remove"]("hidden")}if(Object.hasOwn(e.view,"children"))for(i=e.view.children.length;i--;)this.check_child(e,i)},check_child:function(e,t){for(var i in this.checks)if(Object.hasOwn(this.checks,i)&&"child"===this.checks[i].domain){const a=this.checks[i].check(e,t);e.view.children[t].parts[i].lastElementChild.innerText=a,e.view.children[t].parts[i].classList[a?"remove":"add"]("failed-check")}},display_object:function(e,t){return t||(t=document.createElement("table")),Object.keys(e).forEach((i=>{const a=document.createElement("tr"),s=document.createElement("th"),l=document.createElement("td");a.appendChild(s),a.appendChild(l),s.innerText=i,Array.isArray(e[i])?"string"==typeof e[i][0]?l.innerText=e[i].join(", "):e[i].forEach((e=>{l.appendChild(this.display_object(e))})):"object"==typeof e[i]?l.appendChild(this.display_object(e[i])):l.innerText=e[i],t.appendChild(a)})),t},display_repo:function(e){const t=this.repos[e],i=Object.hasOwn(this.page.repos,e),a=i?this.page.repos[e]:document.createElement("div");if(Object.hasOwn(this.repos,e)){var s,l,n,d;if(!i){for(s in this.page.repos[e]=a,a.className="repo_container card",a.appendChild(l=document.createElement("div")),l.className="repo_header card-header",d=e.split("/"),l.appendChild(document.createElement("span")),l.lastElementChild.innerText=d[0]+"/",l.appendChild(document.createElement("span")),l.lastElementChild.innerText=d[1],l.appendChild(l=document.createElement("span")),l.className="repo_links card-links",Object.hasOwn(t,"distributions")||(t.distributions={}),t.distributions.github={url:t.url},t.distributions)Object.hasOwn(t.distributions,s)&&(t.distributions[s].display=document.createElement("div"),l.appendChild(t.distributions[s].display),l.lastElementChild.className="status-chip",l.lastElementChild.appendChild(n=document.createElement("a")),n.target="_blank",n.rel="noreferrer",n.innerText=s,n.href=this.get_provider_link(s,e),l.lastElementChild.appendChild(n=document.createElement("button")),n.className="btn",n.appendChild(document.createElement("span")),n.lastElementChild.innerText="check",n.addEventListener("click",this.request_provider.bind(this,e,s)));for(s in a.appendChild(document.createElement("div")),a.lastElementChild.className="repo_body card-body",a.lastElementChild.appendChild(l=document.createElement("div")),l.className="repo_status card-status",this.checks)Object.hasOwn(this.checks,s)&&"repo"===this.checks[s].domain&&(l.appendChild(t.checks[s]=document.createElement("div")),l.lastElementChild.className="status-chip",l.lastElementChild.setAttribute("aria-description",this.checks[s].description),l.lastElementChild.appendChild(document.createElement("span")),l.lastElementChild.firstElementChild.innerText=this.checks[s].name,l.lastElementChild.appendChild(document.createElement("span")));for(s in a.lastElementChild.appendChild(l=document.createElement("div")),l.className="repo_files card-section accordion",l.id="file-list-container-"+e,l.setAttribute("data-bs-theme","dark"),l.appendChild(l=document.createElement("div")),l.className="accordion-item",l.appendChild(l=document.createElement("h2")),l.className="accordion-header",l.appendChild(document.createElement("button")),l.lastElementChild.innerText="Data Files",l.lastElementChild.className="accordion-button collapsed",l.lastElementChild.type="button",l.lastElementChild.setAttribute("data-bs-toggle","collapse"),l.lastElementChild.setAttribute("data-bs-target","#file-list-"+e),l.lastElementChild.setAttribute("aria-expanded","false"),l.lastElementChild.setAttribute("aria-controls","file-list-"+e),l.insertAdjacentElement("afterend",l=document.createElement("div")),l.id="file-list-"+e,l.className="accordion-collapse collapse",l.setAttribute("data-bs-parent","#file-list-container-"+e),l.appendChild(l=document.createElement("div")),t.all_files)Object.hasOwn(t.all_files,s)&&l.appendChild(this.display_file(s))}this.check_repo(t)}return a},display_file:function(e){if(Object.hasOwn(this.file_ids,e)){const a=this.file_ids[e],s=this.files[a],l=s.display;var t,i;if(!l.childElementCount)for(t in l.className="entry",l.appendChild(document.createElement("p")),l.lastElementChild.innerText=s.content.name,l.lastElementChild.className="entry-name",l.appendChild(document.createElement("p")),l.lastElementChild.className="entry-info",l.lastElementChild.appendChild(document.createElement("span")),l.lastElementChild.lastElementChild.className="entry-info-entry",l.lastElementChild.lastElementChild.innerText="git sha: ",l.lastElementChild.appendChild(document.createElement("span")),l.lastElementChild.appendChild(document.createElement("span")),l.lastElementChild.lastElementChild.className="entry-info-entry",l.lastElementChild.lastElementChild.innerText="md5: ",l.lastElementChild.appendChild(document.createElement("span")),t=Object.hasOwn(s.local,"github")?"github":"dataverse",Object.hasOwn(s.local,t)?(l.lastElementChild.children[1].innerText=s.local[t].sha||"none",l.lastElementChild.children[3].innerText=s.local[t].md5):l.lastElementChild.classList.add("hidden"),l.appendChild(document.createElement("div")),l.lastElementChild.className="entry-checks",s.local)Object.hasOwn(s.local,t)&&(s.local[t].display=document.createElement("div"),l.lastElementChild.appendChild(s.local[t].display),s.local[t].display.className="status-chip",s.local[t].display.appendChild(i=document.createElement("a")),i.target="_blank",i.rel="noreferrer",i.href=this.make_file_link(a,t),i.innerText=t,i.className=t+"-file",s.local[t].display.appendChild(document.createElement("span")));return l}return document.createElement("div")},display_view:function(e){const t=Object.hasOwn(this.page.views,e.name),i=t?this.page.views[e.name]:document.createElement("div");var a,s,l,n,d;if(!t){for(a in e.variables={},e.ids={},this.page.views[e.name]=i,i.className="view_container card",i.appendChild(s=document.createElement("div")),s.className="view_header card-header",s.appendChild(document.createElement("span")),e.view.url?(s.lastElementChild.appendChild(l=document.createElement("a")),l.target="_blank",l.rel="noreferrer",l.href=e.view.url,l.innerText=e.name):s.lastElementChild.innerText=e.name,s.appendChild(s=document.createElement("span")),s.className="view_links card-links",e.view.remote&&(s.appendChild(document.createElement("div")),s.lastElementChild.className="status-chip",e.checks.github=s.lastElementChild,s.lastElementChild.appendChild(l=document.createElement("a")),l.target="_blank",l.rel="noreferrer",l.href="https://github.com/"+e.view.remote,l.innerText="github",s.lastElementChild.appendChild(l=document.createElement("button")),l.className="btn",l.appendChild(document.createElement("span")),l.lastElementChild.innerText="check",l.addEventListener("click",this.request_manifest.bind(this,e,"https://raw.githubusercontent.com/"+e.view.remote+"/main/docs/data/manifest.json"))),i.appendChild(document.createElement("div")),i.lastElementChild.className="view_body card-body",i.lastElementChild.appendChild(s=document.createElement("div")),s.className="view_status card-status",this.checks)Object.hasOwn(this.checks,a)&&"view"===this.checks[a].domain&&(s.appendChild(e.checks[a]=document.createElement("div")),s.lastElementChild.className="status-chip",s.lastElementChild.setAttribute("aria-description",this.checks[a].description),s.lastElementChild.appendChild(document.createElement("span")),s.lastElementChild.firstElementChild.innerText=this.checks[a].name,s.lastElementChild.appendChild(document.createElement("span")));for(i.lastElementChild.appendChild(l=document.createElement("div")),l.className="card-section",l.appendChild(document.createElement("p")),l.lastElementChild.innerText="Variables",l.lastElementChild.className="card-section-header",l.appendChild(document.createElement("table")),l.lastElementChild.appendChild(document.createElement("thead")),l.lastElementChild.lastElementChild.appendChild(document.createElement("tr")),l.lastElementChild.lastElementChild.lastElementChild.appendChild(document.createElement("th")),l.lastElementChild.lastElementChild.lastElementChild.lastElementChild.innerText="Files",l.lastElementChild.lastElementChild.lastElementChild.appendChild(document.createElement("th")),l.lastElementChild.lastElementChild.lastElementChild.lastElementChild.innerText="Name",l.lastElementChild.appendChild(l=document.createElement("tbody")),d=0,n=e.view.variables.length;n--;)l.appendChild(e.variables[e.view.variables[n]]=document.createElement("tr")),l.lastElementChild.appendChild(document.createElement("td")),l.lastElementChild.lastElementChild.innerText=0,l.lastElementChild.appendChild(document.createElement("td")),l.lastElementChild.lastElementChild.innerText=e.view.variables[n],e.view.variables[n].length>d&&(d=e.view.variables[n].length);for(i.lastElementChild.appendChild(l=document.createElement("div")),l.className="card-section",l.appendChild(document.createElement("p")),l.lastElementChild.innerText="Missing IDs",l.lastElementChild.className="card-section-header",l.appendChild(document.createElement("table")),l.lastElementChild.appendChild(document.createElement("thead")),l.lastElementChild.lastElementChild.appendChild(document.createElement("tr")),l.lastElementChild.lastElementChild.lastElementChild.appendChild(document.createElement("th")),l.lastElementChild.lastElementChild.lastElementChild.lastElementChild.innerText="Files",l.lastElementChild.lastElementChild.lastElementChild.appendChild(document.createElement("th")),l.lastElementChild.lastElementChild.lastElementChild.lastElementChild.innerText="ID",l.lastElementChild.appendChild(l=document.createElement("tbody")),d=0,n=e.view.ids.length;n--;)l.appendChild(e.ids[e.view.ids[n]]=document.createElement("tr")),l.lastElementChild.classList.add("hidden"),l.lastElementChild.appendChild(document.createElement("td")),l.lastElementChild.lastElementChild.innerText=0,l.lastElementChild.appendChild(document.createElement("td")),l.lastElementChild.lastElementChild.innerText=e.view.ids[n],e.view.ids[n].length>d&&(d=e.view.ids[n].length);if(e.view.children.length)for(e.checks.children=[],i.lastElementChild.appendChild(s=document.createElement("div")),s.className="card-section",s.appendChild(document.createElement("p")),s.lastElementChild.innerText="Children",s.lastElementChild.className="card-section-header",n=e.view.children.length;n--;){for(a in(l=document.createElement("div")).className="status-chip",l.appendChild(document.createElement("span")),l.firstElementChild.innerText="github",l.appendChild(document.createElement("a")),l.lastElementChild.target="_blank",l.lastElementChild.rel="noreferrer",l.lastElementChild.innerText=e.view.children[n].remote,l.lastElementChild.href="https://github.com/"+e.view.children[n].remote,e.view.children[n].parts={repo:l},this.checks)Object.hasOwn(this.checks,a)&&"child"===this.checks[a].domain&&(e.view.children[n].parts[a]=l=document.createElement("div"),l.className="status-chip",l.appendChild(document.createElement("span")),l.firstElementChild.innerText=this.checks[a].name,l.appendChild(document.createElement("span")));for(a in s.appendChild(document.createElement("div")),s.lastElementChild.className="entry",s.lastElementChild.appendChild(document.createElement("p")),s.lastElementChild.lastElementChild.appendChild(l=document.createElement("a")),l.parentElement.className="entry-name",l.target="_blank",l.rel="noreferrer",l.innerText=e.view.children[n].name,l.href=e.view.children[n].url,s.lastElementChild.appendChild(l=document.createElement("div")),l.className="entry-checks",e.view.children[n].parts)Object.hasOwn(e.view.children[n].parts,a)&&l.appendChild(e.view.children[n].parts[a]);this.requester.postMessage({type:"datapackage",view:e.name,index:n,url:"https://raw.githubusercontent.com/"+e.view.children[n].remote+"/main/docs/data/datapackage.json"})}}return this.check_view(e),i},make_file_link:function(e,t){const i=this.files[e];if(i){if("github"===t&&Object.hasOwn(i.local,"github"))return i.local.github.parent.url+"/blob/"+(i.local.github.parent.providers.github&&i.local.github.parent.providers.github.default_branch||"main")+"/"+i.content.name;const e=i.local[t];if("dataverse"===t&&Object.hasOwn(i.local,"dataverse"))return e.parent.server+"file.xhtml?fileId="+e.id}},get_provider_link:function(e,t,i){if("github"===e)return i?"https://api.github.com/repos/"+t+"/contents/":"https://github.com/"+t;const a=this.repos[t].distributions[e];return"dataverse"===e?a.server+(i?"api/datasets/:persistentId":"dataset.xhtml")+"?persistentId=doi:"+a.doi:void 0},request_manifest:function(e,t){this.requester.postMessage({type:"view",view:e.name,url:t})},request_provider:function(e,t){const i=this.get_provider_link(t,e,!0);if(i){const a=/\/[^\/]+$/,s=[],l=this.repos[e].files;Object.keys(l).forEach((e=>{l[e].display&&l[e].display.classList.add("failed-check");const t=e.replace(a,"");-1===s.indexOf(t)&&s.push(t)})),s.forEach((a=>{this.queues.distributions.push({type:"provider",repo:e,provider:t,dir:a,url:i+"/"+a})})),this.prompt_dist_requester()}},prompt_dist_requester:async function(){for(var e,t=this.queues.distributions.length;t--;){if("github"===(e=this.queues.distributions[t]).provider){if(!(this.rates.github.resources.core.remaining>0)){if(Date.now()>this.rates.github.resources.core.reset){if(!this.rates.github.resources.core.queued){const e=new XMLHttpRequest;e.onreadystatechange=()=>{if(4===e.readyState){if(200!==e.status)throw new TypeError("failed to retrieve github rate limit; "+e.responseText);this.rates.github=JSON.parse(e.responseText),this.rates.github.resources.core.reset=Date.now()+this.rates.github.resources.core.reset/1e3,this.prompt_dist_requester()}},e.open("GET","https://api.github.com/rate_limit",!0),e.send(),this.rates.github.resources.core.queued=!0}}else this.page.toast._element.firstElementChild.firstElementChild.innerText="GitHub Rate Limit",this.page.toast._element.lastElementChild.innerText="This IP has reached GitHub's API rate limit; this will reset at "+this.format.time(new Date(this.rates.github.resources.core.reset))+" (in "+Math.round((this.rates.github.resources.core.reset-Date.now())/6e4)+" minutes).",this.page.toast.show(),this.requester.onmessage({data:{response:JSON.stringify({status:"WARN",message:this.page.toast._element.lastElementChild.innerText}),repo:e.repo,provider:e.provider}}),this.queues.distributions.splice(t,1);continue}this.rates.github.resources.core.remaining--}this.requester.postMessage(this.queues.distributions.splice(t,1)[0])}},search:function(e){const t=this.page.tabs.search.firstElementChild.lastElementChild,i=(e.target?e.target.value:e).toLowerCase();if(t.innerHTML="",i.length>1){const e=document.createElement("div");this.variables.forEach(((t,a)=>{t.string.includes(i)&&e.appendChild(t.display)})),t.appendChild(e)}}},"undefined"!=typeof module&&(module.export=DataCommons);