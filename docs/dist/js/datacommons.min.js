"use strict";function DataCommons(e,t,i){Object.hasOwn||Object.defineProperty(Object,"hasOwn",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(e),t)},configurable:!0,enumerable:!1,writable:!0}),this.definition=e,this.manifest=t,this.views=i,this.named_view={},this.counts={views:0,repos:0,files:0,variables:0,ids:0},this.variables=new Map,this.ids={},this.repos={},this.providers={},this.dists={},this.file_ids={},this.files={},this.info_files={},this.issue_descriptions={info_malformed:"File is not in the expected format.",info_incomplete:"Entries are missing required fields.",info_invalid:"File could not be parsed.",info_refs_names:"References are not named.",info_refs_missing:"A reference entry is missing a required field.",info_refs_author_entry:"An author entry is missing a family field.",info_source_missing:"A source entry is missing a required field.",info_citation:"A measure refers to a citation that is not found in references.",info_layer_source:"A layer entry is missing a source field.",info_layer_source_url:"A layer source entry is missing a URL.",info_layer_filter:"A layer's filter entry is missing a required field.",warn_compressed:"File is not compressed.",warn_blank_colnames:"File contains blank column names.",warn_value_nas:"The value column contains NAs.",warn_id_nas:"The id column contains NAs.",warn_time_nas:"The time column contains NAs.",warn_value_name_nas:"The value names column contains NAs.",warn_dataset_nas:"The dataset column contains NAs.",warn_entity_info_nas:"An entity info column contains NAs.",warn_scientific:"IDs may have been converted to scientific notation.",warn_double_ints:"A value marked as an integer is actually a double.",warn_small_percent:"A value is marked as a percent, but has a maximum under 1.",warn_small_value:"A value has 40% of its entries under under .00001",warn_bg_agg:"The file contains apparent block group GEOIDs, but no higher-order aggregates for the given variables.",warn_tr_agg:"The file contains apparent tract GEOIDs, but no higher-order aggregates for the given variables.",warn_missing_info:"Value names in the file were not also found in an associated measure info file.",fail_read:"File could not be read in.",fail_rows:"File contained no rows.",fail_time:"File had no time column",fail_idlen_county:'IDs marked as of a "county" dataset were not all 5 characters long.',fail_idlen_tract:'IDs marked as of a "county" dataset were not all 11 characters long.',fail_idlen_block_group:'IDs marked as of a "county" dataset were not all 12 characters long.'},this.patterns={file_prefix:/^.*(?:\d{4}(?:q\d)?_)|\..*$/g,json_start:/^[[{]/,dirname:/\/[^\/]+$/,repo_name:/^[^\/]+\/[^/]+\//,pre_underscore:/^[^_]+_/,info:/^info_/,warn:/^warn_/,fail:/^fail_/,trailing_slash:/\/$/},this.page={current_tab:"#variables",menu:{},body:document.getElementsByClassName("content")[0],container:document.createElement("div"),tooltip:document.createElement("div"),tabs:{variables:document.createElement("div"),repos:document.createElement("div"),views:document.createElement("div")},modal:{frame:document.createElement("div"),title:document.createElement("div"),body:document.createElement("div"),files:document.createElement("div"),dashboards:document.createElement("div"),measure_info:document.createElement("div")},views:{},repos:{},files:{},order:[]},this.page.body.appendChild(this.page.container),this.page.container.className="commons",this.page.container.appendChild(this.page.tabs.views),this.page.container.appendChild(this.page.tabs.repos),this.page.container.appendChild(this.page.tabs.variables);const s=this.page.modal;document.body.appendChild(s.frame),s.frame.className="modal fade",s.frame.id="general_modal",s.frame.tabIndex=-1,s.frame.setAttribute("data-bs-theme","dark"),s.frame.setAttribute("aria-labelledby","general_modal_label"),s.frame.setAttribute("aria-hidden","true"),s.frame.appendChild(document.createElement("div")),s.frame.lastElementChild.className="modal-dialog",s.frame.lastElementChild.appendChild(document.createElement("div")),s.frame.lastElementChild.lastElementChild.className="modal-content",s.frame.lastElementChild.lastElementChild.appendChild(s.title),s.title.className="modal-header",s.title.appendChild(document.createElement("h3")),s.title.firstElementChild.className="modal-title",s.title.firstElementChild.id="general_modal_label",s.title.appendChild(document.createElement("button")),s.title.lastElementChild.type="button",s.title.lastElementChild.className="btn-close",s.title.lastElementChild.setAttribute("data-bs-dismiss","modal"),s.title.lastElementChild.setAttribute("aria-label","Close"),s.frame.lastElementChild.lastElementChild.appendChild(s.body),s.body.className="modal-body",s.body.appendChild(s.files),s.files.appendChild(document.createElement("h4")),s.files.lastElementChild.innerText="Data Files",s.files.appendChild(document.createElement("ul")),s.body.appendChild(s.dashboards),s.dashboards.appendChild(document.createElement("h4")),s.dashboards.lastElementChild.innerText="Dashboards",s.dashboards.appendChild(document.createElement("ul")),s.body.appendChild(s.measure_info),s.measure_info.appendChild(document.createElement("h4")),s.measure_info.lastElementChild.innerText="Measure Info",s.measure_info.appendChild(document.createElement("ul")),s.measure_info.appendChild(document.createElement("table")),(()=>{let e=document.createElement("div");this.page.tabs.variables.appendChild(e),e.className="search-wrapper",e.appendChild(e=document.createElement("div")),e.className="search-field",e.appendChild(document.createElement("label")),e.lastElementChild.setAttribute("for","searchInput"),e.lastElementChild.className="form-label",e.lastElementChild.innerText="Search Variables",e.appendChild(document.createElement("input")),e.lastElementChild.type="text",e.lastElementChild.id="searchInput",e.lastElementChild.className="form-control",e.lastElementChild.addEventListener("keyup",this.search.bind(this)),setTimeout(this.search.bind(this,{target:e.lastElementChild}),0),this.page.tabs.variables.firstElementChild.appendChild(e=document.createElement("div")),e.className="search-results"})(),this.requester.onmessage=e=>{const t=e.data;if(t.response){this.patterns.json_start.test(t.response)||(t.response=JSON.stringify({message:t.response}));const e=JSON.parse(t.response);var i=200!==t.status?t.status:e.status?e.status:e.message?"ERROR":"OK";if("provider"===t.type){this.repos[t.repo].providers[t.provider+t.dir]=JSON.parse(t.response);const e=this.repos[t.repo],r=e.providers[t.provider+t.dir],c=[],h=e.distributions[t.provider].display;var s,a,n=0,l=0,d=!1;if(h.lastElementChild.lastElementChild.className="","OK"===i){if(h.classList.add("passed-check"),h.classList.remove("failed-check"),"github"===t.provider)for(l=r.length;n<l;n++)Object.hasOwn(this.file_ids,r[n].path)&&(d=!0,a=this.file_ids[r[n].path],this.files[a].remote.github=r[n],Object.hasOwn(e.all_files,this.files[a].local.github.md5)||c.push(r[n].path));else if("dataverse"===t.provider)for(s=r.data.latestVersion.files,l=s.length;n<l;n++)Object.hasOwn(this.file_ids,s[n].dataFile.filename)&&(d=!0,a=this.file_ids[s[n].dataFile.filename],this.files[a].remote.dataverse=s[n].dataFile,Object.hasOwn(e.all_files,this.files[a].local.dataverse.md5)||c.push(s[n].dataFile.filename));d?c.length&&(i="WARN",r.message=(1===c.length?"A file was":"Files were")+" not associated with the distribution on record: "+c):(i="WARN",r.message=l?"None of the distribution files match those from the local record.":"The distribution had no files.")}"OK"!==i&&(h.classList.remove("passed-check"),h.classList.add("failed-check"),h.lastElementChild.setAttribute("aria-description",r.message)),h.lastElementChild.lastElementChild.innerText=i,this.display_repo(t.repo)}else if("view"===t.type){const s=this.named_view[t.view];var r,c;if(s.checks.github.lastElementChild.innerText=i,"OK"===i)for(r in e)if(Object.hasOwn(e,r)){if(!Object.hasOwn(this.repos,r)){e.message="A listed repository is not a part of this data commons: "+r+".",i="FAIL";break}for(n=e[r].files.length;n--;)if(c=e[r].files[n],!Object.hasOwn(this.file_ids,c.md5)){e.message="One of the files in "+r+" was not found in the data commons: "+c.md5,i="FAIL";break}}"OK"===i?(s.manifest=e,s.checks.github.classList.add("passed-check")):(s.checks.github.lastElementChild.setAttribute("aria-description",e.message),s.checks.github.classList.remove("passed-check"),s.checks.github.classList.add("failed-check"))}else"datapackage"===t.type&&(Object.hasOwn(t,"index")?(this.named_view[t.view].view.children[t.index].datapackage=e,this.check_child(this.named_view[t.view],t.index)):(this.named_view[t.view].datapackage=e,this.check_view(this.named_view[t.view])))}};var a,n,l,d,r,c,h,o=0;this.page.current_tab=window.location.hash||this.page.current_tab,(r=document.createElement("div")).className="toast",r.role="alert",r.setAttribute("aria-live","assertive"),r.setAttribute("aria-atomic","true"),r.appendChild(document.createElement("div")),r.lastElementChild.className="toast-header",r.lastElementChild.appendChild(document.createElement("strong")),r.lastElementChild.lastElementChild.className="me-auto",r.lastElementChild.appendChild(document.createElement("button")),r.lastElementChild.lastElementChild.type="button",r.lastElementChild.lastElementChild.className="btn-close",r.lastElementChild.lastElementChild.setAttribute("data-bs-dismiss","toast"),r.lastElementChild.lastElementChild.setAttribute("aria-label","close"),r.appendChild(document.createElement("div")),r.lastElementChild.className="toast-body",this.page.toast=new bootstrap.Toast(r),this.page.body.insertAdjacentElement("afterEnd",r),(r=this.page.tooltip).className="hover-note hidden",r.appendChild(document.createElement("p")),this.page.body.insertAdjacentElement("afterEnd",r),this.page.body.parentElement.addEventListener("mouseover",(e=>{const t=e.target.getAttribute("aria-description"),i=t||e.target.parentElement.getAttribute("aria-description");if(i){this.page.tooltip.firstElementChild.innerText=i,this.page.tooltip.classList.remove("hidden");const s=(t?e.target:e.target.parentElement).getBoundingClientRect(),a=this.page.tooltip.getBoundingClientRect();this.page.tooltip.style.top=s.bottom+10+"px",this.page.tooltip.style.left=Math.max(0,s.left+s.width/2-a.width/2)+"px"}else this.page.tooltip.classList.add("hidden")})),Object.keys(this.page.tabs).forEach((e=>{const t=e+"_tab",i=document.getElementById(t+"_button"),s=this.page.tabs[e];i.addEventListener("click",this.show_tab.bind(this)),i.setAttribute("aria-controls",t),this.page.menu[e]=i,s.className="hidden",s.role="tabpanel",s.id=t,s.setAttribute("aria-labelledby",t+"_button"),this.page.current_tab==="#"+e&&this.show_tab({target:this.page.menu[e]})})),Object.keys(t.variables).forEach((e=>{const i=t.variables[e],s=this.patterns.repo_name.exec(e)[0].replace(this.patterns.trailing_slash,""),a=t.repos[s];if(a){a.info_files||(a.info_files=[]);const t={repo:s,name:e.replace(this.patterns.repo_name,""),display:document.createElement("div"),content:i,issues:{},nissues:0};this.info_files[e]=t,a.info_files.push(t),Object.keys(i).forEach((e=>{if("_"!==e.substring(0,1)){const s=this.display_variable(e);s.info_files.push(t),s.info=i[e],s.display.children[0].innerText=s.info.short_name||s.info.long_name||e,s.display.children[1].innerText=e,s.display.children[2].innerText=s.info.short_description||s.info.long_description||"",s.string+=" "+JSON.stringify(s.info).toLowerCase()}}))}})),Object.keys(t.repos).forEach((e=>{this.counts.repos++,(a=this.repos[e]=t.repos[e]).checks={},a.providers={},a.file_ids=[],a.ufiles={},a.all_files=t.files[e],a.variables={},Object.keys(a.all_files).forEach((t=>{if(l=a.all_files[t],n=l.name,"string"==typeof l.providers&&(l.providers=[l.providers]),c="",t in this.file_ids?c=this.file_ids[t]:n in this.file_ids&&(c=this.file_ids[n]),c||(c="f"+o++,this.file_ids[t]=this.file_ids[n]=c),l.uid=c,!Object.hasOwn(this.files,c)){if(this.counts.files++,this.files[c]={inRepo:a.files[l.name],content:l,local:{},remote:{},display:document.createElement("div")},l.prefix=l.name.replace(this.patterns.file_prefix,""),l.variables)for("string"==typeof l.variables&&(l.variables=[l.variables]),h=l.variables.length;h--;){d=l.variables[h];const t=this.display_variable(d);a.variables[d]=t,t.files.push(this.files[c]),-1===t.repos.indexOf(e)&&t.repos.push(e)}l.ids&&("string"==typeof l.ids&&(l.ids=[l.ids]),l.ids.forEach((e=>{if(!(e in this.ids)){this.counts.ids++;const t=document.createElement("div");this.ids[e]={display:t,files:[]},t.className="id",t.appendChild(document.createElement("p")),t.lastElementChild.innerText=e,t.lastElementChild.className="h5"}this.ids[e].files.push(this.files[c])})))}for(d in Object.hasOwn(a.ufiles,c)||(a.file_ids.push(c),a.ufiles[c]=this.files[c]),Object.hasOwn(a.files,n)&&(a.files[n].uid=c,a.files[n].parent=a,a.name=e,this.files[c].local.github=a.files[n]),a.distributions)Object.hasOwn(a.distributions,d)&&(Object.hasOwn(this.dists,d)||(this.dists[d]={}),Object.hasOwn(this.dists[d],a.distributions[d].doi)||(this.dists[d][a.distributions[d].doi]={}),this.dists[d][a.distributions[d].doi][e]=a,a.distributions[d].files&&Object.hasOwn(a.distributions[d].files,n)&&(a.distributions[d].files[n].uid=c,a.distributions[d].files[n].parent=a.distributions[d],this.files[c].local[d]=a.distributions[d].files[n]))})),a.repo_checks&&Object.keys(a.repo_checks).forEach((e=>{if("summary"!==e){let t=a.repo_checks[e];"string"==typeof t&&(t=[t]),this.patterns.info.test(e)?Array.isArray(t)?t.forEach((t=>{t in this.info_files&&(this.info_files[t].issues[e]=!0,this.info_files[t].nissues++)})):Object.keys(t).forEach((i=>{const s=a.name+"/"+i;if(s in this.info_files){const a=this.info_files[s];let n=t[i];a.issues[e]||(a.issues[e]=[]),"string"==typeof n&&(n=[n]),a.issues[e].push(...n),a.nissues++}})):Array.isArray(t)?t.forEach((t=>{if(t in a.files){const i=a.files[t];i.issues||(i.issues={}),i.issues[e]=!0}})):Object.keys(t).forEach((i=>{if(i in a.files){const s=a.files[i];let n=t[i];s.issues||(s.issues={}),s.issues[e]||(s.issues[e]=[]),"string"==typeof n&&(n=[n]),s.issues[e].push(...n)}}))}})),this.page.tabs.repos.appendChild(this.display_repo(e))})),this.counts.views=i.length,i.forEach((e=>{this.named_view[e.name]=e,e.parent=this,e.checks={},this.page.tabs.views.appendChild(this.display_view(e)),Object.hasOwn(e.view,"remote")&&this.requester.postMessage({type:"datapackage",view:e.name,url:"https://raw.githubusercontent.com/"+e.view.remote+"/main/docs/data/datapackage.json"})}))}DataCommons.prototype={constructor:DataCommons,requester:new Worker("request.js"),rates:{github:{resources:{core:{remaining:0,reset:-1/0}}}},queues:{distributions:[]},format:{date:Intl.DateTimeFormat("en-us",{month:"2-digit",day:"2-digit",year:"2-digit"}).format,time:Intl.DateTimeFormat("en-us",{hour:"numeric",minute:"numeric"}).format,size:function(e){return e<1e6?e/1e3+" KB":e<1e9?e/1e6+" MB":e/1e9+" GB"}},checks:{has_dist:{name:"Dist",domain:"repo",description:"Has an associated distribution repository.",check:function(e){return Object.keys(e.distributions).length>1}},aligned:{name:"Aligned",domain:"repo",description:"All latent file instances are aligned.",check:function(e){var t,i,s,a,n,l,d,r=!0;for(l in e.ufiles)if(Object.hasOwn(e.ufiles,l))for(i in t=e.ufiles[l],s=Object.hasOwn(t.local,"github")?"github":"dataverse",t.local)Object.hasOwn(t.local,i)&&(a="github"===i?"sha":"md5",d=!0,"remote"===(n=Object.hasOwn(t.remote,i)?"remote":"local")&&(d=t.local[i][a]===t.remote[i][a]),(d=d&&t.local[s].md5===t.local[i].md5)||(r=!1),t.local[i].display.classList[d&&"local"===n?"add":"remove"]("pending-check"),t.local[i].display.classList[d?"remove":"add"]("failed-check"),t.local[i].display.lastElementChild.setAttribute("aria-description","Source: "+n),t.local[i].display.lastElementChild.innerText=t[n][i][a]);return r}.bind(this)},info_issue:{name:"Info Issues",domain:"repo",description:"Measure info issues.",invert:!0,check:function(e){let t=0;return e.info_files.forEach((e=>t+=!!e.nissues)),t}},missed_variables:{name:"All Variables",domain:"view",description:"All of the requested variables were found in a dataset.",check:function(e){e.missed_variables=[];for(var t,i=!0,s=e.view.variables.length;s--;)t=e.view.variables[s],e.parent.variables.has(t)?(e.variables[t].firstElementChild.innerText=e.parent.variables.get(t).files.length,e.variables[t].firstElementChild.classList.add("passed-check")):(e.variables[t].firstElementChild.classList.remove("passed-check"),e.variables[t].firstElementChild.innerText=0,e.missed_variables.push(t),i=!1);return i}},missed_ids:{name:"All IDs",domain:"view",description:"All of the requested IDs were found in a dataset.",check:function(e){e.missed_ids=[];for(var t,i=!0,s=e.view.ids.length;s--;)t=e.view.ids[s],Object.hasOwn(e.parent.ids,t)?(e.ids[t].firstElementChild.innerText=e.parent.ids[t].files.length,e.ids[t].classList.add("hidden")):(e.ids[t].firstElementChild.innerText=0,e.ids[t].classList.remove("hidden"),e.missed_ids.push(t),i=!1);return i}},datapackage:{name:"datapackage",domain:"view",description:"Retrieved the associated datapackage.json file.",check:function(e){return Object.hasOwn(e,"datapackage")}},updated:{name:"Up-To-Date",domain:"child",description:"The child site's datapackage points to the same files as the parent's.",check:function(e,t){if(Object.hasOwn(e,"datapackage")){var i=!1,s=e.datapackage.resources.length;if(Object.hasOwn(e.view.children[t],"datapackage")&&s===e.view.children[t].datapackage.resources.length)for(;s--&&(i=e.datapackage.resources[s].md5===e.view.children[t].datapackage.resources[s].md5););return i}return!0}}},show_tab:function(e){!e.target.classList.contains("active")&&e.target.innerText in this.page.tabs&&(document.querySelectorAll(".navbar-nav .active").forEach((e=>{this.page.tabs[e.innerText].classList.add("hidden"),e.classList.remove("disabled"),e.classList.remove("active")})),this.page.tabs[e.target.innerText].classList.remove("hidden"),e.target.classList.add("disabled"),e.target.classList.add("active"),this.page.current_tab=e.target.innerText,window.history.replaceState(Date.now(),"","#"+this.page.current_tab))},check_repo:function(e){Object.keys(this.checks).forEach((t=>{const i=this.checks[t];if("repo"===i.domain){const s=i.check(e);e.checks[t].lastElementChild.innerText=s,e.checks[t].classList[(i.invert?!s:s)?"remove":"add"]("failed-check")}}))},check_view:function(e){for(const t in this.checks)if(Object.hasOwn(this.checks,t)&&"view"===this.checks[t].domain){const i=this.checks[t].check(e);e.checks[t].lastElementChild.innerText=i,e.checks[t].classList[i?"remove":"add"]("failed-check"),"missed_ids"!==t&&"missed_variables"!==t||this.page.views[e.name].lastElementChild.children["missed_ids"===t?2:1].classList[i?"add":"remove"]("hidden")}if(Object.hasOwn(e.view,"children"))for(let t=e.view.children.length;t--;)this.check_child(e,t)},check_child:function(e,t){for(const i in this.checks)if(Object.hasOwn(this.checks,i)&&"child"===this.checks[i].domain){const s=this.checks[i].check(e,t);e.view.children[t].parts[i].lastElementChild.innerText=s,e.view.children[t].parts[i].classList[s?"remove":"add"]("failed-check")}},display_object:function(e,t){return t||(t=document.createElement("table")),Object.keys(e).forEach((i=>{const s=document.createElement("tr"),a=document.createElement("th"),n=document.createElement("td");s.appendChild(a),s.appendChild(n),a.innerText=i,Array.isArray(e[i])?"string"==typeof e[i][0]?n.innerText=e[i].join(", "):e[i].forEach((e=>{n.appendChild(this.display_object(e))})):"object"==typeof e[i]?n.appendChild(this.display_object(e[i])):n.innerText=e[i],t.appendChild(s)})),t},display_repo:function(e){const t=this.repos[e],i=e in this.page.repos,s=i?this.page.repos[e]:document.createElement("div");if(t){var a,n,l,d;if(!i){for(a in this.page.repos[e]=s,s.className="repo_container card",s.appendChild(n=document.createElement("div")),n.className="repo_header card-header",d=e.split("/"),n.appendChild(document.createElement("span")),n.lastElementChild.innerText=d[0]+"/",n.appendChild(document.createElement("span")),n.lastElementChild.innerText=d[1],n.appendChild(n=document.createElement("span")),n.className="repo_links card-links",Object.hasOwn(t,"distributions")||(t.distributions={}),t.distributions.github={url:t.url},t.distributions)Object.hasOwn(t.distributions,a)&&(t.distributions[a].display=document.createElement("div"),n.appendChild(t.distributions[a].display),n.lastElementChild.className="status-chip",n.lastElementChild.appendChild(l=document.createElement("a")),l.target="_blank",l.rel="noreferrer",l.innerText=a,l.href=this.get_provider_link(a,e),n.lastElementChild.appendChild(l=document.createElement("button")),l.className="btn",l.appendChild(document.createElement("span")),l.lastElementChild.innerText="check",l.addEventListener("click",this.request_provider.bind(this,e,a)));for(a in s.appendChild(document.createElement("div")),s.lastElementChild.className="repo_body card-body",s.lastElementChild.appendChild(n=document.createElement("div")),n.className="repo_status card-status",this.checks)Object.hasOwn(this.checks,a)&&"repo"===this.checks[a].domain&&(n.appendChild(t.checks[a]=document.createElement("div")),n.lastElementChild.className="status-chip",n.lastElementChild.setAttribute("aria-description",this.checks[a].description),n.lastElementChild.appendChild(document.createElement("span")),n.lastElementChild.firstElementChild.innerText=this.checks[a].name,n.lastElementChild.appendChild(document.createElement("span")));t.repo_checks&&t.repo_checks.summary&&(n.appendChild(l=document.createElement("div")),l.className="data-check-summary",l.setAttribute("aria-description","Data file check summary."),l.appendChild(document.createElement("span")),l.lastElementChild.innerText="data files",["FAIL","WARN","SKIP","PASS"].forEach(((e,i)=>{const s=document.createElement("div"),a=t.repo_checks.summary[i];s.className="status-chip"+(3===i&&!a||3!==i&&a?" failed-check":""),s.appendChild(document.createElement("span")),s.firstElementChild.innerText=e,s.appendChild(document.createElement("span")),s.lastElementChild.innerText=a,l.appendChild(s)}))),s.lastElementChild.appendChild(n=document.createElement("div")),n.className="repo_files card-section accordion",n.id="file-list-container-"+e,n.setAttribute("data-bs-theme","dark"),n.appendChild(n=document.createElement("div")),n.className="accordion-item",n.appendChild(n=document.createElement("h2")),n.className="accordion-header",n.appendChild(document.createElement("button")),n.lastElementChild.innerText="Data Files ("+t.file_ids.length+")",n.lastElementChild.className="accordion-button collapsed"+(t.file_ids.length?"":" empty"),n.lastElementChild.type="button",n.lastElementChild.setAttribute("data-bs-toggle","collapse"),n.lastElementChild.setAttribute("data-bs-target","#file-list-"+e),n.lastElementChild.setAttribute("aria-expanded","false"),n.lastElementChild.setAttribute("aria-controls","file-list-"+e),n.insertAdjacentElement("afterend",n=document.createElement("div")),n.id="file-list-"+e,n.className="accordion-collapse collapse",n.setAttribute("data-bs-parent","#file-list-container-"+e),n.appendChild(n=document.createElement("div")),Object.keys(t.all_files).forEach((e=>n.appendChild(this.display_file(e)))),n.parentElement.insertAdjacentElement("afterend",n=document.createElement("div")),n.className="accordion-item",n.appendChild(n=document.createElement("h2")),n.className="accordion-header",n.appendChild(document.createElement("button")),n.lastElementChild.innerText="Measure Infos ("+t.info_files.length+")",n.lastElementChild.className="accordion-button collapsed"+(t.info_files.length?"":" empty"),n.lastElementChild.type="button",n.lastElementChild.setAttribute("data-bs-toggle","collapse"),n.lastElementChild.setAttribute("data-bs-target","#info-list-"+e),n.lastElementChild.setAttribute("aria-expanded","false"),n.lastElementChild.setAttribute("aria-controls","info-list-"+e),n.insertAdjacentElement("afterend",n=document.createElement("div")),n.id="info-list-"+e,n.className="accordion-collapse collapse",n.setAttribute("data-bs-parent","#info-list-container-"+e),n.appendChild(n=document.createElement("div")),t.info_files.forEach((e=>n.appendChild(this.display_info_file(e))))}this.check_repo(t)}return s},display_file:function(e){if(Object.hasOwn(this.file_ids,e)){const s=this.file_ids[e],a=this.files[s],n=a.display;var t,i;if(!n.childElementCount){for(t in n.className="entry",n.appendChild(document.createElement("p")),n.lastElementChild.innerText=a.content.name,n.lastElementChild.className="entry-name",n.appendChild(document.createElement("p")),n.lastElementChild.className="entry-info",n.lastElementChild.appendChild(document.createElement("span")),n.lastElementChild.lastElementChild.className="entry-info-entry",n.lastElementChild.lastElementChild.innerText="git sha: ",n.lastElementChild.appendChild(document.createElement("span")),n.lastElementChild.appendChild(document.createElement("span")),n.lastElementChild.lastElementChild.className="entry-info-entry",n.lastElementChild.lastElementChild.innerText="md5: ",n.lastElementChild.appendChild(document.createElement("span")),(t="github"in a.local?"github":"dataverse")in a.local?(n.lastElementChild.children[1].innerText=a.local[t].sha||"none",n.lastElementChild.children[3].innerText=a.local[t].md5):n.lastElementChild.classList.add("hidden"),n.appendChild(document.createElement("div")),n.lastElementChild.className="entry-checks",a.local)Object.hasOwn(a.local,t)&&(a.local[t].display=document.createElement("div"),n.lastElementChild.appendChild(a.local[t].display),a.local[t].display.className="status-chip",a.local[t].display.appendChild(i=document.createElement("a")),i.target="_blank",i.rel="noreferrer",i.href=this.make_file_link(s,t),i.innerText=t,i.className=t+"-file",a.local[t].display.appendChild(document.createElement("span")));a.inRepo.issues&&(n.appendChild(i=document.createElement("div")),i.className="file-issues",Object.keys(a.inRepo.issues).forEach((e=>{const t=document.createElement("div"),s=a.inRepo.issues[e];t.className="status-chip failed-check",e in this.issue_descriptions&&t.setAttribute("aria-description",this.issue_descriptions[e]),t.appendChild(document.createElement("span")),t.lastElementChild.innerText=this.patterns.fail.test(e)?"FAIL":"WARN",t.appendChild(document.createElement("span")),t.lastElementChild.innerText=e.replace(this.patterns.pre_underscore,"")+(Array.isArray(s)?": "+s.join(", "):""),i.appendChild(t)})))}return n}return document.createElement("div")},display_variable:function(e){if(this.variables.has(e))return this.variables.get(e);{const t=document.createElement("div"),i={name:e,string:e.toLowerCase(),display:t,files:[],repos:[],info:{},info_files:[]};return i.show=function(e,t){const i=t.info;this.page.modal.title.firstElementChild.innerText=i.short_name||i.long_name||t.name,this.page.modal.files.lastElementChild.innerHTML="",t.files.forEach((e=>{const i=document.createElement("li");i.appendChild(document.createElement("a")),i.lastElementChild.target="_blank",i.lastElementChild.rel="noreferrer",i.lastElementChild.innerText=t.repos[0]+": "+e.content.name,i.lastElementChild.href=this.repos[t.repos[0]].base_url+"/"+e.content.name,this.page.modal.files.lastElementChild.appendChild(i)})),this.page.modal.dashboards.lastElementChild.innerHTML="",this.views.forEach((e=>{if(t.name in e.variables){const i=document.createElement("li");i.appendChild(document.createElement("a")),i.lastElementChild.target="_blank",i.lastElementChild.rel="noreferrer",i.lastElementChild.href=e.view.url+"?selected_variable="+t.name,i.lastElementChild.innerText=e.name,this.page.modal.dashboards.lastElementChild.appendChild(i)}})),this.page.modal.measure_info.children[1].innerHTML="",t.info_files.forEach((e=>{const t=document.createElement("li");t.appendChild(document.createElement("a")),t.lastElementChild.target="_blank",t.lastElementChild.rel="noreferrer",t.lastElementChild.innerText=e.repo+": "+e.name,t.lastElementChild.href=this.repos[e.repo].base_url+"/"+e.name,this.page.modal.measure_info.children[1].appendChild(t)})),this.page.modal.measure_info.lastElementChild.innerHTML="",this.page.modal.measure_info.appendChild(this.display_object({measure:t.name,...i},this.page.modal.measure_info.lastElementChild))}.bind(this,null,i),this.variables.set(e,i),this.counts.variables++,t.className="variable",t.appendChild(document.createElement("button")),t.lastElementChild.type="button",t.lastElementChild.innerText=e,t.lastElementChild.className="btn",t.lastElementChild.setAttribute("data-bs-toggle","modal"),t.lastElementChild.setAttribute("data-bs-target","#general_modal"),t.lastElementChild.addEventListener("click",i.show),t.appendChild(document.createElement("p")),t.lastElementChild.className="variable-name",t.appendChild(document.createElement("p")),i}},display_info_file:function(e){const t=e.display;if(!t.childElementCount){let i;t.className="entry",t.appendChild(document.createElement("p")),t.lastElementChild.className="entry-name",t.lastElementChild.appendChild(i=document.createElement("a")),i.target="_blank",i.rel="noreferrer",i.innerText=e.name,i.href=this.repos[e.repo].base_url+"/"+e.name,t.appendChild(i=document.createElement("p")),i.className="entry-info";const s=Object.keys(e.content);s.length>50?(i.appendChild(document.createElement("span")),i.lastElementChild.className="entry-info-entry",i.lastElementChild.innerText=s.length+" variables"):s.forEach((e=>{"_"!==e.substring(0,1)&&(i.appendChild(document.createElement("button")),i.lastElementChild.type="button",i.lastElementChild.className="btn entry-info-entry",i.lastElementChild.innerText=e,i.lastElementChild.setAttribute("data-bs-toggle","modal"),i.lastElementChild.setAttribute("data-bs-target","#general_modal"),i.lastElementChild.addEventListener("click",this.variables.get(e).show))})),t.appendChild(i=document.createElement("div")),i.className="file-issues",Object.keys(e.issues).forEach((t=>{const s=document.createElement("div"),a=e.issues[t];s.className="status-chip failed-check",t in this.issue_descriptions&&s.setAttribute("aria-description",this.issue_descriptions[t]),s.appendChild(document.createElement("span")),s.lastElementChild.innerText="info_invalid"===t?"FAIL":"WARN",s.appendChild(document.createElement("span")),s.lastElementChild.innerText=t.replace(this.patterns.pre_underscore,"")+(Array.isArray(a)?": "+a.join(", "):""),i.appendChild(s)}))}return t},display_view:function(e){const t=Object.hasOwn(this.page.views,e.name),i=t?this.page.views[e.name]:document.createElement("div");var s,a,n,l,d;if(!t){for(s in e.variables={},e.ids={},this.page.views[e.name]=i,i.className="view_container card",i.appendChild(a=document.createElement("div")),a.className="view_header card-header",a.appendChild(document.createElement("span")),e.view.url?(a.lastElementChild.appendChild(n=document.createElement("a")),n.target="_blank",n.rel="noreferrer",n.href=e.view.url,n.innerText=e.name):a.lastElementChild.innerText=e.name,a.appendChild(a=document.createElement("span")),a.className="view_links card-links",e.view.remote&&(a.appendChild(document.createElement("div")),a.lastElementChild.className="status-chip",e.checks.github=a.lastElementChild,a.lastElementChild.appendChild(n=document.createElement("a")),n.target="_blank",n.rel="noreferrer",n.href="https://github.com/"+e.view.remote,n.innerText="github",a.lastElementChild.appendChild(n=document.createElement("button")),n.className="btn",n.appendChild(document.createElement("span")),n.lastElementChild.innerText="check",n.addEventListener("click",this.request_manifest.bind(this,e,"https://raw.githubusercontent.com/"+e.view.remote+"/main/docs/data/manifest.json"))),i.appendChild(document.createElement("div")),i.lastElementChild.className="view_body card-body",i.lastElementChild.appendChild(a=document.createElement("div")),a.className="view_status card-status",this.checks)Object.hasOwn(this.checks,s)&&"view"===this.checks[s].domain&&(a.appendChild(e.checks[s]=document.createElement("div")),a.lastElementChild.className="status-chip",a.lastElementChild.setAttribute("aria-description",this.checks[s].description),a.lastElementChild.appendChild(document.createElement("span")),a.lastElementChild.firstElementChild.innerText=this.checks[s].name,a.lastElementChild.appendChild(document.createElement("span")));for(i.lastElementChild.appendChild(n=document.createElement("div")),n.className="card-section",n.appendChild(document.createElement("p")),n.lastElementChild.innerText="Variables",n.lastElementChild.className="card-section-header",n.appendChild(document.createElement("table")),n.lastElementChild.appendChild(document.createElement("thead")),n.lastElementChild.lastElementChild.appendChild(document.createElement("tr")),n.lastElementChild.lastElementChild.lastElementChild.appendChild(document.createElement("th")),n.lastElementChild.lastElementChild.lastElementChild.lastElementChild.innerText="Files",n.lastElementChild.lastElementChild.lastElementChild.appendChild(document.createElement("th")),n.lastElementChild.lastElementChild.lastElementChild.lastElementChild.innerText="Name",n.lastElementChild.appendChild(n=document.createElement("tbody")),d=0,l=e.view.variables.length;l--;)n.appendChild(e.variables[e.view.variables[l]]=document.createElement("tr")),n.lastElementChild.appendChild(document.createElement("td")),n.lastElementChild.lastElementChild.innerText=0,n.lastElementChild.appendChild(document.createElement("td")),n.lastElementChild.lastElementChild.innerText=e.view.variables[l],e.view.variables[l].length>d&&(d=e.view.variables[l].length);for(i.lastElementChild.appendChild(n=document.createElement("div")),n.className="card-section",n.appendChild(document.createElement("p")),n.lastElementChild.innerText="Missing IDs",n.lastElementChild.className="card-section-header",n.appendChild(document.createElement("table")),n.lastElementChild.appendChild(document.createElement("thead")),n.lastElementChild.lastElementChild.appendChild(document.createElement("tr")),n.lastElementChild.lastElementChild.lastElementChild.appendChild(document.createElement("th")),n.lastElementChild.lastElementChild.lastElementChild.lastElementChild.innerText="Files",n.lastElementChild.lastElementChild.lastElementChild.appendChild(document.createElement("th")),n.lastElementChild.lastElementChild.lastElementChild.lastElementChild.innerText="ID",n.lastElementChild.appendChild(n=document.createElement("tbody")),d=0,l=e.view.ids.length;l--;)n.appendChild(e.ids[e.view.ids[l]]=document.createElement("tr")),n.lastElementChild.classList.add("hidden"),n.lastElementChild.appendChild(document.createElement("td")),n.lastElementChild.lastElementChild.innerText=0,n.lastElementChild.appendChild(document.createElement("td")),n.lastElementChild.lastElementChild.innerText=e.view.ids[l],e.view.ids[l].length>d&&(d=e.view.ids[l].length);if(e.view.children.length)for(e.checks.children=[],i.lastElementChild.appendChild(a=document.createElement("div")),a.className="card-section",a.appendChild(document.createElement("p")),a.lastElementChild.innerText="Children",a.lastElementChild.className="card-section-header",l=e.view.children.length;l--;){for(s in(n=document.createElement("div")).className="status-chip",n.appendChild(document.createElement("span")),n.firstElementChild.innerText="github",n.appendChild(document.createElement("a")),n.lastElementChild.target="_blank",n.lastElementChild.rel="noreferrer",n.lastElementChild.innerText=e.view.children[l].remote,n.lastElementChild.href="https://github.com/"+e.view.children[l].remote,e.view.children[l].parts={repo:n},this.checks)Object.hasOwn(this.checks,s)&&"child"===this.checks[s].domain&&(e.view.children[l].parts[s]=n=document.createElement("div"),n.className="status-chip",n.appendChild(document.createElement("span")),n.firstElementChild.innerText=this.checks[s].name,n.appendChild(document.createElement("span")));for(s in a.appendChild(document.createElement("div")),a.lastElementChild.className="entry",a.lastElementChild.appendChild(document.createElement("p")),a.lastElementChild.lastElementChild.appendChild(n=document.createElement("a")),n.parentElement.className="entry-name",n.target="_blank",n.rel="noreferrer",n.innerText=e.view.children[l].name,n.href=e.view.children[l].url,a.lastElementChild.appendChild(n=document.createElement("div")),n.className="entry-checks",e.view.children[l].parts)Object.hasOwn(e.view.children[l].parts,s)&&n.appendChild(e.view.children[l].parts[s]);this.requester.postMessage({type:"datapackage",view:e.name,index:l,url:"https://raw.githubusercontent.com/"+e.view.children[l].remote+"/main/docs/data/datapackage.json"})}}return this.check_view(e),i},make_file_link:function(e,t){const i=this.files[e];if(i)if("github"===t){if(i.local.github)return i.local.github.parent.base_url+"/"+i.content.name}else if("dataverse"===t){const e=i.local[t];if(e)return e.parent.server+"file.xhtml?fileId="+e.id}},get_provider_link:function(e,t,i){if("github"===e)return i?"https://api.github.com/repos/"+t+"/contents/":"https://github.com/"+t;const s=this.repos[t].distributions[e];return"dataverse"===e?s.server+(i?"api/datasets/:persistentId":"dataset.xhtml")+"?persistentId=doi:"+s.doi:void 0},request_manifest:function(e,t){this.requester.postMessage({type:"view",view:e.name,url:t})},request_provider:function(e,t){const i=this.get_provider_link(t,e,!0);if(i){const s=[],a=this.repos[e].files;Object.keys(a).forEach((e=>{a[e].display&&a[e].display.classList.add("failed-check");const t=e.replace(this.patterns.dirname,"");-1===s.indexOf(t)&&s.push(t)})),s.forEach((s=>{this.queues.distributions.push({type:"provider",repo:e,provider:t,dir:s,url:i+"/"+s})})),this.prompt_dist_requester()}},prompt_dist_requester:async function(){for(var e,t=this.queues.distributions.length;t--;){if("github"===(e=this.queues.distributions[t]).provider){if(!(this.rates.github.resources.core.remaining>0)){if(Date.now()>this.rates.github.resources.core.reset){if(!this.rates.github.resources.core.queued){const e=new XMLHttpRequest;e.onreadystatechange=()=>{if(4===e.readyState){if(200!==e.status)throw new TypeError("failed to retrieve github rate limit; "+e.responseText);this.rates.github=JSON.parse(e.responseText),this.rates.github.resources.core.reset=Date.now()+this.rates.github.resources.core.reset/1e3,this.prompt_dist_requester()}},e.open("GET","https://api.github.com/rate_limit",!0),e.send(),this.rates.github.resources.core.queued=!0}}else this.page.toast._element.firstElementChild.firstElementChild.innerText="GitHub Rate Limit",this.page.toast._element.lastElementChild.innerText="This IP has reached GitHub's API rate limit; this will reset at "+this.format.time(new Date(this.rates.github.resources.core.reset))+" (in "+Math.round((this.rates.github.resources.core.reset-Date.now())/6e4)+" minutes).",this.page.toast.show(),this.requester.onmessage({data:{response:JSON.stringify({status:"WARN",message:this.page.toast._element.lastElementChild.innerText}),repo:e.repo,provider:e.provider}}),this.queues.distributions.splice(t,1);continue}this.rates.github.resources.core.remaining--}this.requester.postMessage(this.queues.distributions.splice(t,1)[0])}},search:function(e){const t=this.page.tabs.variables.firstElementChild.lastElementChild,i=(e.target?e.target.value:e).toLowerCase();t.innerHTML="";const s=document.createElement("div");this.variables.forEach(((e,t)=>{i&&!e.string.includes(i)||s.appendChild(e.display)})),t.appendChild(s)}},"undefined"!=typeof module&&(module.export=DataCommons);